<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anotaciones V 0.0</title>
    <!-- <script src="html2canvas.min.js"></script> -->

	<style>
		:root {
    --grid-canvas-color: blue; /* color de la cuadrícula de los elementos dibujo*/
}

*{
    box-sizing: border-box;
}

body{
    background-color: #111;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    box-sizing: border-box;
    padding-bottom: 20px;
    padding-right: 20px;
    display: block;
    margin: 0;
    padding: 0;
}
.central{
    display: flex;
}
.sidebar{
    width: 200px;
    background-color: #080808;
    outline: none;
}
.sidebar .cabecera{
    border-bottom: 1px solid #ddd;
    color: #ddd;
    font-family:'Times New Roman', Times, serif;
    font-size: 14px;
    padding: 5px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.sidebar .botones{
    svg{
        width: 20px;
        height: 20px;
        stroke: #dddddd;
    }
    svg:hover{
        scale: 1.2;
        stroke-width: 2;
        cursor: pointer;
        fill:#00ff0070
    }
    .eliminar svg:hover{
        fill: #ff000070;
    }
}
.sidebar .arbol{
    margin: 6px 0;
    padding: 6px 0;
    outline: none;
}
.sidebar .arbol>ul{
    outline: none;
}
.sidebar:focus-within .arbol{
    border-top: 3px solid #ffff0070;
    border-bottom: 3px solid #ffff0070;
}
/* Estilos internos del sidebar */

.sidebar ul {
    list-style-type: none;
    padding: 0;
    margin: 0 0 0 3px;
    /* padding-left: 10px; */
    /* margin: 0; */
    svg{
        width: 12px;
        height: 12px;
        stroke: #ddd;
    }    
    ul{
        margin-left: 5px;
        padding-left: 5px;
        border-left: 1px solid #ddd;
    }
    li{
      background-color: #080808;
      user-select: none;
      color: #ddd;
      font-size: 15px;
      margin: 1px 0;

    }
    li:hover {
        background-color: #ffffff17; 
    }
}

.sidebar .folder {
    cursor: pointer;
    padding: 0;
    /* font-weight: bold; */
}

.sidebar .folder:hover {
    background-color: #ffffff17; 
}

.sidebar .hidden {
    display: none;
}

.sidebar .icon {
    margin-top: 3px;
    display: inline-block;
    transition: transform 0.3s; /* Giro del icono capeta abierta/cerrada */
}

.sidebar .icon.closed {
    transform: rotate(-90deg); /* Rotar -90 grados para parecer ">" */
}

.sidebar .name{
    margin: 1px;
    margin-left: 2px;
    padding-left: 1px;
    box-sizing: border-box;
} 


.sidebar .nested {
    height: 0;
    overflow: hidden;
    /* transform: scaleY(0);
    transform-origin: top;
    transition: transform 0.3s ease-in-out; */
}

.sidebar .nested.open {
    height: auto;
    /* transform: scaleY(1); */
}

.sidebar .active {
    box-shadow: 0 0 0 1px #ffff00;
    background-color: #ffff0020;
}


/* Fin estilos internos sidebar */
.resizer{
    width: 3px;
    background-color: #222;
    border-right: 1px solid #ccc;
    cursor: ew-resize;
}
.resizer:hover{
    background-color: #ccc;
}

.main{
    flex-grow: 1;
}
.main>div{
    background-color: #222;
    position: relative;
    height: 95vh;
    overflow: auto;
}
.sinEntornoCreado{
    display: grid;
    place-content: center;
    gap: 50px;
    color: #ccc;
}

.apunte{
    /* border: 1px solid black; */
    background-color: burlywood;
    box-shadow: 2px 2px 10px 2px rgba(0,0,0,0.6);
    position: absolute;
    top: 100px;
    left: 100px;
    transition: opacity 1s ease;
}
.atenuado {
    opacity: 0.5; 
    pointer-events: none; /* Evita que los elementos atenuados sean clicables */
}
.mensaje-temporal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #f0f0f0;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    display: none;
    z-index: 100;
    transition: opacity 650ms ease;
}
.fade-out{
    opacity: 0;
}

.apunteCabecera{
    font-family: sans-serif;
    font-size: 18px;
    padding: 5px;
    display: grid;
    place-content: center;
}

.contenido{
    background-color: transparent;
    outline: none;
    border: none;
    resize: none;
    padding: 5px;
    margin: 0;
    vertical-align: top;
}
.contenido:focus{
    resize: both;
}
.ventanaMenu{
    position: absolute;
    top: 80px;
    left: 40px;
    background-color: rgb(131, 131, 131);
    border-radius: 5px;
    box-shadow: 2px 2px 5px 2px rgba(0,0,0,0.5);
    z-index: 2;
}
.tituloMenu{
    justify-items: center;
    text-align: center;
    font-size: 18px;
    width: 100%;
    margin-top: 5px;
    margin-bottom: 20px;
}
.contenidoMenu{
    margin-right: 7px;
    margin-left: 7px;
    /*position: relative;*/
    display: flex;
    flex-wrap: wrap;
}
.contenidoMenu input{
    display: none;
}
.contenidoMenu>div{
    order: 1;
    display: none;
    width: 100%;
}

.tab.activo{
    background-color: rgb(219, 219, 219);
    color: black;
    +div{
        display: block;
    }
}
.tab{
    all: unset;
    padding: 5px;
    margin-right: 2px;
    font-size: 15px;
    background-color: rgb(168, 168, 168);
    border-radius: 5px 5px 0 0;
    color: rgb(77, 77, 77);;
}

.opcionesAspecto{
    background-color: rgb(219, 219, 219);
    border-radius: 5px;
    margin-bottom: 10px;
    padding-top: 15px;
    padding-bottom: 15px;
    order: 1;
    display: none;
    span{
        font-size: 15px;
    }
    div{
        margin-left: 10px;
        padding: 10px;
        display: flex;
        .color{
            height: 1em;
            width: 1em;
            background-color: #00ffff;
            border: 1px solid b;
            box-shadow: 0 0 0 1px black;
        }
        span{
            margin-right: 10px;
        }
    }
    input{
        display: block;
    }
}
.tab.primero.activo+div{
    border-top-left-radius: 0px;
}
.labelContenido{
    margin-left: 8px;
}

/* Estilo de horarioClases */
.horarioTabla{
    padding: 5px;
    table {
        width: 100%;
        border-collapse: collapse;
        font-family: 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;
        text-align: center;
    }
    th{
        font-size: 20px;
        /* background-color: rgb(255, 222, 179) */
    }
    th:first-child {
        border-top: none;
        border-left: none;
        background-color: transparent;
    }
    td{
        font-size: 22px;
        /* background-color: antiquewhite */

    }
    td:first-child{
        font-size: 18px;
        /* background-color: rgb(255, 222, 179) */
    }
}
.horarioCabecera{
    font-size: 24px;
    font-family: sans-serif;
    padding: 10px;
    display: grid;
    place-content: center;
}
.horarioClases{
    /* border: 2px solid rgb(223, 192, 152); */
    /* background-color: antiquewhite; */
    box-shadow: 5px 5px 5px 2px rgba(0,0,0,0.5);
    position: absolute;
    resize: both;
    overflow: hidden; 
    min-width: 520px;
    max-width: 800px;
    min-height: 46px;
    max-height: 316px;
    transition: opacity 650ms ease;
}
.menuDesplegable{
    display: grid;
    position: absolute;
    border: 10px solid rgba(0,0,0,0.7);
    background-color: rgba(200,200,200,0.9);
}
.menuEntorno{
    display: grid;
}


.opcionMenu{
    all: unset;
    background-color: rgba(200,200,200,0.9);
    font-size: 18px;
    padding: 5px;

}
.opcionMenu:hover{
        background-color:#777;
        color: #eee;
}
.entornoMenu{
    display: grid;
    padding: 5px;
    label{
        padding: 10px;
    }
    div{
        display: grid;
        place-content: center;
        padding: 5px;
        font-size: 20px;
        font-weight: 600;
    }
}
.sliderColor{
    display: block;
    margin-top: 10px;
}
.dibujo{
    box-shadow: 5px 5px 5px 2px rgba(0,0,0,0.5);
    position: absolute;
    /* resize: both; */
    overflow: hidden; 
    transition: opacity 650ms ease;
    display: flex;
    flex-direction: column;
    background-color: #000;
    box-sizing: border-box;

    
}

.dibujoCabecera{
    background-color: rgba(0,0,0);
    position: sticky;
    top: 0;
    display: flex;
    width: 100%;
    /* width: calc(100% + 17px); */
    box-sizing: border-box;
}

.canvasContenedor{
    overflow: scroll;
    /* position: relative; */
}
.canvasBackgroundGrid{
    background-image: linear-gradient(to right, var(--grid-canvas-color) 1px, transparent 1px),
        linear-gradient(to bottom, var(--grid-canvas-color) 1px, transparent 1px);
    background-size: 20px 20px;
}
.dimensionNormal{
    width: 900px;
    height: 500px;
}
.dimensionCompleta{
    width: 100%;
    height: 100%;
}

.canvasHerramientas{
    display: flex;
    height: 32px;
    align-items: center;
    gap: 10px;
    padding: 0 10px;
    box-sizing: border-box;
    width: 100%;

  }
.canvasHerramientas>button{
    all: unset
}
.canvasHerramientas>button>svg{
    margin-top: 6px;
    width: 20px;
    height: 20px;
    background-color: transparent;
    stroke: rgba(255, 255, 255, 0.7);
    fill: rgba(255, 255, 255, 0.7);
}
.canvasHerramientas>button>svg:hover{
    stroke: rgba(255, 255, 255, 0.9);
    fill: rgba(255, 255, 255, 0.9);
    scale: 1.5;
    cursor: pointer;
}
.canvasHerramientas>button>svg.marcado{
    border: 1px solid #ffffaa;
    stroke: rgba(255, 255, 255, 0.9);
    fill: rgba(255, 255, 255, 0.9);
    scale: 1.5;
}
.canvasHerramientas>button>.limpiar{
    width: 26px;
    height: 26px;
}
.canvasHerramientas>.botonColor{
    all: unset;
    display: inline-block;
    width: 24px;
    height: 24px;
    border-radius: 50%;
}
/* .color-selector {
    display: flex;
    gap: 10px;
} */

.dibujo-colorSelector{
    display: inline-flex;
    height: 100%;
    align-items: center;
}
.dibujo-currentColor{
    width: 28px;
    height: 28px;
    border: 2px solid #ffff00bb;
}
.dibujo-palette{
    position: relative;
    svg{
        margin-top: 4px;
    }
    /* display: flex;
    height: 100%;
    align-items: center; */
}
.dibujo-gridPalette{
    position: absolute;
    flex-wrap: wrap;
    background-color: #111;
    width: 126px;
    display: none;
}
.dibujo-palette:hover .dibujo-gridPalette{
    display: flex;
    cursor: pointer;
}
.dibujo-option{
    width: 12px;
    height: 12px;
    margin: 1px;
}
.dibujo-option:hover{
    scale: 1.5;
    border: 1px solid #ffffff;
    cursor: pointer;
}
.dibujo-lastColors{
    margin-top: 1px;
    width: 84px;
    height: 30px;
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
}

.color-circle {
    height: 16px;
    width: 16px;
    border-radius: 50%;
    display: inline-block;
    cursor: pointer;
    border: 2px solid transparent;
}

label:has(input[type="radio"]:checked) {
    border-color: #ffffff;
    scale: 1.5;
}  

/* .canvasHerramientas>.color1{
    background:#0000ff;
}
.canvasHerramientas>.color2{
    background:#ff0000;
}
.canvasHerramientas>.color3{
    background:#00ff00;
}
.canvasHerramientas>.color4{
    background:#00ffff;
}
.canvasHerramientas>.color5{
    background:#ffa800;
} */

.labelColorInput{
    all: unset;
    display: inline-block;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: radial-gradient(50% 50% at 50% 50%, #ffffff 0%, transparent 100%),
        conic-gradient(
        from 0deg at 50% 50%,
        #ff0000 0deg,
        #ffa800 47.73deg,
        #ffff00 79.56deg,
        #00ff00 121.33deg,
        #00ffff 180.99deg,
        #0000ff 238.67deg,
        #ff00ff 294.36deg,
        #ff0000 360deg
        ),
        #c4c4c4;
    /* transform: rotate(105deg); */
    input{
        all: unset;
    }
}
.labelColorInput:hover{
    cursor: pointer;
}
.canvasHerramientas>.grosor{
    font-size: 16px;
    width: 2.5em;
}
.oculto{
    display: none;
}

#marcador{
    color: #ccc;
}

/* Estilo para cada fuente del menú desplegable*/
.fuente-Arial {
    font-family: Arial, sans-serif;
}

.fuente-TimesNewRoman {
    font-family: "Times New Roman", serif;
}

.fuente-CourierNew {
    font-family: "Courier New", monospace;
}

.fuente-Georgia {
    font-family: Georgia, serif;
}

.fuente-Impact {
    font-family: Impact, sans-serif;
}

.fuente-LucidaSansUnicode {
    font-family: "Lucida Sans Unicode", sans-serif;
}

.fuente-PalatinoLinotype {
    font-family: "Palatino Linotype", serif;
}

.fuente-Tahoma {
    font-family: Tahoma, sans-serif;
}

.fuente-TrebuchetMS {
    font-family: "Trebuchet MS", sans-serif;
}

.fuente-Verdana {
    font-family: Verdana, sans-serif;
}


/* Para el editor de texto del canvas  */

.txt-can-icono{
    font-size: 24px;
}

.txt-can-editor-container {
    display: none;
    position: absolute;
    background-color: transparent;
}

.txt-can-editor {
    min-width: 50px;
    margin-bottom: 10px;
    padding: 10px;
}

.txt-can-options {
    display: none;
    margin-bottom: 10px;
}

.txt-can-options button {
    background: none;
    border: none;
    cursor: pointer;
    width: 28px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.txt-can-dropdown {
    position: relative;
    display: inline-block;
}

.txt-can-dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

.txt-can-dropdown-list div{
    color: black;
    padding: 12px 16px;
    display: block;
    background: none;
    text-align: left;
}

.txt-can-dropdown-content div:hover {
    background-color: #f1f1f1;
}

.txt-can-dropdown:hover .txt-can-dropdown-content {
    display: grid;
}

.txt-can-color-picker {
    display: none;
    grid-template-columns: repeat(6, 30px);
    grid-template-rows: repeat(3, 30px);
    gap: 5px;
    padding: 5px;
    background-color: #ccc;
}

.txt-can-color-option {
    border: 1px solid #f9f9f9;
    cursor: pointer;
    padding: 0;
}

.txt-can-color-option:hover{
    border: 2px solid #222;
}

.txt-can-dropdown>button:hover{
    background-color: #f9f9f9;
}

.txt-can-options>button:hover{
    background-color: #f9f9f9;
}
.txt-can-options>div:hover{
    background-color: #f9f9f9;
}

.txt-can-visible {
    display: block;
}

/* De ImageEditor*/

.image_editor_main{
    position: absolute;
    top: 50px;
    left: 50px;
    display: flex;
    z-index: 900;
}
.image_editor_tools{
    box-sizing: border-box;
    margin-top: 35px;
    padding: 4px;
    background-color: #333333dd;
    border: 1px solid #aaa;
    height: 410px;
    display: grid;
    place-content: center;
    gap: 10px;
    border-top-left-radius: 14px;
    border-bottom-left-radius: 14px;
    svg{
        height: 32px;
        width: 32px;
        margin-left: 6px;
    }
    div{
        border-top: 1px solid #aaa;
        display: grid;
        place-content: center;
        input{
            height: 15px;
            width: 36px;
        }
    }
}
.image_editor_preview{
    position: relative;
    box-sizing: border-box;
    border: 1px solid #000;
    width: fit-content;
    height: fit-content;
    display: flex;
}
.image_editor_information{
    box-sizing: border-box;
    height: 35px;
    padding: 0px 12px;
    background-color: #333333dd;
    border: 1px solid #aaa;
    color: #ddd;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    font-size: 16px;
    width: fit-content;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    margin-left: -1px;
    display: grid;
    place-content: center;
}
.image_editor_central{
    display: block;
}
.image_editor_svg_clickable:hover{
    scale: 1.3;
}

/* Del Cropper */

.crooper_selection {
    position: absolute;
    box-shadow: 0 0 0 1px #fff, 1px 1px 16px 8px #000000;
    cursor: move;
    box-sizing: border-box;
    overflow: hidden;
    display: none;
    grid-template-columns: 12px auto 12px;
    grid-template-rows: 12px auto 12px;
    gap: 0;
    z-index: 990;
}
.crooper_hadle {
    background-color: #ffffff70;
    border: 1px solid #00000070;
}
.crooper_hadle_bar{
    background-color: transparent;
    border: none;
}
	
	</style>
</head>
<body>
    <div id="mensajeTemporal" class="mensaje-temporal"></div>
    <!-- <button id="botonGrabar">Guardar</button> -->
    <!-- <button id="botonCambiar">Cambiar de Entorno</button> -->
    <!-- <button id="botonNuevoEntorno">Nuevo Entorno</button> -->
    <span id="marcador"></span>
    <div class="central">
        <div class="sidebar" tabindex="0">
            <div class="cabecera">
                <span>CONTENIDO</span>
                <div class="botones">
                    <span>
                        <span class="nuevaCarpeta" title="Crear Carpeta">
                            <svg viewBox="0 0 24 24" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M12 19h-7a2 2 0 0 1 -2 -2v-11a2 2 0 0 1 2 -2h4l3 3h7a2 2 0 0 1 2 2v3.5" />
                                <path d="M16 19h6" />
                                <path d="M19 16v6" />
                            </svg>    
                        </span>   
                        <span class="nuevoEntorno" title="Crear Entorno">
                            <svg viewBox="0 0 24 24" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                <path d="M14 3v4a1 1 0 0 0 1 1h4" />
                                <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
                                <path d="M12 11l0 6" />
                                <path d="M9 14l6 0" />
                              </svg>
                        </span>    
                        <span class="eliminar" title="Eliminar">
                            <svg viewBox="0 0 24 24" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z" />
                                <path d="M10 10l4 4m0 -4l-4 4" />
                              </svg>    
                        </span>     
                    </span>
                </div>
            </div>
            <div class="arbol" tabindex="0"></div>
        </div>
        <div class="resizer"></div>
        <div class="main" id="main">
            <div class="entorno sinEntornoCreado oculto" id="000">
                <h1>No existe ningún entorno todavía</h1>
                <h3>Pulsa botón "Nuevo Entorono" o Usa el explorador (ctrl + b)</h3>
                <h3>Una vez creado el entorno, crea elementos con clic derecho</h3>
            </div>
        </div>
    </div>

    <template id="dibujoTemplate">
        <div class="dibujo dimensionNormal">
            <div class="menu menuDesplegable oculto activo" style="z-index: 999;">
                <button class="opcionMenu vista">Vista</button>
                <button class="opcionMenu pegarImagen">Pegar Imagen</button>
                <button class="opcionMenu eliminar">Eliminar</button>
            </div>
            <div class="dibujoCabecera">
                <div class="canvasHerramientas">
                    <button class="limpiar" title="borrar todo">
                        <svg stroke-width="0.00473" viewBox="34.25 -0.03 404.48 473.03"> <g> <path d="m324.29,215.01l0,-87.01l20,0l0,-90l-98.39,0l0,-38l-113.23,0l0,38l-98.39,0l0,90l20,0l0,305l161.53,0c23.58,24.63 56.76,40 93.47,40c71.37,0 129.43,-58.06 129.43,-129.43c0,-66.29 -50.1,-121.1 -114.42,-128.56zm-30,0c-18.06,2.1 -34.99,7.92 -50,16.67l0,-103.68l50,0l0,87.01zm-131.62,-185.01l53.23,0l0,8l-53.23,0l0,-8zm-98.39,38l250,0l0,30l-250,0l0,-30zm20,60l50,0l0,275l-50,0l0,-275zm80,275l0,-275l50,0l0,127.77c-21.35,23.09 -34.42,53.94 -34.42,87.8c0,21.41 5.23,41.62 14.47,59.43l-30.05,0zm145.01,40c-54.83,0 -99.43,-44.6 -99.43,-99.43s44.6,-99.43 99.43,-99.43s99.43,44.61 99.43,99.43s-44.61,99.43 -99.43,99.43z" id="svg_2"></path>                                <polygon id="svg_3" points="342.248,289.395 309.285,322.358 276.323,289.395 255.11,310.608 288.073,343.571 255.11,376.533 276.323,397.746 309.285,364.783 342.248,397.746 363.461,376.533 330.498,343.571 363.461,310.608 "></polygon></g></svg>                        
                    </button>
                    <button class="deshacer" title="deshacer">
                        <svg viewBox="19 21.47 38.42 39.48"> <path  fill-opacity="1" stroke-width="0.2" stroke-linejoin="round" d="M 52.7514,25.076C 53.4111,25.7534 54.0258,26.4933 54.5953,27.296C 55.1649,28.0987 55.6564,28.9607 56.0698,29.8821C 56.4832,30.8035 56.8065,31.7766 57.0396,32.8014C 57.2727,33.8262 57.3892,34.8883 57.3892,35.9878C 57.3892,37.0566 57.276,38.1517 57.0495,39.2733C 56.823,40.3948 56.4491,41.5394 55.928,42.7071C 55.4068,43.8748 54.713,45.07 53.8465,46.2927C 52.9801,47.5154 51.9069,48.7601 50.6271,50.0267C 50.2137,50.4358 49.7431,50.902 49.2153,51.4253C 48.6875,51.9487 48.1278,52.5029 47.5363,53.0878C 46.9447,53.6728 46.34,54.2742 45.722,54.8922C 45.1041,55.5101 44.4983,56.1072 43.9045,56.6833C 42.5323,58.0424 41.1029,59.4586 39.6163,60.9319L 35.3545,56.6239C 36.8235,55.1638 38.2441,53.7542 39.6163,52.3951C 40.1969,51.819 40.7994,51.2252 41.424,50.6139C 42.0485,50.0025 42.6565,49.4011 43.2481,48.8095C 43.8396,48.218 44.3993,47.6605 44.9271,47.1371C 45.4549,46.6138 45.9255,46.1476 46.3389,45.7385C 48.0146,44.0584 49.2758,42.3904 50.1224,40.7345C 50.969,39.0786 51.3924,37.4678 51.3924,35.9021C 51.3924,34.719 51.1516,33.5777 50.67,32.4781C 50.1884,31.3786 49.4528,30.3406 48.4632,29.3642C 48.2169,29.1179 47.9112,28.8848 47.5462,28.6649C 47.1811,28.445 46.7688,28.2526 46.3092,28.0877C 45.8496,27.9227 45.3482,27.7886 44.805,27.6852C 44.2619,27.5819 43.6868,27.5302 43.0799,27.5302C 42.4641,27.5302 41.8198,27.5929 41.1469,27.7182C 40.474,27.8436 39.7933,28.0503 39.105,28.3384C 38.4167,28.6264 37.7218,29.0036 37.0203,29.4698C 36.3188,29.936 35.6316,30.5056 34.9587,31.1785L 30.466,35.6976L 37.4986,42.75L 19,42.75L 19,24.5417L 25.9931,31.4094L 30.5056,26.8705C 31.5083,25.7446 32.5463,24.8275 33.6194,24.1194C 34.6926,23.4113 35.7646,22.8616 36.8356,22.4701C 37.9065,22.0787 38.972,21.8148 40.0319,21.6785C 41.0919,21.5421 42.1079,21.474 43.0799,21.474C 44.087,21.474 45.0579,21.563 45.9925,21.7411C 46.9271,21.9193 47.8068,22.17 48.6314,22.4932C 49.4561,22.8165 50.2148,23.198 50.9075,23.6378C 51.6002,24.0777 52.2148,24.5571 52.7514,25.076 Z "></path></svg>
                    </button>
                    <button class="rehacer" title="rehacer">
                        <svg viewBox="19 21.47 38.42 39.48" transform="rotate(0)matrix(-1, 0, 0, 1, 0, 0)"> <path  fill-opacity="1" stroke-width="0.2" stroke-linejoin="round" d="M 52.7514,25.076C 53.4111,25.7534 54.0258,26.4933 54.5953,27.296C 55.1649,28.0987 55.6564,28.9607 56.0698,29.8821C 56.4832,30.8035 56.8065,31.7766 57.0396,32.8014C 57.2727,33.8262 57.3892,34.8883 57.3892,35.9878C 57.3892,37.0566 57.276,38.1517 57.0495,39.2733C 56.823,40.3948 56.4491,41.5394 55.928,42.7071C 55.4068,43.8748 54.713,45.07 53.8465,46.2927C 52.9801,47.5154 51.9069,48.7601 50.6271,50.0267C 50.2137,50.4358 49.7431,50.902 49.2153,51.4253C 48.6875,51.9487 48.1278,52.5029 47.5363,53.0878C 46.9447,53.6728 46.34,54.2742 45.722,54.8922C 45.1041,55.5101 44.4983,56.1072 43.9045,56.6833C 42.5323,58.0424 41.1029,59.4586 39.6163,60.9319L 35.3545,56.6239C 36.8235,55.1638 38.2441,53.7542 39.6163,52.3951C 40.1969,51.819 40.7994,51.2252 41.424,50.6139C 42.0485,50.0025 42.6565,49.4011 43.2481,48.8095C 43.8396,48.218 44.3993,47.6605 44.9271,47.1371C 45.4549,46.6138 45.9255,46.1476 46.3389,45.7385C 48.0146,44.0584 49.2758,42.3904 50.1224,40.7345C 50.969,39.0786 51.3924,37.4678 51.3924,35.9021C 51.3924,34.719 51.1516,33.5777 50.67,32.4781C 50.1884,31.3786 49.4528,30.3406 48.4632,29.3642C 48.2169,29.1179 47.9112,28.8848 47.5462,28.6649C 47.1811,28.445 46.7688,28.2526 46.3092,28.0877C 45.8496,27.9227 45.3482,27.7886 44.805,27.6852C 44.2619,27.5819 43.6868,27.5302 43.0799,27.5302C 42.4641,27.5302 41.8198,27.5929 41.1469,27.7182C 40.474,27.8436 39.7933,28.0503 39.105,28.3384C 38.4167,28.6264 37.7218,29.0036 37.0203,29.4698C 36.3188,29.936 35.6316,30.5056 34.9587,31.1785L 30.466,35.6976L 37.4986,42.75L 19,42.75L 19,24.5417L 25.9931,31.4094L 30.5056,26.8705C 31.5083,25.7446 32.5463,24.8275 33.6194,24.1194C 34.6926,23.4113 35.7646,22.8616 36.8356,22.4701C 37.9065,22.0787 38.972,21.8148 40.0319,21.6785C 41.0919,21.5421 42.1079,21.474 43.0799,21.474C 44.087,21.474 45.0579,21.563 45.9925,21.7411C 46.9271,21.9193 47.8068,22.17 48.6314,22.4932C 49.4561,22.8165 50.2148,23.198 50.9075,23.6378C 51.6002,24.0777 52.2148,24.5571 52.7514,25.076 Z "></path></svg>
                    </button>
                    <button class="cambiarFondo" title="color de fondo">
                        <svg viewBox="1 1 30.42 30"><g> <line x1="16" y1="3" x2="16" y2="29"></line> <path  d="M16,23c-3.87,0-7-3.13-7-7s3.13-7,7-7"></path> <line x1="6.81" y1="6.81" x2="8.93" y2="8.93"></line> <line x1="3" y1="16" x2="6" y2="16"></line> <line x1="6.81" y1="25.19" x2="8.93" y2="23.07"></line> <path d="M16,12.55C17.2,10.43,19.48,9,22.09,9c0.16,0,0.31,0.01,0.47,0.02c-1.67,0.88-2.8,2.63-2.8,4.64 c0,2.9,2.35,5.25,5.25,5.25c1.6,0,3.03-0.72,3.99-1.85C28.48,20.43,25.59,23,22.09,23c-2.61,0-4.89-1.43-6.09-3.55"></path> </g></svg>
                    </button>
                    <button class="cuadricula" title="cuadrícula">
                        <svg stroke-width="1.5" fill="none" stroke-linecap="round"><path d="M3 7h18 M3 15h18 M7 3v18 M15 3v18" /></svg>
                    </button>
                    <button class="dimensiones" title="maximizar">
                        <svg viewBox="0 0 24 24" stroke-width="2" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 4l4 0l0 4" /><path d="M14 10l6 -6" /><path d="M8 20l-4 0l0 -4" /><path d="M4 20l6 -6" /><path d="M16 20l4 0l0 -4" /><path d="M14 14l6 6" /><path d="M8 4l-4 0l0 4" /><path d="M4 4l6 6" /></svg>
                    </button>
                    <button class="aumentoH" title="aumentar área">
                        <svg width="44" height="44" viewBox="0 0 24 24" stroke-width="2" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 12l-10 0" /><path d="M14 12l-4 4" /><path d="M14 12l-4 -4" /><path d="M20 4l0 16" /></svg>
                    </button>
                    <button class="aumentoV" title="aumentar área">
                        <svg viewBox="0 0 24 24" stroke-width="2" stroke="#000000" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20l16 0" /><path d="M12 14l0 -10" /><path d="M12 14l4 -4" /><path d="M12 14l-4 -4" /></svg>
                    </button>
                    <input type="number" class="grosor" title="grosor del trazo" min="1" max="12" step="1" value="2">
                    <div class="dibujo-currentColor" title="color actual"></div>
                    <div class="dibujo-lastColors" title="últimos colores"></div>
                    <div class="dibujo-palette" title="paleta de colores">
                            <svg width="24px" height="24px" viewBox="0 0 16 16" fill="#000000"><g stroke-width="0"></g><g stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><rect style="opacity:1;fill:#373737;fill-opacity:1;stroke:none;stroke-width:3.20000005;stroke-linecap:square;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:3.20000005;stroke-opacity:1" id="rect1290" width="16" height="16" x="0" y="0"></rect><rect y="1" x="1" height="4.0000005" width="4.0000005" id="rect6829-4" style="display:inline;fill:#5da1f3;fill-opacity:1;stroke:none;stroke-width:1.15467715"></rect><rect style="display:inline;fill:#5dd3f3;fill-opacity:1;stroke:none;stroke-width:1.15467715" id="rect6831-7" width="4.0000005" height="4.0000005" x="6" y="1"></rect><rect y="1" x="11" height="4.0000005" width="4.0000005" id="rect6833-1" style="display:inline;fill:#5df3e3;fill-opacity:1;stroke:none;stroke-width:1.15467715"></rect><rect style="display:inline;fill:#f35d5d;fill-opacity:1;stroke:none;stroke-width:1.15466905" id="rect6835-3" width="4.0000005" height="3.999944" x="1" y="6"></rect><rect y="11" x="1" height="4.0000005" width="4.0000005" id="rect6837-2" style="display:inline;fill:#f3c05d;fill-opacity:1;stroke:none;stroke-width:1.15467715"></rect><rect y="6" x="6" height="3.999944" width="4.0000005" id="rect6839-1" style="display:inline;fill:#f35d99;fill-opacity:1;stroke:none;stroke-width:1.15466905"></rect><rect style="display:inline;fill:#d55df3;fill-opacity:1;stroke:none;stroke-width:1.15466905" id="rect6841-6" width="4.0000005" height="3.999944" x="11" y="6"></rect><rect style="display:inline;fill:#d5f35d;fill-opacity:1;stroke:none;stroke-width:1.15467715" id="rect6843-3" width="4.0000005" height="4.0000005" x="6" y="11"></rect><rect y="11" x="11" height="4.0000005" width="4.0000005" id="rect6845-8" style="display:inline;fill:#8bf35d;fill-opacity:1;stroke:none;stroke-width:1.15467715"></rect></g></svg>
                            <div class="dibujo-gridPalette"></div>
                    </div>
                    <!-- <div class="color-selector">
                        <label class="color-circle" style="background-color: #0000ff;"><input type="radio" name="color" value="#0000ff" style="display: none;" checked></label>
                        <label class="color-circle" style="background-color: #ff0000;"><input type="radio" name="color" value="#ff0000" style="display: none;"></label>                
                         <label class="color-circle" style="background-color: #00ff00;"><input type="radio" name="color" value="#00ff00" style="display: none;"></label>
                        <label class="color-circle" style="background-color: #ffff00;"><input type="radio" name="color" value="#ffff00" style="display: none;"></label>
                        <label class="color-circle" style="background-color: #ff00ff;"><input type="radio" name="color" value="#ff00ff" style="display: none;"></label>
                        <label class="color-circle" style="background-color: #00ffff;"><input type="radio" name="color" value="#00ffff" style="display: none;"></label> 
                    </div> -->
                    <!-- <button class="paleta-color">
                        <svg viewBox="0 0 16 16" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><metadata id="metadata6196"><rdf:rdf><cc:work><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"></dc:type><dc:title></dc:title><dc:date>2021</dc:date><dc:creator><cc:agent><dc:title>Timothée Giet</dc:title></cc:agent></dc:creator><cc:license rdf:resource="http://creativecommons.org/licenses/by-sa/4.0/"></cc:license></cc:work><cc:license rdf:about="http://creativecommons.org/licenses/by-sa/4.0/"><cc:permits rdf:resource="http://creativecommons.org/ns#Reproduction"></cc:permits><cc:permits rdf:resource="http://creativecommons.org/ns#Distribution"></cc:permits><cc:requires rdf:resource="http://creativecommons.org/ns#Notice"></cc:requires><cc:requires rdf:resource="http://creativecommons.org/ns#Attribution"></cc:requires><cc:permits rdf:resource="http://creativecommons.org/ns#DerivativeWorks"></cc:permits><cc:requires rdf:resource="http://creativecommons.org/ns#ShareAlike"></cc:requires></cc:license></rdf:rdf></metadata><rect style="opacity:1;vector-effect:none;fill:#373737;fill-opacity:1;stroke:none;stroke-width:3.20000005;stroke-linecap:square;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:3.20000005;stroke-opacity:1" id="rect1290" width="16" height="16" x="0" y="0"></rect><rect y="1" x="1" height="4.0000005" width="4.0000005" id="rect6829-4" style="display:inline;fill:#5da1f3;fill-opacity:1;stroke:none;stroke-width:1.15467715"></rect><rect style="display:inline;fill:#5dd3f3;fill-opacity:1;stroke:none;stroke-width:1.15467715" id="rect6831-7" width="4.0000005" height="4.0000005" x="6" y="1"></rect><rect y="1" x="11" height="4.0000005" width="4.0000005" id="rect6833-1" style="display:inline;fill:#5df3e3;fill-opacity:1;stroke:none;stroke-width:1.15467715"></rect><rect style="display:inline;fill:#f35d5d;fill-opacity:1;stroke:none;stroke-width:1.15466905" id="rect6835-3" width="4.0000005" height="3.999944" x="1" y="6"></rect><rect y="11" x="1" height="4.0000005" width="4.0000005" id="rect6837-2" style="display:inline;fill:#f3c05d;fill-opacity:1;stroke:none;stroke-width:1.15467715"></rect><rect y="6" x="6" height="3.999944" width="4.0000005" id="rect6839-1" style="display:inline;fill:#f35d99;fill-opacity:1;stroke:none;stroke-width:1.15466905"></rect><rect style="display:inline;fill:#d55df3;fill-opacity:1;stroke:none;stroke-width:1.15466905" id="rect6841-6" width="4.0000005" height="3.999944" x="11" y="6"></rect><rect style="display:inline;fill:#d5f35d;fill-opacity:1;stroke:none;stroke-width:1.15467715" id="rect6843-3" width="4.0000005" height="4.0000005" x="6" y="11"></rect><rect y="11" x="11" height="4.0000005" width="4.0000005" id="rect6845-8" style="display:inline;fill:#8bf35d;fill-opacity:1;stroke:none;stroke-width:1.15467715"></rect></g></svg>
                    </button> -->
                    <label class="labelColorInput" title="selector de colores" ><input type="color" class="colorInput" style="visibility: hidden; opacity: 0; width: 0; height: 0"></label>
                    <button class="lupa" title="capturar color">
                        <svg viewBox="0 0 32 32"><g> <path d="M27.7,3.3c-1.5-1.5-3.9-1.5-5.4,0L17,8.6l-1.3-1.3c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l1.3,1.3L5,20.6 c-0.6,0.6-1,1.4-1.1,2.3C3.3,23.4,3,24.2,3,25c0,1.7,1.3,3,3,3c0.8,0,1.6-0.3,2.2-0.9C9,27,9.8,26.6,10.4,26L21,15.4l1.3,1.3 c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L22.4,14l5.3-5.3C29.2,7.2,29.2,4.8,27.7,3.3z M9,24.6 c-0.4,0.4-0.8,0.6-1.3,0.5c-0.4,0-0.7,0.2-0.9,0.5C6.7,25.8,6.3,26,6,26c-0.6,0-1-0.4-1-1c0-0.3,0.2-0.7,0.5-0.8 c0.3-0.2,0.5-0.5,0.5-0.9c0-0.5,0.2-1,0.5-1.3L17,11.4l2.6,2.6L9,24.6z"></path> </g></svg>
                    </button>
                    <button class="seleccionar" title="seleccionar elementos">
                        <svg fill="none" viewBox="3.27 0.18 18.05 23.63"><g fill="none"> <path d="M7.5 12L5.49591 14.6721C4.91845 15.4421 4.97127 16.5141 5.6216 17.2236L9.4055 21.3515C9.78431 21.7647 10.3183 22 10.8789 22C11.9651 22 13.7415 22 15.5 22C17.9 22 19.5 20 19.5 18C19.5 18 19.5 18 19.5 18C19.5 18 19.5 11.1429 19.5 9.42859" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M16.5 9.99995C16.5 9.99995 16.5 9.87483 16.5 9.42852C16.5 7.1428 19.5 7.1428 19.5 9.42852" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M13.5 9.99998C13.5 9.99998 13.5 9.17832 13.5 8.2857C13.5 5.99998 16.5 5.99998 16.5 8.2857C16.5 8.50885 16.5 9.2054 16.5 9.42855C16.5 9.87487 16.5 9.99998 16.5 9.99998" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M10.5 10.0001C10.5 10.0001 10.5 8.61584 10.5 7.50005C10.5 5.21434 13.5 5.21434 13.5 7.50005C13.5 7.50005 13.5 7.50005 13.5 7.50005C13.5 7.50005 13.5 8.06261 13.5 8.28577C13.5 9.17839 13.5 10.0001 13.5 10.0001" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M10.5 10C10.5 10 10.5 8.61578 10.5 7.5C10.5 6.34156 10.5 4.68968 10.5 3.49899C10.5 2.67056 9.82843 2 9 2V2C8.17157 2 7.5 2.67157 7.5 3.5V12V15" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                    </button>
                    <button class="lapiz" title="mano alzada">
                        <svg viewBox="7 1.13 10 21.9" class="marcado"><g ><path stroke-width="1" d="M12.394 1.154h-.788l-4.574 12.17L7 23h1v-8.292l1.498 1.499 2.502-2.5 2.499 2.5 1.501-1.5V23h1v-9.5zM12 2.95L13.147 6h-2.294zm0 9.344l-2.502 2.5-1.417-1.418L10.477 7h3.046l2.396 6.374-1.42 1.419z"></path></g></svg>            
                    </button>
                    <button class="borrador">
                        <svg  viewBox="0.13 -28.38 557.77 540.83"><g id="base" transform="translate(0,-540.36219)"> <path  d="m 338.76367,578.92612 148.25878,123.01999 c 12.78743,10.61057 14.53806,29.44624 3.92517,42.23243 L 312.10496,959.64465 c -17.3194,15.8938 -96.44756,23.22811 -117.54045,2.99071 L 91.97017,876.25805 C 79.259029,865.55614 77.432098,846.81181 88.044982,834.02562 L 296.52482,582.85324 c 10.61288,-12.78619 29.45142,-14.53769 42.23885,-3.92712 z"></path>    <rect style="opacity: 1;fill-opacity: 1;"  width="367.39352" height="25.711227" x="0.13772964" y="1027.0753"></rect><path style="fill: rgb(0, 0, 0); fill-opacity: 0.5"d="m 344.97498,582.49293 135.37673,115.03875 c 12.6466,10.74667 14.39592,29.76299 3.92221,42.6375 L 381.24318,866.81692 187.35744,725.83714 303.2416,586.33378 c 10.60501,-12.76652 29.08678,-14.58751 41.73338,-3.84085 z"></path>  </g></svg>
                    </button>
                    <button class="destacador" title="destacador">
                        <svg transform="rotate(270)" viewBox="0 0 24 24" ><g ></g><g></g><g > <path  stroke-width="0" d="M4.56681 3.09871C4.91328 2.93219 5.32452 2.979 5.6247 3.21914L10.4679 7.09367L17.2747 9.03849C17.4381 9.08517 17.5869 9.17273 17.7071 9.2929L20.7071 12.2929C21.0976 12.6834 21.0976 13.3166 20.7071 13.7071C20.3166 14.0976 19.6834 14.0976 19.2929 13.7071L17 11.4142L10.4142 18L12.7071 20.2929C13.0976 20.6834 13.0976 21.3166 12.7071 21.7071C12.3166 22.0977 11.6834 22.0977 11.2929 21.7071L8.29289 18.7071C8.17272 18.5869 8.08516 18.4381 8.03848 18.2747L6.10966 11.5239L4.2929 9.70713C4.10537 9.51959 4.00001 9.26524 4.00001 9.00002L4 4.00001C4 3.61561 4.22034 3.26523 4.56681 3.09871ZM8.12317 11.2911L9.49463 16.0912L15.0912 10.4946L10.291 9.12318L8.12317 11.2911ZM8.50287 8.08293L6 6.08064L6.00001 8.58581L7 9.5858L8.50287 8.08293Z" ></path> </g></svg>                        
                    </button>
                    <button class="texto" title="escritura con teclado">
                        <svg viewBox="5.12 3.58 45.77 48.82"><g><path d="M 35.5702 52.3984 L 49.2580 52.3984 C 50.3125 52.3984 50.8751 51.8828 50.8751 51.0156 C 50.8751 50.1250 50.3125 49.6563 49.2580 49.6563 L 43.9843 49.6563 L 43.9843 6.3203 L 49.2580 6.3203 C 50.3125 6.3203 50.8751 5.8281 50.8751 4.9375 C 50.8751 4.0703 50.3125 3.6016 49.2580 3.6016 L 35.5702 3.6016 C 34.4921 3.6016 33.9531 4.0703 33.9531 4.9375 C 33.9531 5.8281 34.4921 6.3203 35.5702 6.3203 L 40.8202 6.3203 L 40.8202 49.6563 L 35.5702 49.6563 C 34.4921 49.6563 33.9531 50.1250 33.9531 51.0156 C 33.9531 51.8828 34.4921 52.3984 35.5702 52.3984 Z M 18.8593 45.3672 C 20.1952 45.3672 21.0858 44.5234 21.0858 43.1641 L 21.0858 15.2500 L 30.6015 15.2500 C 31.7734 15.2500 32.6171 14.4766 32.6171 13.2812 C 32.6171 12.0859 31.7734 11.3125 30.6015 11.3125 L 7.1640 11.3125 C 5.9687 11.3125 5.1249 12.0859 5.1249 13.2812 C 5.1249 14.4766 5.9687 15.2500 7.1640 15.2500 L 16.6796 15.2500 L 16.6796 43.1641 C 16.6796 44.5234 17.5233 45.3672 18.8593 45.3672 Z"></path></g></svg>
                    </button>
                    <button class="recorte" title="recortar área">
                        <svg viewBox="0 0 309.694 309.694" transform="rotate(270)"><g > <g> <path d="M169.941,182.463l125.645,40.038c1.703,0.543,3.566,0.102,4.846-1.145c1.28-1.248,1.767-3.1,1.268-4.816 c-5.93-20.375-21.613-36.46-41.832-42.903l-103.221-32.893l-8.899-27.925c0.832-0.193,1.656-0.416,2.472-0.676 c20.449-6.517,30.154-31.434,22.095-56.726c-7.803-24.488-30.171-40.075-50.842-33.485c-19.629,6.254-30.345,30.837-22.096,56.728 c0.017,0.052,0.035,0.102,0.052,0.153l15.499,48.637l-48.583-15.481c-0.069-0.022-0.137-0.048-0.206-0.07 c-24.616-7.844-50.126,1.376-56.729,22.097c-6.516,20.449,8.193,42.781,33.485,50.841c24.63,7.848,50.126-1.384,56.727-22.095 c0.262-0.821,0.477-1.646,0.671-2.472l27.929,8.899l22.001,69.042h37.483L169.941,182.463z M76.755,155.453 c-2.157,6.771-14.017,10.517-26.572,6.515c-13.105-4.176-19.955-14.255-17.905-20.688c2.154-6.763,14.004-10.52,26.574-6.516 C71.957,138.94,78.805,149.019,76.755,155.453z M128.76,44.799c6.577-2.101,16.574,4.996,20.688,17.905 c4.176,13.104-0.082,24.521-6.515,26.571c-6.595,2.106-16.585-5.024-20.688-17.903C118.267,58.891,121.972,46.962,128.76,44.799z M151.869,164.391c-3.945,3.945-10.343,3.945-14.288,0c-3.946-3.946-3.946-10.343,0-14.289c3.945-3.945,10.343-3.945,14.288,0 C155.816,154.048,155.816,160.444,151.869,164.391z"></path> <path d="M56.5,264.278H19.904H12.5c-6.903,0-12.5,5.597-12.5,12.5c0,6.903,5.597,12.5,12.5,12.5h7.404H56.5 c6.903,0,12.5-5.597,12.5-12.5C69,269.875,63.403,264.278,56.5,264.278z"></path> <path d="M136.732,264.278h-44c-6.903,0-12.5,5.597-12.5,12.5c0,6.903,5.597,12.5,12.5,12.5h44c6.903,0,12.5-5.597,12.5-12.5 C149.232,269.875,143.635,264.278,136.732,264.278z"></path> <path d="M216.963,264.278h-44c-6.903,0-12.5,5.597-12.5,12.5c0,6.903,5.597,12.5,12.5,12.5h44c6.903,0,12.5-5.597,12.5-12.5 C229.463,269.875,223.866,264.278,216.963,264.278z"></path> <path d="M301.893,265.199c-1.451-0.589-3.035-0.921-4.698-0.921h-44c-6.903,0-12.5,5.597-12.5,12.5c0,6.903,5.597,12.5,12.5,12.5 h44c1.663,0,3.247-0.332,4.698-0.921c4.573-1.858,7.802-6.339,7.802-11.579C309.694,271.538,306.466,267.058,301.893,265.199z"></path> </g> </g></svg>
                    </button>
                    <button class="puntero" title="puntero">
                        <svg fill="#000000"viewBox="0 0 512 512"><g><path d="M494.638,17.347c-23.122-23.121-60.752-23.114-83.884,0.017L333.897,94.22c-0.002,0.003-0.005,0.005-0.007,0.007 c-0.003,0.003-0.005,0.005-0.007,0.007L61.317,366.803c-1.636,1.634-2.645,3.791-2.855,6.093l-6.988,76.879 c-0.265,2.922,0.779,5.811,2.855,7.884c1.86,1.863,4.38,2.896,6.988,2.896c0.297,0,0.596-0.015,0.895-0.041l76.879-6.988 c2.302-0.21,4.459-1.219,6.093-2.855l20.958-20.958c0.003-0.002,0.007-0.005,0.012-0.01c0.005-0.005,0.007-0.01,0.01-0.012 l328.458-328.457C505.822,90.033,511.993,75.14,512,59.295C512.005,43.446,505.839,28.549,494.638,17.347z M133.736,434.161 l-61.502,5.591l5.591-61.502l11.45-11.45l55.911,55.911L133.736,434.161z M159.163,408.735l-55.911-55.911l237.627-237.628 l55.914,55.911L159.163,408.735z M480.644,87.255l-69.876,69.875l-55.911-55.911l69.873-69.875 c15.429-15.422,40.516-15.432,55.931-0.017c7.464,7.465,11.573,17.395,11.571,27.962 C492.227,69.855,488.113,79.787,480.644,87.255z"></path> </g> </g> <g> <g> <path d="M47.338,464.649c-3.861-3.861-10.12-3.861-13.977,0L2.896,495.116c-3.861,3.858-3.861,10.118,0,13.977 c1.931,1.93,4.459,2.896,6.989,2.896c2.529,0,5.06-0.965,6.988-2.896l30.465-30.468C51.199,474.767,51.199,468.507,47.338,464.649 z"></path> </g> </g> <g> <g> <path d="M466.682,45.304c-3.856-3.858-10.12-3.858-13.976,0l-62.902,62.902c-3.861,3.861-3.861,10.118,0,13.979 c1.928,1.929,4.459,2.894,6.989,2.894c2.529,0,5.06-0.965,6.988-2.894l62.902-62.902 C470.543,55.422,470.543,49.165,466.682,45.304z"></path> </g> </svg>
                    </button>
                    <button class="linea" title="linea recta">
                        <svg stroke-width="0.00024000000000000003" viewBox="2.98 2.98 18.03 18.03"><g stroke-width="0"></g><g  stroke-linecap="round" stroke-linejoin="round"></g> <path fill-rule="evenodd" clip-rule="evenodd" d="M18 5C17.4477 5 17 5.44772 17 6C17 6.27642 17.1108 6.52505 17.2929 6.70711C17.475 6.88917 17.7236 7 18 7C18.5523 7 19 6.55228 19 6C19 5.44772 18.5523 5 18 5ZM15 6C15 4.34315 16.3431 3 18 3C19.6569 3 21 4.34315 21 6C21 7.65685 19.6569 9 18 9C17.5372 9 17.0984 8.8948 16.7068 8.70744L8.70744 16.7068C8.8948 17.0984 9 17.5372 9 18C9 19.6569 7.65685 21 6 21C4.34315 21 3 19.6569 3 18C3 16.3431 4.34315 15 6 15C6.46278 15 6.90157 15.1052 7.29323 15.2926L15.2926 7.29323C15.1052 6.90157 15 6.46278 15 6ZM6 17C5.44772 17 5 17.4477 5 18C5 18.5523 5.44772 19 6 19C6.55228 19 7 18.5523 7 18C7 17.7236 6.88917 17.475 6.70711 17.2929C6.52505 17.1108 6.27642 17 6 17Z" ></path> </svg>                    
                    </button>
                    <button class="rectangulo" title="rectángulo/cuadrado">
                        <svg viewBox="0 15 100.13 70.1"><g stroke-linecap="round" stroke-linejoin="round"></g><g><path d="M12.55 15C5.662 15 0 20.661 0 27.55c0 6.017 4.317 11.096 10 12.286v20.428c-5.683 1.19-10 6.27-10 12.287C0 79.44 5.661 85.1 12.55 85.1c6.047 0 11.09-4.374 12.241-10.1h50.455c1.152 5.732 6.253 10.1 12.305 10.1c6.65 0 12.105-5.288 12.478-11.852a3.5 3.5 0 0 0 .07-.697a3.5 3.5 0 0 0-.07-.697C99.703 66.117 95.495 61.356 90 60.246V39.854c5.495-1.11 9.703-5.87 10.03-11.606a3.5 3.5 0 0 0 .07-.697a3.5 3.5 0 0 0-.07-.697C99.655 20.29 94.201 15 87.55 15c-6.016 0-11.096 4.317-12.286 10H24.77c-1.19-5.676-6.209-10-12.22-10zm0 7c3.107 0 5.55 2.444 5.55 5.55c0 3.107-2.443 5.55-5.55 5.55C9.445 33.1 7 30.657 7 27.55C7 24.445 9.444 22 12.55 22zm75 0c3.107 0 5.55 2.444 5.55 5.55c0 3.107-2.443 5.55-5.55 5.55c-3.106 0-5.55-2.443-5.55-5.55c0-3.106 2.444-5.55 5.55-5.55zM24.218 32h51.62A12.678 12.678 0 0 0 83 39.225v21.65A12.684 12.684 0 0 0 75.875 68h-51.7A12.64 12.64 0 0 0 17 60.838V39.262A12.638 12.638 0 0 0 24.217 32zM12.55 67c3.106 0 5.549 2.444 5.549 5.55c0 3.107-2.443 5.55-5.55 5.55C9.445 78.1 7 75.657 7 72.55C7 69.445 9.444 67 12.55 67zm75 0c3.106 0 5.549 2.444 5.549 5.55c0 3.107-2.443 5.55-5.55 5.55c-3.106 0-5.55-2.443-5.55-5.55c0-3.106 2.444-5.55 5.55-5.55z"></path></g></svg>                    
                    </button>
                    <button class="elipse" title="elipse/círculo">
                        <svg viewBox="-2 13.25 92.35 61.82"><g> <path style="stroke-width: 4" d="M44.166,75.062C19.812,75.062,0,61.202,0,44.167C0,27.13,19.812,13.27,44.166,13.27c24.354,0,44.166,13.859,44.166,30.896 C88.332,61.204,68.52,75.062,44.166,75.062z M44.166,16.27C21.467,16.27,3,28.784,3,44.167c0,15.381,18.467,27.896,41.166,27.896 s41.166-12.515,41.166-27.896C85.332,28.785,66.865,16.27,44.166,16.27z M44.166,36.56L44.166,52.56 M36.166,45.56L52.166,45.56"></path> </g></svg>
                    </button> 
                    <button class="polilinea" title="polilínea">
                        <svg viewBox="0 11 100.13 78.13">><path d="M32.55 11C25.662 11 20 16.661 20 23.55c0 3.887 1.802 7.38 4.61 9.688L14.481 54.166a12.33 12.33 0 0 0-1.93-.166C5.66 54 0 59.661 0 66.55C0 73.44 5.661 79.1 12.55 79.1c6.652 0 12.106-5.288 12.48-11.852a3.5 3.5 0 0 0 .07-.697a3.5 3.5 0 0 0-.07-.697c-.196-3.441-1.797-6.522-4.225-8.684L31.049 36c.494.06.993.1 1.502.1c4.613 0 8.647-2.546 10.812-6.295l17.807 4.707c.934 5.845 5.95 10.384 12.002 10.568l7.006 21.356C77.052 68.726 75 72.412 75 76.55c0 6.89 5.661 12.55 12.55 12.55c6.652 0 12.106-5.288 12.48-11.852a3.5 3.5 0 0 0 .07-.697a3.5 3.5 0 0 0-.07-.697C99.655 69.29 94.201 64 87.55 64c-.266 0-.527.022-.79.04l-6.805-20.743c3.451-2.09 5.832-5.797 6.074-10.049a3.5 3.5 0 0 0 .07-.697a3.5 3.5 0 0 0-.07-.697C85.656 25.29 80.202 20 73.551 20c-5.1 0-9.519 3.106-11.475 7.512l-17.02-4.5a3.5 3.5 0 0 0-.027-.158C44.656 16.29 39.202 11 32.551 11zm0 7c3.107 0 5.55 2.444 5.55 5.55c0 3.107-2.443 5.55-5.55 5.55c-3.106 0-5.55-2.443-5.55-5.55c0-3.106 2.444-5.55 5.55-5.55zm41 9c3.107 0 5.55 2.444 5.55 5.55c0 3.107-2.443 5.55-5.55 5.55c-3.106 0-5.55-2.443-5.55-5.55c0-3.106 2.444-5.55 5.55-5.55zm-61 34c3.107 0 5.55 2.444 5.55 5.55c0 3.107-2.443 5.55-5.55 5.55C9.445 72.1 7 69.657 7 66.55C7 63.445 9.444 61 12.55 61zm75 10c3.107 0 5.55 2.444 5.55 5.55c0 3.107-2.443 5.55-5.55 5.55c-3.106 0-5.55-2.443-5.55-5.55c0-3.106 2.444-5.55 5.55-5.55z"></path></svg>
                    </button>
                    <button class="poligono" title="polígono">
                        <svg viewBox="-0.08 10.93 100.15 78.13"><path d="M32.5 10.95c-6.89 0-12.55 5.66-12.55 12.55c0 4.02 1.935 7.613 4.91 9.916L14.815 54.172a12.354 12.354 0 0 0-2.316-.223C5.61 53.95-.05 59.61-.05 66.5c0 6.89 5.66 12.55 12.55 12.55c5.13 0 9.54-3.151 11.463-7.603l51.277 7.71c1.232 5.629 6.281 9.894 12.26 9.894c6.656 0 12.114-5.297 12.48-11.867a3.5 3.5 0 0 0 .07-.684a3.5 3.5 0 0 0-.071-.7c-.375-6.562-5.829-11.85-12.479-11.85c-.134 0-.264.015-.396.019L80.242 43.05c3.275-2.127 5.509-5.746 5.738-9.867a3.5 3.5 0 0 0 .07-.684a3.5 3.5 0 0 0-.071-.7c-.375-6.562-5.829-11.85-12.479-11.85c-5.062 0-9.452 3.06-11.43 7.415l-17.082-4.517a3.5 3.5 0 0 0-.01-.047c-.374-6.563-5.828-11.852-12.478-11.852zm0 7c3.107 0 5.55 2.443 5.55 5.55c0 3.107-2.443 5.55-5.55 5.55c-3.107 0-5.55-2.443-5.55-5.55c0-3.107 2.443-5.55 5.55-5.55zm41 9c3.107 0 5.55 2.443 5.55 5.55c0 3.107-2.443 5.55-5.55 5.55c-3.107 0-5.55-2.443-5.55-5.55c0-3.107 2.443-5.55 5.55-5.55zm-30.137 2.708l17.739 4.69C62.007 40.37 67.239 45.05 73.5 45.05l.033-.002l6.92 21.092a12.688 12.688 0 0 0-4.705 6.015l-50.916-7.654a12.611 12.611 0 0 0-3.787-7.13l10.342-21.378c.368.033.737.057 1.113.057c4.652 0 8.71-2.592 10.863-6.393zM12.5 60.95c3.107 0 5.55 2.444 5.55 5.551s-2.443 5.55-5.55 5.55c-3.107 0-5.55-2.443-5.55-5.55c0-3.107 2.443-5.55 5.55-5.55zm75 10c3.107 0 5.55 2.444 5.55 5.551s-2.443 5.55-5.55 5.55c-3.107 0-5.55-2.443-5.55-5.55c0-3.107 2.443-5.55 5.55-5.55z"></path></svg>
                    </button>
                    <!-- <button class="recortar">
                    <svg style="rotate: 90deg;" viewBox="0 2.18 453.43 449.03"><g><path d="M437.671,383.799c-8.689,0-15.735,7.047-15.735,15.738v15.736h-15.737c-8.576,0-15.736,7.162-15.736,15.736 c0,8.576,7.16,15.738,15.736,15.738h31.474c8.691,0,15.736-7.047,15.736-15.738v-31.473 C453.407,390.846,446.362,383.799,437.671,383.799z"></path> <path d="M345.353,415.273h-41.96c-8.576,0-15.737,7.16-15.737,15.736s7.161,15.736,15.737,15.736h41.96 c8.576,0,15.736-7.16,15.736-15.736S353.93,415.273,345.353,415.273z"></path> <path d="M242.548,415.273h-15.737v-15.738c0-8.576-7.16-15.736-15.736-15.736s-15.736,7.16-15.736,15.736v31.475 c0,8.691,7.045,15.736,15.736,15.736h31.474c8.576,0,15.736-7.16,15.736-15.736S251.124,415.273,242.548,415.273z"></path> <path d="M211.074,207.507c8.691,0,15.736-7.045,15.736-15.736v-69.255c0-8.576-7.16-15.737-15.736-15.737 c-8.576,0-15.736,7.161-15.736,15.737v69.255C195.338,200.461,202.383,207.507,211.074,207.507z"></path> <path d="M242.548,6.049h-31.474c-8.691,0-15.736,7.046-15.736,15.737v31.474c0,8.576,7.16,15.737,15.736,15.737 c8.576,0,15.736-7.161,15.736-15.737V37.523h15.737c8.576,0,15.736-7.161,15.736-15.737 C258.284,13.21,251.124,6.049,242.548,6.049z"></path> <path d="M345.353,6.049h-41.96c-8.576,0-15.737,7.161-15.737,15.737s7.161,15.737,15.737,15.737h41.96 c8.576,0,15.736-7.161,15.736-15.737C361.09,13.21,353.93,6.049,345.353,6.049z"></path> <path d="M437.671,6.049h-31.474c-8.576,0-15.736,7.161-15.736,15.737s7.16,15.737,15.736,15.737h15.737v15.737 c0,8.576,7.159,15.737,15.735,15.737s15.736-7.161,15.736-15.737V21.787C453.407,13.096,446.362,6.049,437.671,6.049z"></path> <path d="M437.671,245.289c-8.689,0-15.735,7.045-15.735,15.736v69.256c0,8.575,7.159,15.736,15.735,15.736 s15.736-7.161,15.736-15.736v-69.256C453.407,252.334,446.362,245.289,437.671,245.289z"></path> <path d="M437.671,106.779c-8.689,0-15.735,7.046-15.735,15.737v69.255c0,8.576,7.159,15.736,15.735,15.736 s15.736-7.161,15.736-15.736v-69.255C453.407,113.825,446.362,106.779,437.671,106.779z"></path> <path d="M211.074,346.018c8.576,0,15.736-7.161,15.736-15.736v-69.256c0-8.576-7.16-15.736-15.736-15.736 c-8.576,0-15.736,7.16-15.736,15.736v69.256C195.338,338.856,202.498,346.018,211.074,346.018z"></path> <path d="M91.732,2.242c-1.746-0.232-3.484,0.377-4.688,1.666l-7.445,7.958c-2.915,3.08-5.655,6.765-8.62,11.574 c-6.101,9.895-12.552,25.061-8.648,41.056c1.053,4.324,2.902,8.053,4.68,11.652c0.287,0.579,0.577,1.158,0.86,1.733 l74.246,162.555l-31.105,49.535c-2.335-0.866-4.741-1.596-7.191-2.186c-4.381-1.066-8.896-1.701-13.412-1.885 c-26.594-1.1-54.353,13.605-71.959,37.786c-3.253,4.413-7.587,11.36-12.404,23.009c-3.145,8.344-5.104,17.008-5.778,25.67 c-1.173,15.053,1.521,29.631,7.784,42.141c6.785,13.574,17.956,24.467,31.452,30.689c7.829,3.598,16.199,5.604,24.885,5.961 c0,0,0,0,0.008,0c25.915,1.07,52.995-12.562,70.68-35.578c0.035-0.037,0.064-0.076,0.093-0.125l2.685-3.693 c6.616-9.494,11.575-20.299,14.386-31.332c0.021-0.045,0.027-0.094,0.04-0.141c0.877-3.902,1.128-5.172,1.207-5.67 c6.921-36.065,16.553-59.078,24.702-73.259l8.622-13.216V181.392L95.793,5.108C94.983,3.553,93.474,2.482,91.732,2.242z M93.959,396.098c-8.207,7.469-18.783,11.877-27.596,11.52c-4.07-0.174-7.823-1.318-11.14-3.396 c-0.009-0.004-0.015-0.008-0.018-0.014l-0.004-0.004c-7.742-4.848-12.124-14.652-11.719-26.213 c0.436-12.507,6.062-25.224,15.426-34.873c6.717-6.914,18.036-14.139,29.668-13.656c2.749,0.113,5.403,0.664,7.893,1.636 c11.511,4.521,15.392,17.485,15.222,27.228C111.447,372.098,104.817,386.217,93.959,396.098z"></path> </g></svg>
                    </button>
                    <button class="tijeras">
                        <svg viewBox="3.6 -0.03 504.8 512.05"><g> <g> <path d="M143.155,241.403c-5.379,0.154-11.094-0.285-14.076-2.271c-2.983-1.979-6.578-7.847-10.202-12.571 c-16.96-22.075-47.036-31.308-74.281-20.702c-33.079,12.87-49.447,50.13-36.57,83.201c12.877,33.079,50.122,49.454,83.201,36.577 c16.354-6.369,28.612-18.703,35.281-33.546c1.122-2.508,1.742-3.916,3.644-5.783c1.909-1.868,5.79-3.053,8.899-3.694 c18.257-3.77,33.594-3.902,46.429-1.958l2.258-6.104c0.725-2.028,5.15-14.473,11.686-32.785 C184.268,241.919,162.443,240.846,143.155,241.403z M80.511,298.125c-17.874,6.954-38.012-1.895-44.974-19.776 c-6.954-17.88,1.896-38.012,19.769-44.973c17.881-6.968,38.012,1.889,44.981,19.762C107.241,271.018,98.391,291.157,80.511,298.125 z"></path> <path d="M507.47,169.171c-3.777-9.714-15.386-10.788-44.151-3.31c-15.581,4.049-87.598,25.706-150.424,44.73 c-6.195,32.221-11.79,61.139-15.066,78.03c63.886-30.674,161.908-77.884,179.342-87.145 C503.429,187.525,511.261,178.884,507.47,169.171z"></path> <path d="M303.649,392.949c-5.073-3.114-11.282-6.076-13.568-8.836c-2.278-2.767-3.31-8.404-3.714-13.77 c-1.993-26.298-7.526-57.056-6.836-69.473c0,0,44.179-227.416,48.618-256.808c4.438-29.4,2.16-40.827-7.888-43.58 c-10.055-2.745-17.832,5.938-28.974,33.497c-11.135,27.567-88.824,245.812-88.824,245.812s51.175,20.298,43.336,98.929 c-0.314,3.15-1.087,7.136-2.746,9.226c-1.658,2.098-2.989,2.857-5.365,4.237c-14.069,8.167-25.058,21.651-29.685,38.583 c-9.365,34.235,10.801,69.578,45.029,78.944c34.242,9.358,69.585-10.808,78.943-45.043 C339.688,436.466,327.368,407.513,303.649,392.949z M243.749,280.28c-6.481-1.77-10.299-8.452-8.522-14.933 c1.77-6.48,8.452-10.299,14.933-8.529c6.481,1.777,10.292,8.466,8.522,14.94C256.912,278.238,250.223,282.049,243.749,280.28z M303.495,456.876c-5.059,18.507-24.166,29.406-42.674,24.347c-18.508-5.059-29.406-24.166-24.347-42.674 c5.059-18.508,24.173-29.406,42.674-24.34C297.656,419.262,308.554,438.375,303.495,456.876z"></path> </g> </g></svg>
                    </button> -->
                </div>
            </div>
            <div class="canvasContenedor"></div>
        </div>
    </template>

    <template id="entornoTemplate">
        <div class="entorno">
            <div class="menu menuDesplegable oculto activo" style="z-index: 999;">
                <div class="menuEntorno principal">
                    <button class="opcionMenu nuevo">Nuevo elemento</button>
                    <button class="opcionMenu eliminar">Eliminar</button>
                    <button class="opcionMenu personalizar">Personalizar</button>    
                </div>
                <div class="menuEntorno secundario oculto">
                    <button class="opcionMenu apunteNuevo">Apunte</button>
                    <button class="opcionMenu dibujoNuevo">Dibujo</button>
                    <button class="opcionMenu horarioClasesNuevo">Horario Clases</button>
                </div>
            </div>
            <div class="menu ventanaMenu entornoMenu oculto" style="z-index: 999;">
                <div>Personalizar este Entorno</div>
                <label>
                    Nombre:
                    <input type="text" class="nombre">
                </label>
                <label>
                    Descripción:
                    <textarea class="descripcion contenido" cols="20" rows="3" style="background-color: #ffffff;"></textarea>
                </label>
                <label>
                    Fondo:
                    <input type="color" class="fondo">
                </label>                
            </div>
        </div>
    </template>

    <template id="horarioTemplate">
        <div class="horarioClases">
            <div class="menu menuDesplegable oculto activo">
                <button class="opcionMenu duplicar">Duplicar</button>
                <button class="opcionMenu eliminar">Eliminar</button>
                <button class="opcionMenu aspecto">Color</button>
                <input type="range" class="slider sliderColor oculto" min="0" max="360" step="1" orient="horizontal">
            </div>
            <div class="horarioCabecera">Horario general</div>
            <div class="horarioTabla">
                <table>
                    <thead>
                      <tr>
                        <th></th>
                        <th>Lunes</th>
                        <th>Martes</th>
                        <th>Miércoles</th>
                        <th>Jueves</th>
                        <th>Viernes</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>15:30</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                      </tr>
                      <tr>
                        <td>16:45</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                      </tr>
                      <tr>
                        <td>18:00</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                      </tr>
                      <tr>
                        <td>19:15</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                      </tr>
                      <tr>
                        <td>20:30</td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                        <td contenteditable="true"></td>
                      </tr>
                    </tbody>
                </table>                
            </div>
        </div>
    </template>

    <template id="apunteTemplate">
        <div class="apunte">
            <div class="menu menuDesplegable oculto activo">
                <button class="opcionMenu vista">Vista</button>
                <button class="opcionMenu copiar">Copiar</button>
                <button class="opcionMenu duplicar">Duplicar</button>
                <button class="opcionMenu mover">Mover</button>
                <button class="opcionMenu eliminar">Eliminar</button>
                <button class="opcionMenu aspecto">Aspecto</button>
            </div>
            <div class="ventanaMenu oculto">
                <div class="vistaOpc"></div>
                <div class="aspectoOpc">
                    <div class="tituloMenu">ASPECTO</div>
                    <div class="contenidoMenu">
                        <button class="tab tabContenido primero activo">Contenido</button>
                        <div class="opcionesAspecto">
                            <div class="op1">
                                <span>Fondo: </span>
                                 <input type="color" class="colorFondoContenido">
                            </div>
                            <div class="op2">
                                <span>Texto: </span>
                                 <input type="color" class="colorTextoContenido">
                            </div>
                            <div class="op3">
                                <span>Tamaño: </span>
                                <input type="number" class="sizeContenido" name="sizeContenido" min="8" max="20" step="1" />
                            </div>
                            <div class="op4">
                                <span>Fuente:</span>
                                <select class="fuenteContenido">
                                    <option value="Arial" class="fuente-Arial">Arial</option>
                                    <option value="Times New Roman" class="fuente-TimesNewRoman">Times New Roman</option>
                                    <option value="Courier New" class="fuente-CourierNew">Courier New</option>
                                    <option value="Georgia" class="fuente-Georgia">Georgia</option>
                                    <option value="Impact" class="fuente-Impact">Impact</option>
                                    <option value="Lucida Sans Unicode" class="fuente-LucidaSansUnicode">Lucida Sans Unicode</option>
                                    <option value="Palatino Linotype" class="fuente-PalatinoLinotype">Palatino Linotype</option>
                                    <option value="Tahoma" class="fuente-Tahoma">Tahoma</option>
                                    <option value="Trebuchet MS" class="fuente-TrebuchetMS">Trebuchet MS</option>
                                    <option value="Verdana" class="fuente-Verdana">Verdana</option>
                                </select>
                            </div>
                        </div>
                        <button class="tab tabTitulo">Titulo</button>
                        <div class="opcionesAspecto">
                            <div>
                                <span>Vista: </span>
                                <select class="vistaTitulo">
                                    <option value="destacado">Destacado</option>
                                    <option value="integrado">Integrado</option>
                                    <option value="oculto">Oculto</option>
                                </select>
                            </div>
                            <div class="op1">
                                <span>Fondo: </span>
                                <input type="color" class="colorFondoTitulo">
                            </div>
                            <div class="op2">
                                <span>Texto: </span>
                                <input type="color" class="colorTextoTitulo">
                            </div>
                            <div class="op3">
                                <span>Tamaño: </span>
                                <input type="number" class="sizeTitulo" name="sizeTitulo" min="12" max="32" value="16" step="1" />
                            </div>
                            <div class="op4">
                                <span>Fuente:</span>
                                <select class="fuenteTitulo">
                                    <option value="Arial" class="fuente-Arial">Arial</option>
                                    <option value="Times New Roman" class="fuente-TimesNewRoman">Times New Roman</option>
                                    <option value="Courier New" class="fuente-CourierNew">Courier New</option>
                                    <option value="Georgia" class="fuente-Georgia">Georgia</option>
                                    <option value="Impact" class="fuente-Impact">Impact</option>
                                    <option value="Lucida Sans Unicode" class="fuente-LucidaSansUnicode">Lucida Sans Unicode</option>
                                    <option value="Palatino Linotype" class="fuente-PalatinoLinotype">Palatino Linotype</option>
                                    <option value="Tahoma" class="fuente-Tahoma">Tahoma</option>
                                    <option value="Trebuchet MS" class="fuente-TrebuchetMS">Trebuchet MS</option>
                                    <option value="Verdana" class="fuente-Verdana">Verdana</option>
                                </select>
                            </div>
                        </div>
                    </div>    
                </div>
            </div>
            <div class="apunteCabecera"></div>
            <textarea name="nota" class="contenido" autofocus></textarea>
        </div>
    </template>
    <!-- <script type="module" src="miDrawingTablet.js"></script> -->
    <!-- <script type="module" src="classApunte.js"></script> -->
    <!-- <script type="module" src="notas.js"> -->
        
    <!-- </script> -->
	
	<script>
	
!function(A,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(A="undefined"!=typeof globalThis?globalThis:A||self).html2canvas=e()}(this,function(){"use strict";var r=function(A,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(A,e){A.__proto__=e}||function(A,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(A[t]=e[t])})(A,e)};function A(A,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=A}r(A,e),A.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}var h=function(){return(h=Object.assign||function(A){for(var e,t=1,r=arguments.length;t<r;t++)for(var B in e=arguments[t])Object.prototype.hasOwnProperty.call(e,B)&&(A[B]=e[B]);return A}).apply(this,arguments)};function a(A,s,o,i){return new(o=o||Promise)(function(t,e){function r(A){try{n(i.next(A))}catch(A){e(A)}}function B(A){try{n(i.throw(A))}catch(A){e(A)}}function n(A){var e;A.done?t(A.value):((e=A.value)instanceof o?e:new o(function(A){A(e)})).then(r,B)}n((i=i.apply(A,s||[])).next())})}function H(t,r){var B,n,s,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},A={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function e(e){return function(A){return function(e){if(B)throw new TypeError("Generator is already executing.");for(;o;)try{if(B=1,n&&(s=2&e[0]?n.return:e[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,e[1])).done)return s;switch(n=0,(e=s?[2&e[0],s.value]:e)[0]){case 0:case 1:s=e;break;case 4:return o.label++,{value:e[1],done:!1};case 5:o.label++,n=e[1],e=[0];continue;case 7:e=o.ops.pop(),o.trys.pop();continue;default:if(!(s=0<(s=o.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){o=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){o.label=e[1];break}if(6===e[0]&&o.label<s[1]){o.label=s[1],s=e;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(e);break}s[2]&&o.ops.pop(),o.trys.pop();continue}e=r.call(t,o)}catch(A){e=[6,A],n=0}finally{B=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,A])}}}function t(A,e,t){if(t||2===arguments.length)for(var r,B=0,n=e.length;B<n;B++)!r&&B in e||((r=r||Array.prototype.slice.call(e,0,B))[B]=e[B]);return A.concat(r||e)}var d=(B.prototype.add=function(A,e,t,r){return new B(this.left+A,this.top+e,this.width+t,this.height+r)},B.fromClientRect=function(A,e){return new B(e.left+A.windowBounds.left,e.top+A.windowBounds.top,e.width,e.height)},B.fromDOMRectList=function(A,e){e=Array.from(e).find(function(A){return 0!==A.width});return e?new B(e.left+A.windowBounds.left,e.top+A.windowBounds.top,e.width,e.height):B.EMPTY},B.EMPTY=new B(0,0,0,0),B);function B(A,e,t,r){this.left=A,this.top=e,this.width=t,this.height=r}for(var f=function(A,e){return d.fromClientRect(A,e.getBoundingClientRect())},Q=function(A){for(var e=[],t=0,r=A.length;t<r;){var B,n=A.charCodeAt(t++);55296<=n&&n<=56319&&t<r?56320==(64512&(B=A.charCodeAt(t++)))?e.push(((1023&n)<<10)+(1023&B)+65536):(e.push(n),t--):e.push(n)}return e},g=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,A);var t=A.length;if(!t)return"";for(var r=[],B=-1,n="";++B<t;){var s=A[B];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(B+1===t||16384<r.length)&&(n+=String.fromCharCode.apply(String,r),r.length=0)}return n},e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="undefined"==typeof Uint8Array?[]:new Uint8Array(256),s=0;s<e.length;s++)n[e.charCodeAt(s)]=s;for(var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="undefined"==typeof Uint8Array?[]:new Uint8Array(256),i=0;i<o.length;i++)c[o.charCodeAt(i)]=i;function w(A,e,t){return A.slice?A.slice(e,t):new Uint16Array(Array.prototype.slice.call(A,e,t))}var U=(l.prototype.get=function(A){var e;if(0<=A){if(A<55296||56319<A&&A<=65535)return e=this.index[A>>5],this.data[e=(e<<2)+(31&A)];if(A<=65535)return e=this.index[2048+(A-55296>>5)],this.data[e=(e<<2)+(31&A)];if(A<this.highStart)return e=this.index[e=2080+(A>>11)],e=this.index[e+=A>>5&63],this.data[e=(e<<2)+(31&A)];if(A<=1114111)return this.data[this.highValueIndex]}return this.errorValue},l);function l(A,e,t,r,B,n){this.initialValue=A,this.errorValue=e,this.highStart=t,this.highValueIndex=r,this.index=B,this.data=n}for(var C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u="undefined"==typeof Uint8Array?[]:new Uint8Array(256),F=0;F<C.length;F++)u[C.charCodeAt(F)]=F;function p(A,e,t,r){var B=r[t];if(Array.isArray(A)?-1!==A.indexOf(B):A===B)for(var n=t;n<=r.length;){if((o=r[++n])===e)return 1;if(o!==D)break}if(B===D)for(n=t;0<n;){var s=r[--n];if(Array.isArray(A)?-1!==A.indexOf(s):A===s)for(var o,i=t;i<=r.length;){if((o=r[++i])===e)return 1;if(o!==D)break}if(s!==D)break}}function E(A,e){for(var t=A;0<=t;){var r=e[t];if(r!==D)return r;t--}return 0}function I(t,A){var e=(B=function(A,r){void 0===r&&(r="strict");var B=[],n=[],s=[];return A.forEach(function(A,e){var t=rA.get(A);if(50<t?(s.push(!0),t-=50):s.push(!1),-1!==["normal","auto","loose"].indexOf(r)&&-1!==[8208,8211,12316,12448].indexOf(A))return n.push(e),B.push(16);if(4!==t&&11!==t)return n.push(e),31===t?B.push("strict"===r?O:q):t===AA||29===t?B.push(J):43===t?131072<=A&&A<=196605||196608<=A&&A<=262141?B.push(q):B.push(J):void B.push(t);if(0===e)return n.push(e),B.push(J);t=B[e-1];return-1===iA.indexOf(t)?(n.push(n[e-1]),B.push(t)):(n.push(e),B.push(J))}),[n,B,s]}(t,(A=A||{lineBreak:"normal",wordBreak:"normal"}).lineBreak))[0],r=B[1],B=B[2];return[e,r="break-all"===A.wordBreak||"break-word"===A.wordBreak?r.map(function(A){return-1!==[R,J,AA].indexOf(A)?q:A}):r,"keep-all"===A.wordBreak?B.map(function(A,e){return A&&19968<=t[e]&&t[e]<=40959}):void 0]}var y,K,m,L,b,D=10,v=13,x=15,M=17,S=18,T=19,G=20,O=21,V=22,k=24,R=25,N=26,P=27,X=28,J=30,Y=32,W=33,Z=34,_=35,q=37,j=38,z=39,$=40,AA=42,eA=[9001,65288],tA="×",rA=(m=function(A){var e,t,r,B,n=.75*A.length,s=A.length,o=0;"="===A[A.length-1]&&(n--,"="===A[A.length-2]&&n--);for(var n=new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(n),i=Array.isArray(n)?n:new Uint8Array(n),Q=0;Q<s;Q+=4)e=c[A.charCodeAt(Q)],t=c[A.charCodeAt(Q+1)],r=c[A.charCodeAt(Q+2)],B=c[A.charCodeAt(Q+3)],i[o++]=e<<2|t>>4,i[o++]=(15&t)<<4|r>>2,i[o++]=(3&r)<<6|63&B;return n}(y="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),L=Array.isArray(m)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=4)t.push(A[r+3]<<24|A[r+2]<<16|A[r+1]<<8|A[r]);return t}(m):new Uint32Array(m),b=Array.isArray(m)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=2)t.push(A[r+1]<<8|A[r]);return t}(m):new Uint16Array(m),y=w(b,12,L[4]/2),K=2===L[5]?w(b,(24+L[4])/2):(m=L,b=Math.ceil((24+L[4])/4),m.slice?m.slice(b,K):new Uint32Array(Array.prototype.slice.call(m,b,K))),new U(L[0],L[1],L[2],L[3],y,K)),BA=[J,36],nA=[1,2,3,5],sA=[D,8],oA=[P,N],iA=nA.concat(sA),QA=[j,z,$,Z,_],cA=[x,v],aA=(gA.prototype.slice=function(){return g.apply(void 0,this.codePoints.slice(this.start,this.end))},gA);function gA(A,e,t,r){this.codePoints=A,this.required="!"===e,this.start=t,this.end=r}function wA(A,e){var t=Q(A),r=(e=I(t,e))[0],B=e[1],n=e[2],s=t.length,o=0,i=0;return{next:function(){if(s<=i)return{done:!0,value:null};for(var A=tA;i<s&&(A=function(A,e,t,r,B){if(0===t[r])return tA;var n=r-1;if(Array.isArray(B)&&!0===B[n])return tA;var s=n-1,o=1+n,i=e[n],r=0<=s?e[s]:0,B=e[o];if(2===i&&3===B)return tA;if(-1!==nA.indexOf(i))return"!";if(-1!==nA.indexOf(B))return tA;if(-1!==sA.indexOf(B))return tA;if(8===E(n,e))return"÷";if(11===rA.get(A[n]))return tA;if((i===Y||i===W)&&11===rA.get(A[o]))return tA;if(7===i||7===B)return tA;if(9===i)return tA;if(-1===[D,v,x].indexOf(i)&&9===B)return tA;if(-1!==[M,S,T,k,X].indexOf(B))return tA;if(E(n,e)===V)return tA;if(p(23,V,n,e))return tA;if(p([M,S],O,n,e))return tA;if(p(12,12,n,e))return tA;if(i===D)return"÷";if(23===i||23===B)return tA;if(16===B||16===i)return"÷";if(-1!==[v,x,O].indexOf(B)||14===i)return tA;if(36===r&&-1!==cA.indexOf(i))return tA;if(i===X&&36===B)return tA;if(B===G)return tA;if(-1!==BA.indexOf(B)&&i===R||-1!==BA.indexOf(i)&&B===R)return tA;if(i===P&&-1!==[q,Y,W].indexOf(B)||-1!==[q,Y,W].indexOf(i)&&B===N)return tA;if(-1!==BA.indexOf(i)&&-1!==oA.indexOf(B)||-1!==oA.indexOf(i)&&-1!==BA.indexOf(B))return tA;if(-1!==[P,N].indexOf(i)&&(B===R||-1!==[V,x].indexOf(B)&&e[1+o]===R)||-1!==[V,x].indexOf(i)&&B===R||i===R&&-1!==[R,X,k].indexOf(B))return tA;if(-1!==[R,X,k,M,S].indexOf(B))for(var Q=n;0<=Q;){if((c=e[Q])===R)return tA;if(-1===[X,k].indexOf(c))break;Q--}if(-1!==[P,N].indexOf(B))for(var c,Q=-1!==[M,S].indexOf(i)?s:n;0<=Q;){if((c=e[Q])===R)return tA;if(-1===[X,k].indexOf(c))break;Q--}if(j===i&&-1!==[j,z,Z,_].indexOf(B)||-1!==[z,Z].indexOf(i)&&-1!==[z,$].indexOf(B)||-1!==[$,_].indexOf(i)&&B===$)return tA;if(-1!==QA.indexOf(i)&&-1!==[G,N].indexOf(B)||-1!==QA.indexOf(B)&&i===P)return tA;if(-1!==BA.indexOf(i)&&-1!==BA.indexOf(B))return tA;if(i===k&&-1!==BA.indexOf(B))return tA;if(-1!==BA.concat(R).indexOf(i)&&B===V&&-1===eA.indexOf(A[o])||-1!==BA.concat(R).indexOf(B)&&i===S)return tA;if(41===i&&41===B){for(var a=t[n],g=1;0<a&&41===e[--a];)g++;if(g%2!=0)return tA}return i===Y&&B===W?tA:"÷"}(t,B,r,++i,n))===tA;);if(A===tA&&i!==s)return{done:!0,value:null};var e=new aA(t,A,o,i);return o=i,{value:e,done:!1}}}}function UA(A){return 48<=A&&A<=57}function lA(A){return UA(A)||65<=A&&A<=70||97<=A&&A<=102}function CA(A){return 10===A||9===A||32===A}function uA(A){return 97<=(t=e=A)&&t<=122||65<=(e=e)&&e<=90||128<=A||95===A;var e,t}function FA(A){return uA(A)||UA(A)||45===A}function hA(A,e){return 92===A&&10!==e}function dA(A,e,t){return 45===A?uA(e)||hA(e,t):!!uA(A)||92===A&&10!==e}function fA(A,e,t){return 43===A||45===A?!!UA(e)||46===e&&UA(t):UA(46===A?e:A)}var HA={type:2},pA={type:3},EA={type:4},IA={type:13},yA={type:8},KA={type:21},mA={type:9},LA={type:10},bA={type:11},DA={type:12},vA={type:14},xA={type:23},MA={type:1},SA={type:25},TA={type:24},GA={type:26},OA={type:27},VA={type:28},kA={type:29},RA={type:31},NA={type:32},PA=(XA.prototype.write=function(A){this._value=this._value.concat(Q(A))},XA.prototype.read=function(){for(var A=[],e=this.consumeToken();e!==NA;)A.push(e),e=this.consumeToken();return A},XA.prototype.consumeToken=function(){var A=this.consumeCodePoint();switch(A){case 34:return this.consumeStringToken(34);case 35:var e=this.peekCodePoint(0),t=this.peekCodePoint(1),r=this.peekCodePoint(2);if(FA(e)||hA(t,r)){var B=dA(e,t,r)?2:1;return{type:5,value:this.consumeName(),flags:B}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),IA;break;case 39:return this.consumeStringToken(39);case 40:return HA;case 41:return pA;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),vA;break;case 43:if(fA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 44:return EA;case 45:var r=A,B=this.peekCodePoint(0),n=this.peekCodePoint(1);if(fA(r,B,n))return this.reconsumeCodePoint(A),this.consumeNumericToken();if(dA(r,B,n))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();if(45===B&&62===n)return this.consumeCodePoint(),this.consumeCodePoint(),TA;break;case 46:if(fA(A,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(A),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var s=this.consumeCodePoint();if(42===s&&47===(s=this.consumeCodePoint()))return this.consumeToken();if(-1===s)return this.consumeToken()}break;case 58:return GA;case 59:return OA;case 60:if(33===this.peekCodePoint(0)&&45===this.peekCodePoint(1)&&45===this.peekCodePoint(2))return this.consumeCodePoint(),this.consumeCodePoint(),SA;break;case 64:var n=this.peekCodePoint(0),o=this.peekCodePoint(1),i=this.peekCodePoint(2);if(dA(n,o,i))return{type:7,value:this.consumeName()};break;case 91:return VA;case 92:if(hA(A,this.peekCodePoint(0)))return this.reconsumeCodePoint(A),this.consumeIdentLikeToken();break;case 93:return kA;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),yA;break;case 123:return bA;case 125:return DA;case 117:case 85:o=this.peekCodePoint(0),i=this.peekCodePoint(1);return 43!==o||!lA(i)&&63!==i||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(A),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),mA;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),KA;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),LA;break;case-1:return NA}return CA(A)?(this.consumeWhiteSpace(),RA):UA(A)?(this.reconsumeCodePoint(A),this.consumeNumericToken()):uA(A)?(this.reconsumeCodePoint(A),this.consumeIdentLikeToken()):{type:6,value:g(A)}},XA.prototype.consumeCodePoint=function(){var A=this._value.shift();return void 0===A?-1:A},XA.prototype.reconsumeCodePoint=function(A){this._value.unshift(A)},XA.prototype.peekCodePoint=function(A){return A>=this._value.length?-1:this._value[A]},XA.prototype.consumeUnicodeRangeToken=function(){for(var A=[],e=this.consumeCodePoint();lA(e)&&A.length<6;)A.push(e),e=this.consumeCodePoint();for(var t=!1;63===e&&A.length<6;)A.push(e),e=this.consumeCodePoint(),t=!0;if(t)return{type:30,start:parseInt(g.apply(void 0,A.map(function(A){return 63===A?48:A})),16),end:parseInt(g.apply(void 0,A.map(function(A){return 63===A?70:A})),16)};var r=parseInt(g.apply(void 0,A),16);if(45===this.peekCodePoint(0)&&lA(this.peekCodePoint(1))){this.consumeCodePoint();for(var e=this.consumeCodePoint(),B=[];lA(e)&&B.length<6;)B.push(e),e=this.consumeCodePoint();return{type:30,start:r,end:parseInt(g.apply(void 0,B),16)}}return{type:30,start:r,end:r}},XA.prototype.consumeIdentLikeToken=function(){var A=this.consumeName();return"url"===A.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:A}):{type:20,value:A}},XA.prototype.consumeUrlToken=function(){var A=[];if(this.consumeWhiteSpace(),-1===this.peekCodePoint(0))return{type:22,value:""};var e,t=this.peekCodePoint(0);if(39===t||34===t){t=this.consumeStringToken(this.consumeCodePoint());return 0===t.type&&(this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:t.value}):(this.consumeBadUrlRemnants(),xA)}for(;;){var r=this.consumeCodePoint();if(-1===r||41===r)return{type:22,value:g.apply(void 0,A)};if(CA(r))return this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:g.apply(void 0,A)}):(this.consumeBadUrlRemnants(),xA);if(34===r||39===r||40===r||(0<=(e=r)&&e<=8||11===e||14<=e&&e<=31||127===e))return this.consumeBadUrlRemnants(),xA;if(92===r){if(!hA(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),xA;A.push(this.consumeEscapedCodePoint())}else A.push(r)}},XA.prototype.consumeWhiteSpace=function(){for(;CA(this.peekCodePoint(0));)this.consumeCodePoint()},XA.prototype.consumeBadUrlRemnants=function(){for(;;){var A=this.consumeCodePoint();if(41===A||-1===A)return;hA(A,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},XA.prototype.consumeStringSlice=function(A){for(var e="";0<A;){var t=Math.min(5e4,A);e+=g.apply(void 0,this._value.splice(0,t)),A-=t}return this._value.shift(),e},XA.prototype.consumeStringToken=function(A){for(var e="",t=0;;){var r,B=this._value[t];if(-1===B||void 0===B||B===A)return{type:0,value:e+=this.consumeStringSlice(t)};if(10===B)return this._value.splice(0,t),MA;92!==B||-1!==(r=this._value[t+1])&&void 0!==r&&(10===r?(e+=this.consumeStringSlice(t),t=-1,this._value.shift()):hA(B,r)&&(e+=this.consumeStringSlice(t),e+=g(this.consumeEscapedCodePoint()),t=-1)),t++}},XA.prototype.consumeNumber=function(){var A=[],e=4;for(43!==(t=this.peekCodePoint(0))&&45!==t||A.push(this.consumeCodePoint());UA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());var t=this.peekCodePoint(0),r=this.peekCodePoint(1);if(46===t&&UA(r))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;UA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());t=this.peekCodePoint(0);var r=this.peekCodePoint(1),B=this.peekCodePoint(2);if((69===t||101===t)&&((43===r||45===r)&&UA(B)||UA(r)))for(A.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;UA(this.peekCodePoint(0));)A.push(this.consumeCodePoint());return[function(A){var e=0,t=1;43!==A[e]&&45!==A[e]||(45===A[e]&&(t=-1),e++);for(var r=[];UA(A[e]);)r.push(A[e++]);var B=r.length?parseInt(g.apply(void 0,r),10):0;46===A[e]&&e++;for(var n=[];UA(A[e]);)n.push(A[e++]);var s=n.length,o=s?parseInt(g.apply(void 0,n),10):0;69!==A[e]&&101!==A[e]||e++;var i=1;43!==A[e]&&45!==A[e]||(45===A[e]&&(i=-1),e++);for(var Q=[];UA(A[e]);)Q.push(A[e++]);var c=Q.length?parseInt(g.apply(void 0,Q),10):0;return t*(B+o*Math.pow(10,-s))*Math.pow(10,i*c)}(A),e]},XA.prototype.consumeNumericToken=function(){var A=this.consumeNumber(),e=A[0],t=A[1],r=this.peekCodePoint(0),B=this.peekCodePoint(1),A=this.peekCodePoint(2);return dA(r,B,A)?{type:15,number:e,flags:t,unit:this.consumeName()}:37===r?(this.consumeCodePoint(),{type:16,number:e,flags:t}):{type:17,number:e,flags:t}},XA.prototype.consumeEscapedCodePoint=function(){var A,e=this.consumeCodePoint();if(lA(e)){for(var t=g(e);lA(this.peekCodePoint(0))&&t.length<6;)t+=g(this.consumeCodePoint());CA(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return 0===r||55296<=(A=r)&&A<=57343||1114111<r?65533:r}return-1===e?65533:e},XA.prototype.consumeName=function(){for(var A="";;){var e=this.consumeCodePoint();if(FA(e))A+=g(e);else{if(!hA(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),A;A+=g(this.consumeEscapedCodePoint())}}},XA);function XA(){this._value=[]}var JA=(YA.create=function(A){var e=new PA;return e.write(A),new YA(e.read())},YA.parseValue=function(A){return YA.create(A).parseComponentValue()},YA.parseValues=function(A){return YA.create(A).parseComponentValues()},YA.prototype.parseComponentValue=function(){for(var A=this.consumeToken();31===A.type;)A=this.consumeToken();if(32===A.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(A);for(var e=this.consumeComponentValue();31===(A=this.consumeToken()).type;);if(32===A.type)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},YA.prototype.parseComponentValues=function(){for(var A=[];;){var e=this.consumeComponentValue();if(32===e.type)return A;A.push(e),A.push()}},YA.prototype.consumeComponentValue=function(){var A=this.consumeToken();switch(A.type){case 11:case 28:case 2:return this.consumeSimpleBlock(A.type);case 19:return this.consumeFunction(A)}return A},YA.prototype.consumeSimpleBlock=function(A){for(var e={type:A,values:[]},t=this.consumeToken();;){if(32===t.type||ce(t,A))return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue()),t=this.consumeToken()}},YA.prototype.consumeFunction=function(A){for(var e={name:A.value,values:[],type:18};;){var t=this.consumeToken();if(32===t.type||3===t.type)return e;this.reconsumeToken(t),e.values.push(this.consumeComponentValue())}},YA.prototype.consumeToken=function(){var A=this._tokens.shift();return void 0===A?NA:A},YA.prototype.reconsumeToken=function(A){this._tokens.unshift(A)},YA);function YA(A){this._tokens=A}function WA(A){return 15===A.type}function ZA(A){return 17===A.type}function _A(A){return 20===A.type}function qA(A){return 0===A.type}function jA(A,e){return _A(A)&&A.value===e}function zA(A){return 31!==A.type}function $A(A){return 31!==A.type&&4!==A.type}function Ae(A){var e=[],t=[];return A.forEach(function(A){if(4===A.type){if(0===t.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(t),void(t=[])}31!==A.type&&t.push(A)}),t.length&&e.push(t),e}function ee(A){return 17===A.type||15===A.type}function te(A){return 16===A.type||ee(A)}function re(A){return 1<A.length?[A[0],A[1]]:[A[0]]}function Be(A,e,t){var r=A[0],A=A[1];return[Ue(r,e),Ue(void 0!==A?A:r,t)]}function ne(A){return 15===A.type&&("deg"===A.unit||"grad"===A.unit||"rad"===A.unit||"turn"===A.unit)}function se(A){switch(A.filter(_A).map(function(A){return A.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ae,ae];case"to top":case"bottom":return Ce(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ae,we];case"to right":case"left":return Ce(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[we,we];case"to bottom":case"top":return Ce(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[we,ae];case"to left":case"right":return Ce(270)}return 0}function oe(A){return 0==(255&A)}function ie(A){var e=255&A,t=255&A>>8,r=255&A>>16,A=255&A>>24;return e<255?"rgba("+A+","+r+","+t+","+e/255+")":"rgb("+A+","+r+","+t+")"}function Qe(A,e){if(17===A.type)return A.number;if(16!==A.type)return 0;var t=3===e?1:255;return 3===e?A.number/100*t:Math.round(A.number/100*t)}var ce=function(A,e){return 11===e&&12===A.type||(28===e&&29===A.type||2===e&&3===A.type)},ae={type:17,number:0,flags:4},ge={type:16,number:50,flags:4},we={type:16,number:100,flags:4},Ue=function(A,e){if(16===A.type)return A.number/100*e;if(WA(A))switch(A.unit){case"rem":case"em":return 16*A.number;default:return A.number}return A.number},le=function(A,e){if(15===e.type)switch(e.unit){case"deg":return Math.PI*e.number/180;case"grad":return Math.PI/200*e.number;case"rad":return e.number;case"turn":return 2*Math.PI*e.number}throw new Error("Unsupported angle type")},Ce=function(A){return Math.PI*A/180},ue=function(A,e){if(18===e.type){var t=me[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return t(A,e.values)}if(5===e.type){if(3===e.value.length){var r=e.value.substring(0,1),B=e.value.substring(1,2),n=e.value.substring(2,3);return Fe(parseInt(r+r,16),parseInt(B+B,16),parseInt(n+n,16),1)}if(4===e.value.length){var r=e.value.substring(0,1),B=e.value.substring(1,2),n=e.value.substring(2,3),s=e.value.substring(3,4);return Fe(parseInt(r+r,16),parseInt(B+B,16),parseInt(n+n,16),parseInt(s+s,16)/255)}if(6===e.value.length){r=e.value.substring(0,2),B=e.value.substring(2,4),n=e.value.substring(4,6);return Fe(parseInt(r,16),parseInt(B,16),parseInt(n,16),1)}if(8===e.value.length){r=e.value.substring(0,2),B=e.value.substring(2,4),n=e.value.substring(4,6),s=e.value.substring(6,8);return Fe(parseInt(r,16),parseInt(B,16),parseInt(n,16),parseInt(s,16)/255)}}if(20===e.type){e=Le[e.value.toUpperCase()];if(void 0!==e)return e}return Le.TRANSPARENT},Fe=function(A,e,t,r){return(A<<24|e<<16|t<<8|Math.round(255*r)<<0)>>>0},he=function(A,e){e=e.filter($A);if(3===e.length){var t=e.map(Qe),r=t[0],B=t[1],t=t[2];return Fe(r,B,t,1)}if(4!==e.length)return 0;e=e.map(Qe),r=e[0],B=e[1],t=e[2],e=e[3];return Fe(r,B,t,e)};function de(A,e,t){return t<0&&(t+=1),1<=t&&--t,t<1/6?(e-A)*t*6+A:t<.5?e:t<2/3?6*(e-A)*(2/3-t)+A:A}function fe(A,e){return ue(A,JA.create(e).parseComponentValue())}function He(A,e){return A=ue(A,e[0]),(e=e[1])&&te(e)?{color:A,stop:e}:{color:A,stop:null}}function pe(A,t){var e=A[0],r=A[A.length-1];null===e.stop&&(e.stop=ae),null===r.stop&&(r.stop=we);for(var B=[],n=0,s=0;s<A.length;s++){var o=A[s].stop;null!==o?(n<(o=Ue(o,t))?B.push(o):B.push(n),n=o):B.push(null)}for(var i=null,s=0;s<B.length;s++){var Q=B[s];if(null===Q)null===i&&(i=s);else if(null!==i){for(var c=s-i,a=(Q-B[i-1])/(1+c),g=1;g<=c;g++)B[i+g-1]=a*g;i=null}}return A.map(function(A,e){return{color:A.color,stop:Math.max(Math.min(1,B[e]/t),0)}})}function Ee(A,e,t){var r="number"==typeof A?A:(s=e/2,r=(n=t)/2,s=Ue((B=A)[0],e)-s,n=r-Ue(B[1],n),(Math.atan2(n,s)+2*Math.PI)%(2*Math.PI)),B=Math.abs(e*Math.sin(r))+Math.abs(t*Math.cos(r)),n=e/2,s=t/2,e=B/2,t=Math.sin(r-Math.PI/2)*e,e=Math.cos(r-Math.PI/2)*e;return[B,n-e,n+e,s-t,s+t]}function Ie(A,e){return Math.sqrt(A*A+e*e)}function ye(A,e,B,n,s){return[[0,0],[0,e],[A,0],[A,e]].reduce(function(A,e){var t=e[0],r=e[1],r=Ie(B-t,n-r);return(s?r<A.optimumDistance:r>A.optimumDistance)?{optimumCorner:e,optimumDistance:r}:A},{optimumDistance:s?1/0:-1/0,optimumCorner:null}).optimumCorner}var Ke=function(A,e){var t=e.filter($A),r=t[0],B=t[1],n=t[2],e=t[3],t=(17===r.type?Ce(r.number):le(A,r))/(2*Math.PI),A=te(B)?B.number/100:0,r=te(n)?n.number/100:0,B=void 0!==e&&te(e)?Ue(e,1):1;if(0==A)return Fe(255*r,255*r,255*r,1);n=r<=.5?r*(1+A):r+A-r*A,e=2*r-n,A=de(e,n,t+1/3),r=de(e,n,t),t=de(e,n,t-1/3);return Fe(255*A,255*r,255*t,B)},me={hsl:Ke,hsla:Ke,rgb:he,rgba:he},Le={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},be={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(A,e){return e.map(function(A){if(_A(A))switch(A.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},De={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ke=function(t,A){var r=Ce(180),B=[];return Ae(A).forEach(function(A,e){if(0===e){e=A[0];if(20===e.type&&-1!==["top","left","right","bottom"].indexOf(e.value))return void(r=se(A));if(ne(e))return void(r=(le(t,e)+Ce(270))%Ce(360))}A=He(t,A);B.push(A)}),{angle:r,stops:B,type:1}},ve="closest-side",xe="farthest-side",Me="closest-corner",Se="farthest-corner",Te="ellipse",Ge="contain",he=function(r,A){var B=0,n=3,s=[],o=[];return Ae(A).forEach(function(A,e){var t=!0;0===e?t=A.reduce(function(A,e){if(_A(e))switch(e.value){case"center":return o.push(ge),!1;case"top":case"left":return o.push(ae),!1;case"right":case"bottom":return o.push(we),!1}else if(te(e)||ee(e))return o.push(e),!1;return A},t):1===e&&(t=A.reduce(function(A,e){if(_A(e))switch(e.value){case"circle":return B=0,!1;case Te:return!(B=1);case Ge:case ve:return n=0,!1;case xe:return!(n=1);case Me:return!(n=2);case"cover":case Se:return!(n=3)}else if(ee(e)||te(e))return(n=!Array.isArray(n)?[]:n).push(e),!1;return A},t)),t&&(A=He(r,A),s.push(A))}),{size:n,shape:B,stops:s,position:o,type:2}},Oe=function(A,e){if(22===e.type){var t={url:e.value,type:0};return A.cache.addImage(e.value),t}if(18!==e.type)throw new Error("Unsupported image type "+e.type);t=ke[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return t(A,e.values)};var Ve,ke={"linear-gradient":function(t,A){var r=Ce(180),B=[];return Ae(A).forEach(function(A,e){if(0===e){e=A[0];if(20===e.type&&"to"===e.value)return void(r=se(A));if(ne(e))return void(r=le(t,e))}A=He(t,A);B.push(A)}),{angle:r,stops:B,type:1}},"-moz-linear-gradient":Ke,"-ms-linear-gradient":Ke,"-o-linear-gradient":Ke,"-webkit-linear-gradient":Ke,"radial-gradient":function(B,A){var n=0,s=3,o=[],i=[];return Ae(A).forEach(function(A,e){var t,r=!0;0===e&&(t=!1,r=A.reduce(function(A,e){if(t)if(_A(e))switch(e.value){case"center":return i.push(ge),A;case"top":case"left":return i.push(ae),A;case"right":case"bottom":return i.push(we),A}else(te(e)||ee(e))&&i.push(e);else if(_A(e))switch(e.value){case"circle":return n=0,!1;case Te:return!(n=1);case"at":return!(t=!0);case ve:return s=0,!1;case"cover":case xe:return!(s=1);case Ge:case Me:return!(s=2);case Se:return!(s=3)}else if(ee(e)||te(e))return(s=!Array.isArray(s)?[]:s).push(e),!1;return A},r)),r&&(A=He(B,A),o.push(A))}),{size:s,shape:n,stops:o,position:i,type:2}},"-moz-radial-gradient":he,"-ms-radial-gradient":he,"-o-radial-gradient":he,"-webkit-radial-gradient":he,"-webkit-gradient":function(r,A){var e=Ce(180),B=[],n=1;return Ae(A).forEach(function(A,e){var t,A=A[0];if(0===e){if(_A(A)&&"linear"===A.value)return void(n=1);if(_A(A)&&"radial"===A.value)return void(n=2)}18===A.type&&("from"===A.name?(t=ue(r,A.values[0]),B.push({stop:ae,color:t})):"to"===A.name?(t=ue(r,A.values[0]),B.push({stop:we,color:t})):"color-stop"!==A.name||2===(A=A.values.filter($A)).length&&(t=ue(r,A[1]),A=A[0],ZA(A)&&B.push({stop:{type:16,number:100*A.number,flags:A.flags},color:t})))}),1===n?{angle:(e+Ce(180))%Ce(360),stops:B,type:n}:{size:3,shape:0,stops:B,position:[],type:n}}},Re={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,A){if(0===A.length)return[];var t=A[0];return 20===t.type&&"none"===t.value?[]:A.filter(function(A){return $A(A)&&!(20===(A=A).type&&"none"===A.value||18===A.type&&!ke[A.name])}).map(function(A){return Oe(e,A)})}},Ne={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(A,e){return e.map(function(A){if(_A(A))switch(A.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Pe={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(A,e){return Ae(e).map(function(A){return A.filter(te)}).map(re)}},Xe={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(A,e){return Ae(e).map(function(A){return A.filter(_A).map(function(A){return A.value}).join(" ")}).map(Je)}},Je=function(A){switch(A){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};(he=Ve=Ve||{}).AUTO="auto",he.CONTAIN="contain";function Ye(A,e){return _A(A)&&"normal"===A.value?1.2*e:17===A.type?e*A.number:te(A)?Ue(A,e):e}var We,Ze,_e={name:"background-size",initialValue:"0",prefix:!(he.COVER="cover"),type:1,parse:function(A,e){return Ae(e).map(function(A){return A.filter(qe)})}},qe=function(A){return _A(A)||te(A)},he=function(A){return{name:"border-"+A+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},je=he("top"),ze=he("right"),$e=he("bottom"),At=he("left"),he=function(A){return{name:"border-radius-"+A,initialValue:"0 0",prefix:!1,type:1,parse:function(A,e){return re(e.filter(te))}}},et=he("top-left"),tt=he("top-right"),rt=he("bottom-right"),Bt=he("bottom-left"),he=function(A){return{name:"border-"+A+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(A,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},nt=he("top"),st=he("right"),ot=he("bottom"),it=he("left"),he=function(A){return{name:"border-"+A+"-width",initialValue:"0",type:0,prefix:!1,parse:function(A,e){return WA(e)?e.number:0}}},Qt=he("top"),ct=he("right"),at=he("bottom"),gt=he("left"),wt={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ut={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(A,e){return"rtl"!==e?0:1}},lt={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(A,e){return e.filter(_A).reduce(function(A,e){return A|Ct(e.value)},0)}},Ct=function(A){switch(A){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},ut={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Ft={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(A,e){return!(20===e.type&&"normal"===e.value||17!==e.type&&15!==e.type)?e.number:0}},ht={name:"line-break",initialValue:(he=We=We||{}).NORMAL="normal",prefix:!(he.STRICT="strict"),type:2,parse:function(A,e){return"strict"!==e?We.NORMAL:We.STRICT}},dt={name:"line-height",initialValue:"normal",prefix:!1,type:4},ft={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(A,e){return 20===e.type&&"none"===e.value?null:Oe(A,e)}},Ht={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(A,e){return"inside"!==e?1:0}},pt={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},he=function(A){return{name:"margin-"+A,initialValue:"0",prefix:!1,type:4}},Et=he("top"),It=he("right"),yt=he("bottom"),Kt=he("left"),mt={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(A,e){return e.filter(_A).map(function(A){switch(A.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}})}},Lt={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(A,e){return"break-word"!==e?"normal":"break-word"}},he=function(A){return{name:"padding-"+A,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},bt=he("top"),Dt=he("right"),vt=he("bottom"),xt=he("left"),Mt={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(A,e){switch(e){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},St={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(A,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Tt={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,A){return 1===A.length&&jA(A[0],"none")?[]:Ae(A).map(function(A){for(var e={color:Le.TRANSPARENT,offsetX:ae,offsetY:ae,blur:ae},t=0,r=0;r<A.length;r++){var B=A[r];ee(B)?(0===t?e.offsetX=B:1===t?e.offsetY=B:e.blur=B,t++):e.color=ue(n,B)}return e})}},Gt={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Ot={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(A,e){if(20===e.type&&"none"===e.value)return null;if(18!==e.type)return null;var t=Vt[e.name];if(void 0===t)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return t(e.values)}},Vt={matrix:function(A){A=A.filter(function(A){return 17===A.type}).map(function(A){return A.number});return 6===A.length?A:null},matrix3d:function(A){var e=A.filter(function(A){return 17===A.type}).map(function(A){return A.number}),t=e[0],r=e[1];e[2],e[3];var B=e[4],n=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var s=e[12],A=e[13];return e[14],e[15],16===e.length?[t,r,B,n,s,A]:null}},he={type:16,number:50,flags:4},kt=[he,he],Rt={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(A,e){e=e.filter(te);return 2!==e.length?kt:[e[0],e[1]]}},Nt={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(A,e){switch(e){case"hidden":return 1;case"collapse":return 2;default:return 0}}};(he=Ze=Ze||{}).NORMAL="normal",he.BREAK_ALL="break-all";function Pt(A,e){return 0!=(A&e)}function Xt(A,e,t){return(A=A&&A[Math.min(e,A.length-1)])?t?A.open:A.close:""}var Jt={name:"word-break",initialValue:"normal",prefix:!(he.KEEP_ALL="keep-all"),type:2,parse:function(A,e){switch(e){case"break-all":return Ze.BREAK_ALL;case"keep-all":return Ze.KEEP_ALL;default:return Ze.NORMAL}}},Yt={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(A,e){if(20===e.type)return{auto:!0,order:0};if(ZA(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},Wt=function(A,e){if(15===e.type)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")},Zt={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(A,e){return ZA(e)?e.number:1}},_t={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},qt={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(A,e){return e.filter(_A).map(function(A){switch(A.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(A){return 0!==A})}},jt={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(A,e){var t=[],r=[];return e.forEach(function(A){switch(A.type){case 20:case 0:t.push(A.value);break;case 17:t.push(A.number.toString());break;case 4:r.push(t.join(" ")),t.length=0}}),t.length&&r.push(t.join(" ")),r.map(function(A){return-1===A.indexOf(" ")?A:"'"+A+"'"})}},zt={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},$t={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(A,e){return ZA(e)?e.number:!_A(e)||"bold"!==e.value?400:700}},Ar={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(A,e){return e.filter(_A).map(function(A){return A.value})}},er={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(A,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},tr={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(A,e){if(0===e.length)return[];var t=e[0];return 20===t.type&&"none"===t.value?[]:e}},rr={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return null;var t=e[0];if(20===t.type&&"none"===t.value)return null;for(var r=[],B=e.filter(zA),n=0;n<B.length;n++){var s=B[n],o=B[n+1];20===s.type&&(o=o&&ZA(o)?o.number:1,r.push({counter:s.value,increment:o}))}return r}},Br={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return[];for(var t=[],r=e.filter(zA),B=0;B<r.length;B++){var n=r[B],s=r[B+1];_A(n)&&"none"!==n.value&&(s=s&&ZA(s)?s.number:0,t.push({counter:n.value,reset:s}))}return t}},nr={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,A){return A.filter(WA).map(function(A){return Wt(e,A)})}},sr={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(A,e){if(0===e.length)return null;var t=e[0];if(20===t.type&&"none"===t.value)return null;var r=[],B=e.filter(qA);if(B.length%2!=0)return null;for(var n=0;n<B.length;n+=2){var s=B[n].value,o=B[n+1].value;r.push({open:s,close:o})}return r}},or={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(n,A){return 1===A.length&&jA(A[0],"none")?[]:Ae(A).map(function(A){for(var e={color:255,offsetX:ae,offsetY:ae,blur:ae,spread:ae,inset:!1},t=0,r=0;r<A.length;r++){var B=A[r];jA(B,"inset")?e.inset=!0:ee(B)?(0===t?e.offsetX=B:1===t?e.offsetY=B:2===t?e.blur=B:e.spread=B,t++):e.color=ue(n,B)}return e})}},ir={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(A,e){var t=[];return e.filter(_A).forEach(function(A){switch(A.value){case"stroke":t.push(1);break;case"fill":t.push(0);break;case"markers":t.push(2)}}),[0,1,2].forEach(function(A){-1===t.indexOf(A)&&t.push(A)}),t}},Qr={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},cr={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(A,e){return WA(e)?e.number:0}},ar=(gr.prototype.isVisible=function(){return 0<this.display&&0<this.opacity&&0===this.visibility},gr.prototype.isTransparent=function(){return oe(this.backgroundColor)},gr.prototype.isTransformed=function(){return null!==this.transform},gr.prototype.isPositioned=function(){return 0!==this.position},gr.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},gr.prototype.isFloating=function(){return 0!==this.float},gr.prototype.isInlineLevel=function(){return Pt(this.display,4)||Pt(this.display,33554432)||Pt(this.display,268435456)||Pt(this.display,536870912)||Pt(this.display,67108864)||Pt(this.display,134217728)},gr);function gr(A,e){this.animationDuration=lr(A,nr,e.animationDuration),this.backgroundClip=lr(A,be,e.backgroundClip),this.backgroundColor=lr(A,De,e.backgroundColor),this.backgroundImage=lr(A,Re,e.backgroundImage),this.backgroundOrigin=lr(A,Ne,e.backgroundOrigin),this.backgroundPosition=lr(A,Pe,e.backgroundPosition),this.backgroundRepeat=lr(A,Xe,e.backgroundRepeat),this.backgroundSize=lr(A,_e,e.backgroundSize),this.borderTopColor=lr(A,je,e.borderTopColor),this.borderRightColor=lr(A,ze,e.borderRightColor),this.borderBottomColor=lr(A,$e,e.borderBottomColor),this.borderLeftColor=lr(A,At,e.borderLeftColor),this.borderTopLeftRadius=lr(A,et,e.borderTopLeftRadius),this.borderTopRightRadius=lr(A,tt,e.borderTopRightRadius),this.borderBottomRightRadius=lr(A,rt,e.borderBottomRightRadius),this.borderBottomLeftRadius=lr(A,Bt,e.borderBottomLeftRadius),this.borderTopStyle=lr(A,nt,e.borderTopStyle),this.borderRightStyle=lr(A,st,e.borderRightStyle),this.borderBottomStyle=lr(A,ot,e.borderBottomStyle),this.borderLeftStyle=lr(A,it,e.borderLeftStyle),this.borderTopWidth=lr(A,Qt,e.borderTopWidth),this.borderRightWidth=lr(A,ct,e.borderRightWidth),this.borderBottomWidth=lr(A,at,e.borderBottomWidth),this.borderLeftWidth=lr(A,gt,e.borderLeftWidth),this.boxShadow=lr(A,or,e.boxShadow),this.color=lr(A,wt,e.color),this.direction=lr(A,Ut,e.direction),this.display=lr(A,lt,e.display),this.float=lr(A,ut,e.cssFloat),this.fontFamily=lr(A,jt,e.fontFamily),this.fontSize=lr(A,zt,e.fontSize),this.fontStyle=lr(A,er,e.fontStyle),this.fontVariant=lr(A,Ar,e.fontVariant),this.fontWeight=lr(A,$t,e.fontWeight),this.letterSpacing=lr(A,Ft,e.letterSpacing),this.lineBreak=lr(A,ht,e.lineBreak),this.lineHeight=lr(A,dt,e.lineHeight),this.listStyleImage=lr(A,ft,e.listStyleImage),this.listStylePosition=lr(A,Ht,e.listStylePosition),this.listStyleType=lr(A,pt,e.listStyleType),this.marginTop=lr(A,Et,e.marginTop),this.marginRight=lr(A,It,e.marginRight),this.marginBottom=lr(A,yt,e.marginBottom),this.marginLeft=lr(A,Kt,e.marginLeft),this.opacity=lr(A,Zt,e.opacity);var t=lr(A,mt,e.overflow);this.overflowX=t[0],this.overflowY=t[1<t.length?1:0],this.overflowWrap=lr(A,Lt,e.overflowWrap),this.paddingTop=lr(A,bt,e.paddingTop),this.paddingRight=lr(A,Dt,e.paddingRight),this.paddingBottom=lr(A,vt,e.paddingBottom),this.paddingLeft=lr(A,xt,e.paddingLeft),this.paintOrder=lr(A,ir,e.paintOrder),this.position=lr(A,St,e.position),this.textAlign=lr(A,Mt,e.textAlign),this.textDecorationColor=lr(A,_t,null!==(t=e.textDecorationColor)&&void 0!==t?t:e.color),this.textDecorationLine=lr(A,qt,null!==(t=e.textDecorationLine)&&void 0!==t?t:e.textDecoration),this.textShadow=lr(A,Tt,e.textShadow),this.textTransform=lr(A,Gt,e.textTransform),this.transform=lr(A,Ot,e.transform),this.transformOrigin=lr(A,Rt,e.transformOrigin),this.visibility=lr(A,Nt,e.visibility),this.webkitTextStrokeColor=lr(A,Qr,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=lr(A,cr,e.webkitTextStrokeWidth),this.wordBreak=lr(A,Jt,e.wordBreak),this.zIndex=lr(A,Yt,e.zIndex)}for(var wr=function(A,e){this.content=lr(A,tr,e.content),this.quotes=lr(A,sr,e.quotes)},Ur=function(A,e){this.counterIncrement=lr(A,rr,e.counterIncrement),this.counterReset=lr(A,Br,e.counterReset)},lr=function(A,e,t){var r=new PA,t=null!=t?t.toString():e.initialValue;r.write(t);var B=new JA(r.read());switch(e.type){case 2:var n=B.parseComponentValue();return e.parse(A,_A(n)?n.value:e.initialValue);case 0:return e.parse(A,B.parseComponentValue());case 1:return e.parse(A,B.parseComponentValues());case 4:return B.parseComponentValue();case 3:switch(e.format){case"angle":return le(A,B.parseComponentValue());case"color":return ue(A,B.parseComponentValue());case"image":return Oe(A,B.parseComponentValue());case"length":var s=B.parseComponentValue();return ee(s)?s:ae;case"length-percentage":s=B.parseComponentValue();return te(s)?s:ae;case"time":return Wt(A,B.parseComponentValue())}}},Cr=function(A,e){A=function(A){switch(A.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(A);return 1===A||e===A},ur=function(A,e){this.context=A,this.textNodes=[],this.elements=[],this.flags=0,Cr(e,3),this.styles=new ar(A,window.getComputedStyle(e,null)),JB(e)&&(this.styles.animationDuration.some(function(A){return 0<A})&&(e.style.animationDuration="0s"),null!==this.styles.transform&&(e.style.transform="none")),this.bounds=f(this.context,e),Cr(e,4)&&(this.flags|=16)},Fr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",hr="undefined"==typeof Uint8Array?[]:new Uint8Array(256),dr=0;dr<Fr.length;dr++)hr[Fr.charCodeAt(dr)]=dr;function fr(A,e,t){return A.slice?A.slice(e,t):new Uint16Array(Array.prototype.slice.call(A,e,t))}var Hr=(pr.prototype.get=function(A){var e;if(0<=A){if(A<55296||56319<A&&A<=65535)return e=this.index[A>>5],this.data[e=(e<<2)+(31&A)];if(A<=65535)return e=this.index[2048+(A-55296>>5)],this.data[e=(e<<2)+(31&A)];if(A<this.highStart)return e=this.index[e=2080+(A>>11)],e=this.index[e+=A>>5&63],this.data[e=(e<<2)+(31&A)];if(A<=1114111)return this.data[this.highValueIndex]}return this.errorValue},pr);function pr(A,e,t,r,B,n){this.initialValue=A,this.errorValue=e,this.highStart=t,this.highValueIndex=r,this.index=B,this.data=n}for(var Er="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ir="undefined"==typeof Uint8Array?[]:new Uint8Array(256),yr=0;yr<Er.length;yr++)Ir[Er.charCodeAt(yr)]=yr;function Kr(A){return kr.get(A)}function mr(A){var t=function(A){for(var e=[],t=0,r=A.length;t<r;){var B,n=A.charCodeAt(t++);55296<=n&&n<=56319&&t<r?56320==(64512&(B=A.charCodeAt(t++)))?e.push(((1023&n)<<10)+(1023&B)+65536):(e.push(n),t--):e.push(n)}return e}(A),r=t.length,B=0,n=0,s=t.map(Kr);return{next:function(){if(r<=B)return{done:!0,value:null};for(var A=Rr;B<r&&(A=function(A,e){var t=e-2,r=A[t],B=A[e-1],e=A[e];if(2===B&&3===e)return Rr;if(2===B||3===B||4===B)return"÷";if(2===e||3===e||4===e)return"÷";if(B===Tr&&-1!==[Tr,Gr,Or,Vr].indexOf(e))return Rr;if(!(B!==Or&&B!==Gr||e!==Gr&&10!==e))return Rr;if((B===Vr||10===B)&&10===e)return Rr;if(13===e||5===e)return Rr;if(7===e)return Rr;if(1===B)return Rr;if(13===B&&14===e){for(;5===r;)r=A[--t];if(14===r)return Rr}if(15===B&&15===e){for(var n=0;15===r;)n++,r=A[--t];if(n%2==0)return Rr}return"÷"}(s,++B))===Rr;);if(A===Rr&&B!==r)return{done:!0,value:null};var e=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,A);var t=A.length;if(!t)return"";for(var r=[],B=-1,n="";++B<t;){var s=A[B];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(B+1===t||16384<r.length)&&(n+=String.fromCharCode.apply(String,r),r.length=0)}return n}.apply(null,t.slice(n,B));return n=B,{value:e,done:!1}}}}function Lr(A){return 0===A[0]&&255===A[1]&&0===A[2]&&255===A[3]}var br,Dr,vr,xr,Mr,Sr,Tr=8,Gr=9,Or=11,Vr=12,kr=(vr=function(A){var e,t,r,B,n=.75*A.length,s=A.length,o=0;"="===A[A.length-1]&&(n--,"="===A[A.length-2]&&n--);for(var n=new("undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?ArrayBuffer:Array)(n),i=Array.isArray(n)?n:new Uint8Array(n),Q=0;Q<s;Q+=4)e=hr[A.charCodeAt(Q)],t=hr[A.charCodeAt(Q+1)],r=hr[A.charCodeAt(Q+2)],B=hr[A.charCodeAt(Q+3)],i[o++]=e<<2|t>>4,i[o++]=(15&t)<<4|r>>2,i[o++]=(3&r)<<6|63&B;return n}(br="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),xr=Array.isArray(vr)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=4)t.push(A[r+3]<<24|A[r+2]<<16|A[r+1]<<8|A[r]);return t}(vr):new Uint32Array(vr),Mr=Array.isArray(vr)?function(A){for(var e=A.length,t=[],r=0;r<e;r+=2)t.push(A[r+1]<<8|A[r]);return t}(vr):new Uint16Array(vr),br=fr(Mr,12,xr[4]/2),Dr=2===xr[5]?fr(Mr,(24+xr[4])/2):(vr=xr,Mr=Math.ceil((24+xr[4])/4),vr.slice?vr.slice(Mr,Dr):new Uint32Array(Array.prototype.slice.call(vr,Mr,Dr))),new Hr(xr[0],xr[1],xr[2],xr[3],br,Dr)),Rr="×",Nr=function(A,e,t,r,B){var n="http://www.w3.org/2000/svg",s=document.createElementNS(n,"svg"),n=document.createElementNS(n,"foreignObject");return s.setAttributeNS(null,"width",A.toString()),s.setAttributeNS(null,"height",e.toString()),n.setAttributeNS(null,"width","100%"),n.setAttributeNS(null,"height","100%"),n.setAttributeNS(null,"x",t.toString()),n.setAttributeNS(null,"y",r.toString()),n.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(n),n.appendChild(B),s},Pr=function(r){return new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})},Xr={get SUPPORT_RANGE_BOUNDS(){var A=function(A){if(A.createRange){var e=A.createRange();if(e.getBoundingClientRect){var t=A.createElement("boundtest");t.style.height="123px",t.style.display="block",A.body.appendChild(t),e.selectNode(t);e=e.getBoundingClientRect(),e=Math.round(e.height);if(A.body.removeChild(t),123===e)return!0}}return!1}(document);return Object.defineProperty(Xr,"SUPPORT_RANGE_BOUNDS",{value:A}),A},get SUPPORT_WORD_BREAKING(){var A=Xr.SUPPORT_RANGE_BOUNDS&&function(A){var e=A.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",A.body.appendChild(e);var r=A.createRange();e.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var B=e.firstChild,t=Q(B.data).map(function(A){return g(A)}),n=0,s={},t=t.every(function(A,e){r.setStart(B,n),r.setEnd(B,n+A.length);var t=r.getBoundingClientRect();n+=A.length;A=t.x>s.x||t.y>s.y;return s=t,0===e||A});return A.body.removeChild(e),t}(document);return Object.defineProperty(Xr,"SUPPORT_WORD_BREAKING",{value:A}),A},get SUPPORT_SVG_DRAWING(){var A=function(A){var e=new Image,t=A.createElement("canvas"),A=t.getContext("2d");if(!A)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{A.drawImage(e,0,0),t.toDataURL()}catch(A){return!1}return!0}(document);return Object.defineProperty(Xr,"SUPPORT_SVG_DRAWING",{value:A}),A},get SUPPORT_FOREIGNOBJECT_DRAWING(){var A="function"==typeof Array.from&&"function"==typeof window.fetch?function(t){var A=t.createElement("canvas"),r=100;A.width=r,A.height=r;var B=A.getContext("2d");if(!B)return Promise.reject(!1);B.fillStyle="rgb(0, 255, 0)",B.fillRect(0,0,r,r);var e=new Image,n=A.toDataURL();e.src=n;e=Nr(r,r,0,0,e);return B.fillStyle="red",B.fillRect(0,0,r,r),Pr(e).then(function(A){B.drawImage(A,0,0);var e=B.getImageData(0,0,r,r).data;B.fillStyle="red",B.fillRect(0,0,r,r);A=t.createElement("div");return A.style.backgroundImage="url("+n+")",A.style.height="100px",Lr(e)?Pr(Nr(r,r,0,0,A)):Promise.reject(!1)}).then(function(A){return B.drawImage(A,0,0),Lr(B.getImageData(0,0,r,r).data)}).catch(function(){return!1})}(document):Promise.resolve(!1);return Object.defineProperty(Xr,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:A}),A},get SUPPORT_CORS_IMAGES(){var A=void 0!==(new Image).crossOrigin;return Object.defineProperty(Xr,"SUPPORT_CORS_IMAGES",{value:A}),A},get SUPPORT_RESPONSE_TYPE(){var A="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Xr,"SUPPORT_RESPONSE_TYPE",{value:A}),A},get SUPPORT_CORS_XHR(){var A="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Xr,"SUPPORT_CORS_XHR",{value:A}),A},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var A=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Xr,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:A}),A}},Jr=function(A,e){this.text=A,this.bounds=e},Yr=function(A,e){var t=e.ownerDocument;if(t){var r=t.createElement("html2canvaswrapper");r.appendChild(e.cloneNode(!0));t=e.parentNode;if(t){t.replaceChild(r,e);A=f(A,r);return r.firstChild&&t.replaceChild(r.firstChild,r),A}}return d.EMPTY},Wr=function(A,e,t){var r=A.ownerDocument;if(!r)throw new Error("Node has no owner document");r=r.createRange();return r.setStart(A,e),r.setEnd(A,e+t),r},Zr=function(A){if(Xr.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(A)).map(function(A){return A.segment})}return function(A){for(var e,t=mr(A),r=[];!(e=t.next()).done;)e.value&&r.push(e.value.slice());return r}(A)},_r=function(A,e){return 0!==e.letterSpacing?Zr(A):function(A,e){if(Xr.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(t.segment(A)).map(function(A){return A.segment})}return jr(A,e)}(A,e)},qr=[32,160,4961,65792,65793,4153,4241],jr=function(A,e){for(var t,r=wA(A,{lineBreak:e.lineBreak,wordBreak:"break-word"===e.overflowWrap?"break-word":e.wordBreak}),B=[];!(t=r.next()).done;)!function(){var A,e;t.value&&(A=t.value.slice(),A=Q(A),e="",A.forEach(function(A){-1===qr.indexOf(A)?e+=g(A):(e.length&&B.push(e),B.push(g(A)),e="")}),e.length&&B.push(e))}();return B},zr=function(A,e,t){var B,n,s,o,i;this.text=$r(e.data,t.textTransform),this.textBounds=(B=A,A=this.text,s=e,A=_r(A,n=t),o=[],i=0,A.forEach(function(A){var e,t,r;n.textDecorationLine.length||0<A.trim().length?Xr.SUPPORT_RANGE_BOUNDS?1<(r=Wr(s,i,A.length).getClientRects()).length?(e=Zr(A),t=0,e.forEach(function(A){o.push(new Jr(A,d.fromDOMRectList(B,Wr(s,t+i,A.length).getClientRects()))),t+=A.length})):o.push(new Jr(A,d.fromDOMRectList(B,r))):(r=s.splitText(A.length),o.push(new Jr(A,Yr(B,s))),s=r):Xr.SUPPORT_RANGE_BOUNDS||(s=s.splitText(A.length)),i+=A.length}),o)},$r=function(A,e){switch(e){case 1:return A.toLowerCase();case 3:return A.replace(AB,eB);case 2:return A.toUpperCase();default:return A}},AB=/(^|\s|:|-|\(|\))([a-z])/g,eB=function(A,e,t){return 0<A.length?e+t.toUpperCase():A},tB=(A(rB,Sr=ur),rB);function rB(A,e){A=Sr.call(this,A,e)||this;return A.src=e.currentSrc||e.src,A.intrinsicWidth=e.naturalWidth,A.intrinsicHeight=e.naturalHeight,A.context.cache.addImage(A.src),A}var BB,nB=(A(sB,BB=ur),sB);function sB(A,e){A=BB.call(this,A,e)||this;return A.canvas=e,A.intrinsicWidth=e.width,A.intrinsicHeight=e.height,A}var oB,iB=(A(QB,oB=ur),QB);function QB(A,e){var t=oB.call(this,A,e)||this,r=new XMLSerializer,A=f(A,e);return e.setAttribute("width",A.width+"px"),e.setAttribute("height",A.height+"px"),t.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(e)),t.intrinsicWidth=e.width.baseVal.value,t.intrinsicHeight=e.height.baseVal.value,t.context.cache.addImage(t.svg),t}var cB,aB=(A(gB,cB=ur),gB);function gB(A,e){A=cB.call(this,A,e)||this;return A.value=e.value,A}var wB,UB=(A(lB,wB=ur),lB);function lB(A,e){A=wB.call(this,A,e)||this;return A.start=e.start,A.reversed="boolean"==typeof e.reversed&&!0===e.reversed,A}var CB,uB=[{type:15,flags:0,unit:"px",number:3}],FB=[{type:16,flags:0,number:50}],hB="checkbox",dB="radio",fB="password",HB=707406591,pB=(A(EB,CB=ur),EB);function EB(A,e){var t=CB.call(this,A,e)||this;switch(t.type=e.type.toLowerCase(),t.checked=e.checked,t.value=0===(e=(A=e).type===fB?new Array(A.value.length+1).join("•"):A.value).length?A.placeholder||"":e,t.type!==hB&&t.type!==dB||(t.styles.backgroundColor=3739148031,t.styles.borderTopColor=t.styles.borderRightColor=t.styles.borderBottomColor=t.styles.borderLeftColor=2779096575,t.styles.borderTopWidth=t.styles.borderRightWidth=t.styles.borderBottomWidth=t.styles.borderLeftWidth=1,t.styles.borderTopStyle=t.styles.borderRightStyle=t.styles.borderBottomStyle=t.styles.borderLeftStyle=1,t.styles.backgroundClip=[0],t.styles.backgroundOrigin=[0],t.bounds=(e=t.bounds).width>e.height?new d(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new d(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e),t.type){case hB:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=uB;break;case dB:t.styles.borderTopRightRadius=t.styles.borderTopLeftRadius=t.styles.borderBottomRightRadius=t.styles.borderBottomLeftRadius=FB}return t}var IB,yB=(A(KB,IB=ur),KB);function KB(A,e){A=IB.call(this,A,e)||this,e=e.options[e.selectedIndex||0];return A.value=e&&e.text||"",A}var mB,LB=(A(bB,mB=ur),bB);function bB(A,e){A=mB.call(this,A,e)||this;return A.value=e.value,A}var DB,vB=(A(xB,DB=ur),xB);function xB(A,e){var t,r,B=DB.call(this,A,e)||this;B.src=e.src,B.width=parseInt(e.width,10)||0,B.height=parseInt(e.height,10)||0,B.backgroundColor=B.styles.backgroundColor;try{e.contentWindow&&e.contentWindow.document&&e.contentWindow.document.documentElement&&(B.tree=kB(A,e.contentWindow.document.documentElement),t=e.contentWindow.document.documentElement?fe(A,getComputedStyle(e.contentWindow.document.documentElement).backgroundColor):Le.TRANSPARENT,r=e.contentWindow.document.body?fe(A,getComputedStyle(e.contentWindow.document.body).backgroundColor):Le.TRANSPARENT,B.backgroundColor=oe(t)?oe(r)?B.styles.backgroundColor:r:t)}catch(A){}return B}function MB(A){return"VIDEO"===A.tagName}function SB(A){return"STYLE"===A.tagName}function TB(A){return 0<A.tagName.indexOf("-")}var GB=["OL","UL","MENU"],OB=function(e,A,t,r){for(var B=A.firstChild;B;B=s){var n,s=B.nextSibling;PB(B)&&0<B.data.trim().length?t.textNodes.push(new zr(e,B,t.styles)):XB(B)&&(rn(B)&&B.assignedNodes?B.assignedNodes().forEach(function(A){return OB(e,A,t,r)}):(n=VB(e,B)).styles.isVisible()&&(RB(B,n,r)?n.flags|=4:NB(n.styles)&&(n.flags|=2),-1!==GB.indexOf(B.tagName)&&(n.flags|=8),t.elements.push(n),B.slot,B.shadowRoot?OB(e,B.shadowRoot,n,r):en(B)||qB(B)||tn(B)||OB(e,B,n,r)))}},VB=function(A,e){return new($B(e)?tB:zB(e)?nB:qB(e)?iB:WB(e)?aB:ZB(e)?UB:_B(e)?pB:tn(e)?yB:en(e)?LB:An(e)?vB:ur)(A,e)},kB=function(A,e){var t=VB(A,e);return t.flags|=4,OB(A,e,t,t),t},RB=function(A,e,t){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||jB(A)&&t.styles.isTransparent()},NB=function(A){return A.isPositioned()||A.isFloating()},PB=function(A){return A.nodeType===Node.TEXT_NODE},XB=function(A){return A.nodeType===Node.ELEMENT_NODE},JB=function(A){return XB(A)&&void 0!==A.style&&!YB(A)},YB=function(A){return"object"==typeof A.className},WB=function(A){return"LI"===A.tagName},ZB=function(A){return"OL"===A.tagName},_B=function(A){return"INPUT"===A.tagName},qB=function(A){return"svg"===A.tagName},jB=function(A){return"BODY"===A.tagName},zB=function(A){return"CANVAS"===A.tagName},$B=function(A){return"IMG"===A.tagName},An=function(A){return"IFRAME"===A.tagName},en=function(A){return"TEXTAREA"===A.tagName},tn=function(A){return"SELECT"===A.tagName},rn=function(A){return"SLOT"===A.tagName},Bn=(nn.prototype.getCounterValue=function(A){A=this.counters[A];return A&&A.length?A[A.length-1]:1},nn.prototype.getCounterValues=function(A){A=this.counters[A];return A||[]},nn.prototype.pop=function(A){var e=this;A.forEach(function(A){return e.counters[A].pop()})},nn.prototype.parse=function(A){var t=this,e=A.counterIncrement,A=A.counterReset,r=!0;null!==e&&e.forEach(function(A){var e=t.counters[A.counter];e&&0!==A.increment&&(r=!1,e.length||e.push(1),e[Math.max(0,e.length-1)]+=A.increment)});var B=[];return r&&A.forEach(function(A){var e=t.counters[A.counter];B.push(A.counter),(e=e||(t.counters[A.counter]=[])).push(A.reset)}),B},nn);function nn(){this.counters={}}function sn(r,A,e,B,t,n){return r<A||e<r?Fn(r,t,0<n.length):B.integers.reduce(function(A,e,t){for(;e<=r;)r-=e,A+=B.values[t];return A},"")+n}function on(A,e,t,r){for(var B="";t||A--,B=r(A)+B,e<=(A/=e)*e;);return B}function Qn(A,e,t,r,B){var n=t-e+1;return(A<0?"-":"")+(on(Math.abs(A),n,r,function(A){return g(Math.floor(A%n)+e)})+B)}function cn(A,e,t){void 0===t&&(t=". ");var r=e.length;return on(Math.abs(A),r,!1,function(A){return e[Math.floor(A%r)]})+t}function an(A,e,t,r,B,n){if(A<-9999||9999<A)return Fn(A,4,0<B.length);var s=Math.abs(A),o=B;if(0===s)return e[0]+o;for(var i=0;0<s&&i<=4;i++){var Q=s%10;0==Q&&Pt(n,1)&&""!==o?o=e[Q]+o:1<Q||1==Q&&0===i||1==Q&&1===i&&Pt(n,2)||1==Q&&1===i&&Pt(n,4)&&100<A||1==Q&&1<i&&Pt(n,8)?o=e[Q]+(0<i?t[i-1]:"")+o:1==Q&&0<i&&(o=t[i-1]+o),s=Math.floor(s/10)}return(A<0?r:"")+o}var gn,wn={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Un={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Ք","Փ","Ւ","Ց","Ր","Տ","Վ","Ս","Ռ","Ջ","Պ","Չ","Ո","Շ","Ն","Յ","Մ","Ճ","Ղ","Ձ","Հ","Կ","Ծ","Խ","Լ","Ի","Ժ","Թ","Ը","Է","Զ","Ե","Դ","Գ","Բ","Ա"]},ln={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["י׳","ט׳","ח׳","ז׳","ו׳","ה׳","ד׳","ג׳","ב׳","א׳","ת","ש","ר","ק","צ","פ","ע","ס","נ","מ","ל","כ","יט","יח","יז","טז","טו","י","ט","ח","ז","ו","ה","ד","ג","ב","א"]},Cn={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["ჵ","ჰ","ჯ","ჴ","ხ","ჭ","წ","ძ","ც","ჩ","შ","ყ","ღ","ქ","ფ","ჳ","ტ","ს","რ","ჟ","პ","ო","ჲ","ნ","მ","ლ","კ","ი","თ","ჱ","ზ","ვ","ე","დ","გ","ბ","ა"]},un="마이너스",Fn=function(A,e,t){var r=t?". ":"",B=t?"、":"",n=t?", ":"",s=t?" ":"";switch(e){case 0:return"•"+s;case 1:return"◦"+s;case 2:return"◾"+s;case 5:var o=Qn(A,48,57,!0,r);return o.length<4?"0"+o:o;case 4:return cn(A,"〇一二三四五六七八九",B);case 6:return sn(A,1,3999,wn,3,r).toLowerCase();case 7:return sn(A,1,3999,wn,3,r);case 8:return Qn(A,945,969,!1,r);case 9:return Qn(A,97,122,!1,r);case 10:return Qn(A,65,90,!1,r);case 11:return Qn(A,1632,1641,!0,r);case 12:case 49:return sn(A,1,9999,Un,3,r);case 35:return sn(A,1,9999,Un,3,r).toLowerCase();case 13:return Qn(A,2534,2543,!0,r);case 14:case 30:return Qn(A,6112,6121,!0,r);case 15:return cn(A,"子丑寅卯辰巳午未申酉戌亥",B);case 16:return cn(A,"甲乙丙丁戊己庚辛壬癸",B);case 17:case 48:return an(A,"零一二三四五六七八九","十百千萬","負",B,14);case 47:return an(A,"零壹貳參肆伍陸柒捌玖","拾佰仟萬","負",B,15);case 42:return an(A,"零一二三四五六七八九","十百千萬","负",B,14);case 41:return an(A,"零壹贰叁肆伍陆柒捌玖","拾佰仟萬","负",B,15);case 26:return an(A,"〇一二三四五六七八九","十百千万","マイナス",B,0);case 25:return an(A,"零壱弐参四伍六七八九","拾百千万","マイナス",B,7);case 31:return an(A,"영일이삼사오육칠팔구","십백천만",un,n,7);case 33:return an(A,"零一二三四五六七八九","十百千萬",un,n,0);case 32:return an(A,"零壹貳參四五六七八九","拾百千",un,n,7);case 18:return Qn(A,2406,2415,!0,r);case 20:return sn(A,1,19999,Cn,3,r);case 21:return Qn(A,2790,2799,!0,r);case 22:return Qn(A,2662,2671,!0,r);case 22:return sn(A,1,10999,ln,3,r);case 23:return cn(A,"あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほまみむめもやゆよらりるれろわゐゑをん");case 24:return cn(A,"いろはにほへとちりぬるをわかよたれそつねならむうゐのおくやまけふこえてあさきゆめみしゑひもせす");case 27:return Qn(A,3302,3311,!0,r);case 28:return cn(A,"アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヰヱヲン",B);case 29:return cn(A,"イロハニホヘトチリヌルヲワカヨタレソツネナラムウヰノオクヤマケフコエテアサキユメミシヱヒモセス",B);case 34:return Qn(A,3792,3801,!0,r);case 37:return Qn(A,6160,6169,!0,r);case 38:return Qn(A,4160,4169,!0,r);case 39:return Qn(A,2918,2927,!0,r);case 40:return Qn(A,1776,1785,!0,r);case 43:return Qn(A,3046,3055,!0,r);case 44:return Qn(A,3174,3183,!0,r);case 45:return Qn(A,3664,3673,!0,r);case 46:return Qn(A,3872,3881,!0,r);default:return Qn(A,48,57,!0,r)}},hn="data-html2canvas-ignore",dn=(fn.prototype.toIFrame=function(A,r){var e=this,B=pn(A,r);if(!B.contentWindow)return Promise.reject("Unable to find iframe window");var t=A.defaultView.pageXOffset,n=A.defaultView.pageYOffset,s=B.contentWindow,o=s.document,A=In(B).then(function(){return a(e,void 0,void 0,function(){var e,t;return H(this,function(A){switch(A.label){case 0:return this.scrolledElements.forEach(bn),s&&(s.scrollTo(r.left,r.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||s.scrollY===r.top&&s.scrollX===r.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-r.left,s.scrollY-r.top,0,0))),e=this.options.onclone,void 0===(t=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:o.fonts&&o.fonts.ready?[4,o.fonts.ready]:[3,2];case 1:A.sent(),A.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,En(o)]:[3,4];case 3:A.sent(),A.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then(function(){return e(o,t)}).then(function(){return B})]:[2,B]}})})});return o.open(),o.write(mn(document.doctype)+"<html></html>"),Ln(this.referenceElement.ownerDocument,t,n),o.replaceChild(o.adoptNode(this.documentElement),o.documentElement),o.close(),A},fn.prototype.createElementClone=function(A){if(Cr(A,2),zB(A))return this.createCanvasClone(A);if(MB(A))return this.createVideoClone(A);if(SB(A))return this.createStyleClone(A);var e=A.cloneNode(!1);return $B(e)&&($B(A)&&A.currentSrc&&A.currentSrc!==A.src&&(e.src=A.currentSrc,e.srcset=""),"lazy"===e.loading&&(e.loading="eager")),TB(e)?this.createCustomElementClone(e):e},fn.prototype.createCustomElementClone=function(A){var e=document.createElement("html2canvascustomelement");return Kn(A.style,e),e},fn.prototype.createStyleClone=function(A){try{var e=A.sheet;if(e&&e.cssRules){var t=[].slice.call(e.cssRules,0).reduce(function(A,e){return e&&"string"==typeof e.cssText?A+e.cssText:A},""),r=A.cloneNode(!1);return r.textContent=t,r}}catch(A){if(this.context.logger.error("Unable to access cssRules property",A),"SecurityError"!==A.name)throw A}return A.cloneNode(!1)},fn.prototype.createCanvasClone=function(e){var A;if(this.options.inlineImages&&e.ownerDocument){var t=e.ownerDocument.createElement("img");try{return t.src=e.toDataURL(),t}catch(A){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}t=e.cloneNode(!1);try{t.width=e.width,t.height=e.height;var r,B,n=e.getContext("2d"),s=t.getContext("2d");return s&&(!this.options.allowTaint&&n?s.putImageData(n.getImageData(0,0,e.width,e.height),0,0):(!(r=null!==(A=e.getContext("webgl2"))&&void 0!==A?A:e.getContext("webgl"))||!1===(null==(B=r.getContextAttributes())?void 0:B.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e),s.drawImage(e,0,0))),t}catch(A){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return t},fn.prototype.createVideoClone=function(e){var A=e.ownerDocument.createElement("canvas");A.width=e.offsetWidth,A.height=e.offsetHeight;var t=A.getContext("2d");try{return t&&(t.drawImage(e,0,0,A.width,A.height),this.options.allowTaint||t.getImageData(0,0,A.width,A.height)),A}catch(A){this.context.logger.info("Unable to clone video as it is tainted",e)}A=e.ownerDocument.createElement("canvas");return A.width=e.offsetWidth,A.height=e.offsetHeight,A},fn.prototype.appendChildNode=function(A,e,t){XB(e)&&("SCRIPT"===e.tagName||e.hasAttribute(hn)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(e))||this.options.copyStyles&&XB(e)&&SB(e)||A.appendChild(this.cloneNode(e,t))},fn.prototype.cloneChildNodes=function(A,e,t){for(var r,B=this,n=(A.shadowRoot||A).firstChild;n;n=n.nextSibling)XB(n)&&rn(n)&&"function"==typeof n.assignedNodes?(r=n.assignedNodes()).length&&r.forEach(function(A){return B.appendChildNode(e,A,t)}):this.appendChildNode(e,n,t)},fn.prototype.cloneNode=function(A,e){if(PB(A))return document.createTextNode(A.data);if(!A.ownerDocument)return A.cloneNode(!1);var t=A.ownerDocument.defaultView;if(t&&XB(A)&&(JB(A)||YB(A))){var r=this.createElementClone(A);r.style.transitionProperty="none";var B=t.getComputedStyle(A),n=t.getComputedStyle(A,":before"),s=t.getComputedStyle(A,":after");this.referenceElement===A&&JB(r)&&(this.clonedReferenceElement=r),jB(r)&&Mn(r);t=this.counters.parse(new Ur(this.context,B)),n=this.resolvePseudoContent(A,r,n,gn.BEFORE);TB(A)&&(e=!0),MB(A)||this.cloneChildNodes(A,r,e),n&&r.insertBefore(n,r.firstChild);s=this.resolvePseudoContent(A,r,s,gn.AFTER);return s&&r.appendChild(s),this.counters.pop(t),(B&&(this.options.copyStyles||YB(A))&&!An(A)||e)&&Kn(B,r),0===A.scrollTop&&0===A.scrollLeft||this.scrolledElements.push([r,A.scrollLeft,A.scrollTop]),(en(A)||tn(A))&&(en(r)||tn(r))&&(r.value=A.value),r}return A.cloneNode(!1)},fn.prototype.resolvePseudoContent=function(o,A,e,t){var i=this;if(e){var r=e.content,Q=A.ownerDocument;if(Q&&r&&"none"!==r&&"-moz-alt-content"!==r&&"none"!==e.display){this.counters.parse(new Ur(this.context,e));var c=new wr(this.context,e),a=Q.createElement("html2canvaspseudoelement");Kn(e,a),c.content.forEach(function(A){if(0===A.type)a.appendChild(Q.createTextNode(A.value));else if(22===A.type){var e=Q.createElement("img");e.src=A.value,e.style.opacity="1",a.appendChild(e)}else if(18===A.type){var t,r,B,n,s;"attr"===A.name?(e=A.values.filter(_A)).length&&a.appendChild(Q.createTextNode(o.getAttribute(e[0].value)||"")):"counter"===A.name?(B=(r=A.values.filter($A))[0],r=r[1],B&&_A(B)&&(t=i.counters.getCounterValue(B.value),s=r&&_A(r)?pt.parse(i.context,r.value):3,a.appendChild(Q.createTextNode(Fn(t,s,!1))))):"counters"===A.name&&(B=(t=A.values.filter($A))[0],s=t[1],r=t[2],B&&_A(B)&&(B=i.counters.getCounterValues(B.value),n=r&&_A(r)?pt.parse(i.context,r.value):3,s=s&&0===s.type?s.value:"",s=B.map(function(A){return Fn(A,n,!1)}).join(s),a.appendChild(Q.createTextNode(s))))}else if(20===A.type)switch(A.value){case"open-quote":a.appendChild(Q.createTextNode(Xt(c.quotes,i.quoteDepth++,!0)));break;case"close-quote":a.appendChild(Q.createTextNode(Xt(c.quotes,--i.quoteDepth,!1)));break;default:a.appendChild(Q.createTextNode(A.value))}}),a.className=Dn+" "+vn;t=t===gn.BEFORE?" "+Dn:" "+vn;return YB(A)?A.className.baseValue+=t:A.className+=t,a}}},fn.destroy=function(A){return!!A.parentNode&&(A.parentNode.removeChild(A),!0)},fn);function fn(A,e,t){if(this.context=A,this.options=t,this.scrolledElements=[],this.referenceElement=e,this.counters=new Bn,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}(he=gn=gn||{})[he.BEFORE=0]="BEFORE",he[he.AFTER=1]="AFTER";function Hn(e){return new Promise(function(A){!e.complete&&e.src?(e.onload=A,e.onerror=A):A()})}var pn=function(A,e){var t=A.createElement("iframe");return t.className="html2canvas-container",t.style.visibility="hidden",t.style.position="fixed",t.style.left="-10000px",t.style.top="0px",t.style.border="0",t.width=e.width.toString(),t.height=e.height.toString(),t.scrolling="no",t.setAttribute(hn,"true"),A.body.appendChild(t),t},En=function(A){return Promise.all([].slice.call(A.images,0).map(Hn))},In=function(B){return new Promise(function(e,A){var t=B.contentWindow;if(!t)return A("No window assigned for iframe");var r=t.document;t.onload=B.onload=function(){t.onload=B.onload=null;var A=setInterval(function(){0<r.body.childNodes.length&&"complete"===r.readyState&&(clearInterval(A),e(B))},50)}})},yn=["all","d","content"],Kn=function(A,e){for(var t=A.length-1;0<=t;t--){var r=A.item(t);-1===yn.indexOf(r)&&e.style.setProperty(r,A.getPropertyValue(r))}return e},mn=function(A){var e="";return A&&(e+="<!DOCTYPE ",A.name&&(e+=A.name),A.internalSubset&&(e+=A.internalSubset),A.publicId&&(e+='"'+A.publicId+'"'),A.systemId&&(e+='"'+A.systemId+'"'),e+=">"),e},Ln=function(A,e,t){A&&A.defaultView&&(e!==A.defaultView.pageXOffset||t!==A.defaultView.pageYOffset)&&A.defaultView.scrollTo(e,t)},bn=function(A){var e=A[0],t=A[1],A=A[2];e.scrollLeft=t,e.scrollTop=A},Dn="___html2canvas___pseudoelement_before",vn="___html2canvas___pseudoelement_after",xn='{\n    content: "" !important;\n    display: none !important;\n}',Mn=function(A){Sn(A,"."+Dn+":before"+xn+"\n         ."+vn+":after"+xn)},Sn=function(A,e){var t=A.ownerDocument;t&&((t=t.createElement("style")).textContent=e,A.appendChild(t))},Tn=(Gn.getOrigin=function(A){var e=Gn._link;return e?(e.href=A,e.href=e.href,e.protocol+e.hostname+e.port):"about:blank"},Gn.isSameOrigin=function(A){return Gn.getOrigin(A)===Gn._origin},Gn.setContext=function(A){Gn._link=A.document.createElement("a"),Gn._origin=Gn.getOrigin(A.location.href)},Gn._origin="about:blank",Gn);function Gn(){}var On=(Vn.prototype.addImage=function(A){var e=Promise.resolve();return this.has(A)||(Yn(A)||Pn(A))&&(this._cache[A]=this.loadImage(A)).catch(function(){}),e},Vn.prototype.match=function(A){return this._cache[A]},Vn.prototype.loadImage=function(s){return a(this,void 0,void 0,function(){var e,r,t,B,n=this;return H(this,function(A){switch(A.label){case 0:return(e=Tn.isSameOrigin(s),r=!Xn(s)&&!0===this._options.useCORS&&Xr.SUPPORT_CORS_IMAGES&&!e,t=!Xn(s)&&!e&&!Yn(s)&&"string"==typeof this._options.proxy&&Xr.SUPPORT_CORS_XHR&&!r,e||!1!==this._options.allowTaint||Xn(s)||Yn(s)||t||r)?(B=s,t?[4,this.proxy(B)]:[3,2]):[2];case 1:B=A.sent(),A.label=2;case 2:return this.context.logger.debug("Added image "+s.substring(0,256)),[4,new Promise(function(A,e){var t=new Image;t.onload=function(){return A(t)},t.onerror=e,(Jn(B)||r)&&(t.crossOrigin="anonymous"),t.src=B,!0===t.complete&&setTimeout(function(){return A(t)},500),0<n._options.imageTimeout&&setTimeout(function(){return e("Timed out ("+n._options.imageTimeout+"ms) loading image")},n._options.imageTimeout)})];case 3:return[2,A.sent()]}})})},Vn.prototype.has=function(A){return void 0!==this._cache[A]},Vn.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},Vn.prototype.proxy=function(s){var o=this,i=this._options.proxy;if(!i)throw new Error("No proxy defined");var Q=s.substring(0,256);return new Promise(function(e,t){var r=Xr.SUPPORT_RESPONSE_TYPE?"blob":"text",B=new XMLHttpRequest;B.onload=function(){var A;200===B.status?"text"==r?e(B.response):((A=new FileReader).addEventListener("load",function(){return e(A.result)},!1),A.addEventListener("error",function(A){return t(A)},!1),A.readAsDataURL(B.response)):t("Failed to proxy resource "+Q+" with status code "+B.status)},B.onerror=t;var A,n=-1<i.indexOf("?")?"&":"?";B.open("GET",i+n+"url="+encodeURIComponent(s)+"&responseType="+r),"text"!=r&&B instanceof XMLHttpRequest&&(B.responseType=r),o._options.imageTimeout&&(A=o._options.imageTimeout,B.timeout=A,B.ontimeout=function(){return t("Timed out ("+A+"ms) proxying "+Q)}),B.send()})},Vn);function Vn(A,e){this.context=A,this._options=e,this._cache={}}var kn=/^data:image\/svg\+xml/i,Rn=/^data:image\/.*;base64,/i,Nn=/^data:image\/.*/i,Pn=function(A){return Xr.SUPPORT_SVG_DRAWING||!Wn(A)},Xn=function(A){return Nn.test(A)},Jn=function(A){return Rn.test(A)},Yn=function(A){return"blob"===A.substr(0,4)},Wn=function(A){return"svg"===A.substr(-3).toLowerCase()||kn.test(A)},Zn=(_n.prototype.add=function(A,e){return new _n(this.x+A,this.y+e)},_n);function _n(A,e){this.type=0,this.x=A,this.y=e}function qn(A,e,t){return new Zn(A.x+(e.x-A.x)*t,A.y+(e.y-A.y)*t)}var jn=(zn.prototype.subdivide=function(A,e){var t=qn(this.start,this.startControl,A),r=qn(this.startControl,this.endControl,A),B=qn(this.endControl,this.end,A),n=qn(t,r,A),r=qn(r,B,A),A=qn(n,r,A);return e?new zn(this.start,t,n,A):new zn(A,r,B,this.end)},zn.prototype.add=function(A,e){return new zn(this.start.add(A,e),this.startControl.add(A,e),this.endControl.add(A,e),this.end.add(A,e))},zn.prototype.reverse=function(){return new zn(this.end,this.endControl,this.startControl,this.start)},zn);function zn(A,e,t,r){this.type=1,this.start=A,this.startControl=e,this.endControl=t,this.end=r}function $n(A){return 1===A.type}var As,es=function(A){var e=A.styles,t=A.bounds,r=(C=Be(e.borderTopLeftRadius,t.width,t.height))[0],B=C[1],n=(u=Be(e.borderTopRightRadius,t.width,t.height))[0],s=u[1],o=(F=Be(e.borderBottomRightRadius,t.width,t.height))[0],i=F[1],Q=(h=Be(e.borderBottomLeftRadius,t.width,t.height))[0],c=h[1];(d=[]).push((r+n)/t.width),d.push((Q+o)/t.width),d.push((B+c)/t.height),d.push((s+i)/t.height),1<(f=Math.max.apply(Math,d))&&(r/=f,B/=f,n/=f,s/=f,o/=f,i/=f,Q/=f,c/=f);var a=t.width-n,g=t.height-i,w=t.width-o,U=t.height-c,l=e.borderTopWidth,C=e.borderRightWidth,u=e.borderBottomWidth,F=e.borderLeftWidth,h=Ue(e.paddingTop,A.bounds.width),d=Ue(e.paddingRight,A.bounds.width),f=Ue(e.paddingBottom,A.bounds.width),A=Ue(e.paddingLeft,A.bounds.width);this.topLeftBorderDoubleOuterBox=0<r||0<B?ss(t.left+F/3,t.top+l/3,r-F/3,B-l/3,As.TOP_LEFT):new Zn(t.left+F/3,t.top+l/3),this.topRightBorderDoubleOuterBox=0<r||0<B?ss(t.left+a,t.top+l/3,n-C/3,s-l/3,As.TOP_RIGHT):new Zn(t.left+t.width-C/3,t.top+l/3),this.bottomRightBorderDoubleOuterBox=0<o||0<i?ss(t.left+w,t.top+g,o-C/3,i-u/3,As.BOTTOM_RIGHT):new Zn(t.left+t.width-C/3,t.top+t.height-u/3),this.bottomLeftBorderDoubleOuterBox=0<Q||0<c?ss(t.left+F/3,t.top+U,Q-F/3,c-u/3,As.BOTTOM_LEFT):new Zn(t.left+F/3,t.top+t.height-u/3),this.topLeftBorderDoubleInnerBox=0<r||0<B?ss(t.left+2*F/3,t.top+2*l/3,r-2*F/3,B-2*l/3,As.TOP_LEFT):new Zn(t.left+2*F/3,t.top+2*l/3),this.topRightBorderDoubleInnerBox=0<r||0<B?ss(t.left+a,t.top+2*l/3,n-2*C/3,s-2*l/3,As.TOP_RIGHT):new Zn(t.left+t.width-2*C/3,t.top+2*l/3),this.bottomRightBorderDoubleInnerBox=0<o||0<i?ss(t.left+w,t.top+g,o-2*C/3,i-2*u/3,As.BOTTOM_RIGHT):new Zn(t.left+t.width-2*C/3,t.top+t.height-2*u/3),this.bottomLeftBorderDoubleInnerBox=0<Q||0<c?ss(t.left+2*F/3,t.top+U,Q-2*F/3,c-2*u/3,As.BOTTOM_LEFT):new Zn(t.left+2*F/3,t.top+t.height-2*u/3),this.topLeftBorderStroke=0<r||0<B?ss(t.left+F/2,t.top+l/2,r-F/2,B-l/2,As.TOP_LEFT):new Zn(t.left+F/2,t.top+l/2),this.topRightBorderStroke=0<r||0<B?ss(t.left+a,t.top+l/2,n-C/2,s-l/2,As.TOP_RIGHT):new Zn(t.left+t.width-C/2,t.top+l/2),this.bottomRightBorderStroke=0<o||0<i?ss(t.left+w,t.top+g,o-C/2,i-u/2,As.BOTTOM_RIGHT):new Zn(t.left+t.width-C/2,t.top+t.height-u/2),this.bottomLeftBorderStroke=0<Q||0<c?ss(t.left+F/2,t.top+U,Q-F/2,c-u/2,As.BOTTOM_LEFT):new Zn(t.left+F/2,t.top+t.height-u/2),this.topLeftBorderBox=0<r||0<B?ss(t.left,t.top,r,B,As.TOP_LEFT):new Zn(t.left,t.top),this.topRightBorderBox=0<n||0<s?ss(t.left+a,t.top,n,s,As.TOP_RIGHT):new Zn(t.left+t.width,t.top),this.bottomRightBorderBox=0<o||0<i?ss(t.left+w,t.top+g,o,i,As.BOTTOM_RIGHT):new Zn(t.left+t.width,t.top+t.height),this.bottomLeftBorderBox=0<Q||0<c?ss(t.left,t.top+U,Q,c,As.BOTTOM_LEFT):new Zn(t.left,t.top+t.height),this.topLeftPaddingBox=0<r||0<B?ss(t.left+F,t.top+l,Math.max(0,r-F),Math.max(0,B-l),As.TOP_LEFT):new Zn(t.left+F,t.top+l),this.topRightPaddingBox=0<n||0<s?ss(t.left+Math.min(a,t.width-C),t.top+l,a>t.width+C?0:Math.max(0,n-C),Math.max(0,s-l),As.TOP_RIGHT):new Zn(t.left+t.width-C,t.top+l),this.bottomRightPaddingBox=0<o||0<i?ss(t.left+Math.min(w,t.width-F),t.top+Math.min(g,t.height-u),Math.max(0,o-C),Math.max(0,i-u),As.BOTTOM_RIGHT):new Zn(t.left+t.width-C,t.top+t.height-u),this.bottomLeftPaddingBox=0<Q||0<c?ss(t.left+F,t.top+Math.min(U,t.height-u),Math.max(0,Q-F),Math.max(0,c-u),As.BOTTOM_LEFT):new Zn(t.left+F,t.top+t.height-u),this.topLeftContentBox=0<r||0<B?ss(t.left+F+A,t.top+l+h,Math.max(0,r-(F+A)),Math.max(0,B-(l+h)),As.TOP_LEFT):new Zn(t.left+F+A,t.top+l+h),this.topRightContentBox=0<n||0<s?ss(t.left+Math.min(a,t.width+F+A),t.top+l+h,a>t.width+F+A?0:n-F+A,s-(l+h),As.TOP_RIGHT):new Zn(t.left+t.width-(C+d),t.top+l+h),this.bottomRightContentBox=0<o||0<i?ss(t.left+Math.min(w,t.width-(F+A)),t.top+Math.min(g,t.height+l+h),Math.max(0,o-(C+d)),i-(u+f),As.BOTTOM_RIGHT):new Zn(t.left+t.width-(C+d),t.top+t.height-(u+f)),this.bottomLeftContentBox=0<Q||0<c?ss(t.left+F+A,t.top+U,Math.max(0,Q-(F+A)),c-(u+f),As.BOTTOM_LEFT):new Zn(t.left+F+A,t.top+t.height-(u+f))};(he=As=As||{})[he.TOP_LEFT=0]="TOP_LEFT",he[he.TOP_RIGHT=1]="TOP_RIGHT",he[he.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",he[he.BOTTOM_LEFT=3]="BOTTOM_LEFT";function ts(A){return[A.topLeftBorderBox,A.topRightBorderBox,A.bottomRightBorderBox,A.bottomLeftBorderBox]}function rs(A){return[A.topLeftPaddingBox,A.topRightPaddingBox,A.bottomRightPaddingBox,A.bottomLeftPaddingBox]}function Bs(A){return 1===A.type}function ns(A,t){return A.length===t.length&&A.some(function(A,e){return A===t[e]})}var ss=function(A,e,t,r,B){var n=(Math.sqrt(2)-1)/3*4,s=t*n,o=r*n,i=A+t,Q=e+r;switch(B){case As.TOP_LEFT:return new jn(new Zn(A,Q),new Zn(A,Q-o),new Zn(i-s,e),new Zn(i,e));case As.TOP_RIGHT:return new jn(new Zn(A,e),new Zn(A+s,e),new Zn(i,Q-o),new Zn(i,Q));case As.BOTTOM_RIGHT:return new jn(new Zn(i,e),new Zn(i,e+o),new Zn(A+s,Q),new Zn(A,Q));default:As.BOTTOM_LEFT;return new jn(new Zn(i,Q),new Zn(i-s,Q),new Zn(A,e+o),new Zn(A,e))}},os=function(A,e,t){this.offsetX=A,this.offsetY=e,this.matrix=t,this.type=0,this.target=6},is=function(A,e){this.path=A,this.target=e,this.type=1},Qs=function(A){this.opacity=A,this.type=2,this.target=6},cs=function(A){this.element=A,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},as=(gs.prototype.getEffects=function(e){for(var A=-1===[2,3].indexOf(this.container.styles.position),t=this.parent,r=this.effects.slice(0);t;){var B,n,s=t.effects.filter(function(A){return!Bs(A)});A||0!==t.container.styles.position||!t.parent?(r.unshift.apply(r,s),A=-1===[2,3].indexOf(t.container.styles.position),0!==t.container.styles.overflowX&&(B=ts(t.curves),n=rs(t.curves),ns(B,n)||r.unshift(new is(n,6)))):r.unshift.apply(r,s),t=t.parent}return r.filter(function(A){return Pt(A.target,e)})},gs);function gs(A,e){var t,r;this.container=A,this.parent=e,this.effects=[],this.curves=new es(this.container),this.container.styles.opacity<1&&this.effects.push(new Qs(this.container.styles.opacity)),null!==this.container.styles.transform&&(e=this.container.bounds.left+this.container.styles.transformOrigin[0].number,t=this.container.bounds.top+this.container.styles.transformOrigin[1].number,r=this.container.styles.transform,this.effects.push(new os(e,t,r))),0!==this.container.styles.overflowX&&(t=ts(this.curves),r=rs(this.curves),ns(t,r)?this.effects.push(new is(t,6)):(this.effects.push(new is(t,2)),this.effects.push(new is(r,4))))}function ws(A,e){switch(e){case 0:return Hs(A.topLeftBorderBox,A.topLeftPaddingBox,A.topRightBorderBox,A.topRightPaddingBox);case 1:return Hs(A.topRightBorderBox,A.topRightPaddingBox,A.bottomRightBorderBox,A.bottomRightPaddingBox);case 2:return Hs(A.bottomRightBorderBox,A.bottomRightPaddingBox,A.bottomLeftBorderBox,A.bottomLeftPaddingBox);default:return Hs(A.bottomLeftBorderBox,A.bottomLeftPaddingBox,A.topLeftBorderBox,A.topLeftPaddingBox)}}function Us(A){var e=A.bounds,A=A.styles;return e.add(A.borderLeftWidth,A.borderTopWidth,-(A.borderRightWidth+A.borderLeftWidth),-(A.borderTopWidth+A.borderBottomWidth))}function ls(A){var e=A.styles,t=A.bounds,r=Ue(e.paddingLeft,t.width),B=Ue(e.paddingRight,t.width),n=Ue(e.paddingTop,t.width),A=Ue(e.paddingBottom,t.width);return t.add(r+e.borderLeftWidth,n+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+r+B),-(e.borderTopWidth+e.borderBottomWidth+n+A))}function Cs(A,e,t){var r=(B=Es(A.styles.backgroundOrigin,e),n=A,0===B?n.bounds:(2===B?ls:Us)(n)),B=(s=Es(A.styles.backgroundClip,e),o=A,0===s?o.bounds:(2===s?ls:Us)(o)),n=ps(Es(A.styles.backgroundSize,e),t,r),s=n[0],o=n[1],t=Be(Es(A.styles.backgroundPosition,e),r.width-s,r.height-o);return[Is(Es(A.styles.backgroundRepeat,e),t,n,r,B),Math.round(r.left+t[0]),Math.round(r.top+t[1]),s,o]}function us(A){return _A(A)&&A.value===Ve.AUTO}function Fs(A){return"number"==typeof A}var hs=function(Q,c,a,g){Q.container.elements.forEach(function(A){var e=Pt(A.flags,4),t=Pt(A.flags,2),r=new as(A,Q);Pt(A.styles.display,2048)&&g.push(r);var B,n,s,o,i=Pt(A.flags,8)?[]:g;e||t?(B=e||A.styles.isPositioned()?a:c,t=new cs(r),A.styles.isPositioned()||A.styles.opacity<1||A.styles.isTransformed()?(n=A.styles.zIndex.order)<0?(s=0,B.negativeZIndex.some(function(A,e){return n>A.element.container.styles.zIndex.order?(s=e,!1):0<s}),B.negativeZIndex.splice(s,0,t)):0<n?(o=0,B.positiveZIndex.some(function(A,e){return n>=A.element.container.styles.zIndex.order?(o=e+1,!1):0<o}),B.positiveZIndex.splice(o,0,t)):B.zeroOrAutoZIndexOrTransformedOrOpacity.push(t):(A.styles.isFloating()?B.nonPositionedFloats:B.nonPositionedInlineLevel).push(t),hs(r,t,e?t:a,i)):((A.styles.isInlineLevel()?c.inlineLevel:c.nonInlineLevel).push(r),hs(r,c,a,i)),Pt(A.flags,8)&&ds(A,i)})},ds=function(A,e){for(var t=A instanceof UB?A.start:1,r=A instanceof UB&&A.reversed,B=0;B<e.length;B++){var n=e[B];n.container instanceof aB&&"number"==typeof n.container.value&&0!==n.container.value&&(t=n.container.value),n.listValue=Fn(t,n.container.styles.listStyleType,!0),t+=r?-1:1}},fs=function(A,e){var t=[];return $n(A)?t.push(A.subdivide(.5,!1)):t.push(A),$n(e)?t.push(e.subdivide(.5,!0)):t.push(e),t},Hs=function(A,e,t,r){var B=[];return $n(A)?B.push(A.subdivide(.5,!1)):B.push(A),$n(t)?B.push(t.subdivide(.5,!0)):B.push(t),$n(r)?B.push(r.subdivide(.5,!0).reverse()):B.push(r),$n(e)?B.push(e.subdivide(.5,!1).reverse()):B.push(e),B},ps=function(A,e,t){var r=e[0],B=e[1],n=e[2],s=A[0],o=A[1];if(!s)return[0,0];if(te(s)&&o&&te(o))return[Ue(s,t.width),Ue(o,t.height)];var i=Fs(n);if(_A(s)&&(s.value===Ve.CONTAIN||s.value===Ve.COVER))return Fs(n)?t.width/t.height<n!=(s.value===Ve.COVER)?[t.width,t.width/n]:[t.height*n,t.height]:[t.width,t.height];var Q=Fs(r),e=Fs(B),A=Q||e;if(us(s)&&(!o||us(o)))return Q&&e?[r,B]:i||A?A&&i?[Q?r:B*n,e?B:r/n]:[Q?r:t.width,e?B:t.height]:[t.width,t.height];if(i){var c=0,a=0;return te(s)?c=Ue(s,t.width):te(o)&&(a=Ue(o,t.height)),us(s)?c=a*n:o&&!us(o)||(a=c/n),[c,a]}c=null,a=null;if(te(s)?c=Ue(s,t.width):o&&te(o)&&(a=Ue(o,t.height)),null!==(c=null!==(a=null!==c&&(!o||us(o))?Q&&e?c/r*B:t.height:a)&&us(s)?Q&&e?a/B*r:t.width:c)&&null!==a)return[c,a];throw new Error("Unable to calculate background-size for element")},Es=function(A,e){e=A[e];return void 0===e?A[0]:e},Is=function(A,e,t,r,B){var n=e[0],s=e[1],o=t[0],i=t[1];switch(A){case 2:return[new Zn(Math.round(r.left),Math.round(r.top+s)),new Zn(Math.round(r.left+r.width),Math.round(r.top+s)),new Zn(Math.round(r.left+r.width),Math.round(i+r.top+s)),new Zn(Math.round(r.left),Math.round(i+r.top+s))];case 3:return[new Zn(Math.round(r.left+n),Math.round(r.top)),new Zn(Math.round(r.left+n+o),Math.round(r.top)),new Zn(Math.round(r.left+n+o),Math.round(r.height+r.top)),new Zn(Math.round(r.left+n),Math.round(r.height+r.top))];case 1:return[new Zn(Math.round(r.left+n),Math.round(r.top+s)),new Zn(Math.round(r.left+n+o),Math.round(r.top+s)),new Zn(Math.round(r.left+n+o),Math.round(r.top+s+i)),new Zn(Math.round(r.left+n),Math.round(r.top+s+i))];default:return[new Zn(Math.round(B.left),Math.round(B.top)),new Zn(Math.round(B.left+B.width),Math.round(B.top)),new Zn(Math.round(B.left+B.width),Math.round(B.height+B.top)),new Zn(Math.round(B.left),Math.round(B.height+B.top))]}},ys="Hidden Text",Ks=(ms.prototype.parseMetrics=function(A,e){var t=this._document.createElement("div"),r=this._document.createElement("img"),B=this._document.createElement("span"),n=this._document.body;t.style.visibility="hidden",t.style.fontFamily=A,t.style.fontSize=e,t.style.margin="0",t.style.padding="0",t.style.whiteSpace="nowrap",n.appendChild(t),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",B.style.fontFamily=A,B.style.fontSize=e,B.style.margin="0",B.style.padding="0",B.appendChild(this._document.createTextNode(ys)),t.appendChild(B),t.appendChild(r);e=r.offsetTop-B.offsetTop+2;t.removeChild(B),t.appendChild(this._document.createTextNode(ys)),t.style.lineHeight="normal",r.style.verticalAlign="super";r=r.offsetTop-t.offsetTop+2;return n.removeChild(t),{baseline:e,middle:r}},ms.prototype.getMetrics=function(A,e){var t=A+" "+e;return void 0===this._data[t]&&(this._data[t]=this.parseMetrics(A,e)),this._data[t]},ms);function ms(A){this._data={},this._document=A}var Ls,he=function(A,e){this.context=A,this.options=e},bs=(A(Ds,Ls=he),Ds.prototype.applyEffects=function(A){for(var e=this;this._activeEffects.length;)this.popEffect();A.forEach(function(A){return e.applyEffect(A)})},Ds.prototype.applyEffect=function(A){this.ctx.save(),2===A.type&&(this.ctx.globalAlpha=A.opacity),0===A.type&&(this.ctx.translate(A.offsetX,A.offsetY),this.ctx.transform(A.matrix[0],A.matrix[1],A.matrix[2],A.matrix[3],A.matrix[4],A.matrix[5]),this.ctx.translate(-A.offsetX,-A.offsetY)),Bs(A)&&(this.path(A.path),this.ctx.clip()),this._activeEffects.push(A)},Ds.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},Ds.prototype.renderStack=function(e){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:A.sent(),A.label=2;case 2:return[2]}})})},Ds.prototype.renderNode=function(e){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return Pt(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return A.sent(),[4,this.renderNodeContent(e)];case 2:A.sent(),A.label=3;case 3:return[2]}})})},Ds.prototype.renderTextWithLetterSpacing=function(t,A,r){var B=this;0===A?this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+r):Zr(t.text).reduce(function(A,e){return B.ctx.fillText(e,A,t.bounds.top+r),A+B.ctx.measureText(e).width},t.bounds.left)},Ds.prototype.createFontStyle=function(A){var e=A.fontVariant.filter(function(A){return"normal"===A||"small-caps"===A}).join(""),t=Gs(A.fontFamily).join(", "),r=WA(A.fontSize)?""+A.fontSize.number+A.fontSize.unit:A.fontSize.number+"px";return[[A.fontStyle,e,A.fontWeight,r,t].join(" "),t,r]},Ds.prototype.renderTextNode=function(i,Q){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o=this;return H(this,function(A){return r=this.createFontStyle(Q),e=r[0],t=r[1],r=r[2],this.ctx.font=e,this.ctx.direction=1===Q.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",r=this.fontMetrics.getMetrics(t,r),B=r.baseline,n=r.middle,s=Q.paintOrder,i.textBounds.forEach(function(t){s.forEach(function(A){switch(A){case 0:o.ctx.fillStyle=ie(Q.color),o.renderTextWithLetterSpacing(t,Q.letterSpacing,B);var e=Q.textShadow;e.length&&t.text.trim().length&&(e.slice(0).reverse().forEach(function(A){o.ctx.shadowColor=ie(A.color),o.ctx.shadowOffsetX=A.offsetX.number*o.options.scale,o.ctx.shadowOffsetY=A.offsetY.number*o.options.scale,o.ctx.shadowBlur=A.blur.number,o.renderTextWithLetterSpacing(t,Q.letterSpacing,B)}),o.ctx.shadowColor="",o.ctx.shadowOffsetX=0,o.ctx.shadowOffsetY=0,o.ctx.shadowBlur=0),Q.textDecorationLine.length&&(o.ctx.fillStyle=ie(Q.textDecorationColor||Q.color),Q.textDecorationLine.forEach(function(A){switch(A){case 1:o.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top+B),t.bounds.width,1);break;case 2:o.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top),t.bounds.width,1);break;case 3:o.ctx.fillRect(t.bounds.left,Math.ceil(t.bounds.top+n),t.bounds.width,1)}}));break;case 1:Q.webkitTextStrokeWidth&&t.text.trim().length&&(o.ctx.strokeStyle=ie(Q.webkitTextStrokeColor),o.ctx.lineWidth=Q.webkitTextStrokeWidth,o.ctx.lineJoin=window.chrome?"miter":"round",o.ctx.strokeText(t.text,t.bounds.left,t.bounds.top+B)),o.ctx.strokeStyle="",o.ctx.lineWidth=0,o.ctx.lineJoin="miter"}})}),[2]})})},Ds.prototype.renderReplacedElement=function(A,e,t){var r;t&&0<A.intrinsicWidth&&0<A.intrinsicHeight&&(r=ls(A),e=rs(e),this.path(e),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(t,0,0,A.intrinsicWidth,A.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore())},Ds.prototype.renderNodeContent=function(w){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a,g;return H(this,function(A){switch(A.label){case 0:this.applyEffects(w.getEffects(4)),e=w.container,t=w.curves,r=e.styles,B=0,n=e.textNodes,A.label=1;case 1:return B<n.length?(s=n[B],[4,this.renderTextNode(s,r)]):[3,4];case 2:A.sent(),A.label=3;case 3:return B++,[3,1];case 4:if(!(e instanceof tB))return[3,8];A.label=5;case 5:return A.trys.push([5,7,,8]),[4,this.context.cache.match(e.src)];case 6:return Q=A.sent(),this.renderReplacedElement(e,t,Q),[3,8];case 7:return A.sent(),this.context.logger.error("Error loading image "+e.src),[3,8];case 8:if(e instanceof nB&&this.renderReplacedElement(e,t,e.canvas),!(e instanceof iB))return[3,12];A.label=9;case 9:return A.trys.push([9,11,,12]),[4,this.context.cache.match(e.svg)];case 10:return Q=A.sent(),this.renderReplacedElement(e,t,Q),[3,12];case 11:return A.sent(),this.context.logger.error("Error loading svg "+e.svg.substring(0,255)),[3,12];case 12:return e instanceof vB&&e.tree?[4,new Ds(this.context,{scale:this.options.scale,backgroundColor:e.backgroundColor,x:0,y:0,width:e.width,height:e.height}).render(e.tree)]:[3,14];case 13:s=A.sent(),e.width&&e.height&&this.ctx.drawImage(s,0,0,e.width,e.height,e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height),A.label=14;case 14:if(e instanceof pB&&(i=Math.min(e.bounds.width,e.bounds.height),e.type===hB?e.checked&&(this.ctx.save(),this.path([new Zn(e.bounds.left+.39363*i,e.bounds.top+.79*i),new Zn(e.bounds.left+.16*i,e.bounds.top+.5549*i),new Zn(e.bounds.left+.27347*i,e.bounds.top+.44071*i),new Zn(e.bounds.left+.39694*i,e.bounds.top+.5649*i),new Zn(e.bounds.left+.72983*i,e.bounds.top+.23*i),new Zn(e.bounds.left+.84*i,e.bounds.top+.34085*i),new Zn(e.bounds.left+.39363*i,e.bounds.top+.79*i)]),this.ctx.fillStyle=ie(HB),this.ctx.fill(),this.ctx.restore()):e.type===dB&&e.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.bounds.left+i/2,e.bounds.top+i/2,i/4,0,2*Math.PI,!0),this.ctx.fillStyle=ie(HB),this.ctx.fill(),this.ctx.restore())),xs(e)&&e.value.length){switch(c=this.createFontStyle(r),a=c[0],i=c[1],c=this.fontMetrics.getMetrics(a,i).baseline,this.ctx.font=a,this.ctx.fillStyle=ie(r.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Ss(e.styles.textAlign),g=ls(e),o=0,e.styles.textAlign){case 1:o+=g.width/2;break;case 2:o+=g.width}i=g.add(o,0,0,-g.height/2+1),this.ctx.save(),this.path([new Zn(g.left,g.top),new Zn(g.left+g.width,g.top),new Zn(g.left+g.width,g.top+g.height),new Zn(g.left,g.top+g.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Jr(e.value,i),r.letterSpacing,c),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Pt(e.styles.display,2048))return[3,20];if(null===e.styles.listStyleImage)return[3,19];if(0!==(c=e.styles.listStyleImage).type)return[3,18];Q=void 0,c=c.url,A.label=15;case 15:return A.trys.push([15,17,,18]),[4,this.context.cache.match(c)];case 16:return Q=A.sent(),this.ctx.drawImage(Q,e.bounds.left-(Q.width+10),e.bounds.top),[3,18];case 17:return A.sent(),this.context.logger.error("Error loading list-style-image "+c),[3,18];case 18:return[3,20];case 19:w.listValue&&-1!==e.styles.listStyleType&&(a=this.createFontStyle(r)[0],this.ctx.font=a,this.ctx.fillStyle=ie(r.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",g=new d(e.bounds.left,e.bounds.top+Ue(e.styles.paddingTop,e.bounds.width),e.bounds.width,Ye(r.lineHeight,r.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Jr(w.listValue,g),r.letterSpacing,Ye(r.lineHeight,r.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),A.label=20;case 20:return[2]}})})},Ds.prototype.renderStackContent=function(C){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a,g,w,U,l;return H(this,function(A){switch(A.label){case 0:return Pt(C.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(C.element)];case 1:A.sent(),e=0,t=C.negativeZIndex,A.label=2;case 2:return e<t.length?(l=t[e],[4,this.renderStack(l)]):[3,5];case 3:A.sent(),A.label=4;case 4:return e++,[3,2];case 5:return[4,this.renderNodeContent(C.element)];case 6:A.sent(),r=0,B=C.nonInlineLevel,A.label=7;case 7:return r<B.length?(l=B[r],[4,this.renderNode(l)]):[3,10];case 8:A.sent(),A.label=9;case 9:return r++,[3,7];case 10:n=0,s=C.nonPositionedFloats,A.label=11;case 11:return n<s.length?(l=s[n],[4,this.renderStack(l)]):[3,14];case 12:A.sent(),A.label=13;case 13:return n++,[3,11];case 14:o=0,i=C.nonPositionedInlineLevel,A.label=15;case 15:return o<i.length?(l=i[o],[4,this.renderStack(l)]):[3,18];case 16:A.sent(),A.label=17;case 17:return o++,[3,15];case 18:Q=0,c=C.inlineLevel,A.label=19;case 19:return Q<c.length?(l=c[Q],[4,this.renderNode(l)]):[3,22];case 20:A.sent(),A.label=21;case 21:return Q++,[3,19];case 22:a=0,g=C.zeroOrAutoZIndexOrTransformedOrOpacity,A.label=23;case 23:return a<g.length?(l=g[a],[4,this.renderStack(l)]):[3,26];case 24:A.sent(),A.label=25;case 25:return a++,[3,23];case 26:w=0,U=C.positiveZIndex,A.label=27;case 27:return w<U.length?(l=U[w],[4,this.renderStack(l)]):[3,30];case 28:A.sent(),A.label=29;case 29:return w++,[3,27];case 30:return[2]}})})},Ds.prototype.mask=function(A){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(A.slice(0).reverse()),this.ctx.closePath()},Ds.prototype.path=function(A){this.ctx.beginPath(),this.formatPath(A),this.ctx.closePath()},Ds.prototype.formatPath=function(A){var r=this;A.forEach(function(A,e){var t=$n(A)?A.start:A;0===e?r.ctx.moveTo(t.x,t.y):r.ctx.lineTo(t.x,t.y),$n(A)&&r.ctx.bezierCurveTo(A.startControl.x,A.startControl.y,A.endControl.x,A.endControl.y,A.end.x,A.end.y)})},Ds.prototype.renderRepeat=function(A,e,t,r){this.path(A),this.ctx.fillStyle=e,this.ctx.translate(t,r),this.ctx.fill(),this.ctx.translate(-t,-r)},Ds.prototype.resizeImage=function(A,e,t){if(A.width===e&&A.height===t)return A;var r=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return r.width=Math.max(1,e),r.height=Math.max(1,t),r.getContext("2d").drawImage(A,0,0,A.width,A.height,0,0,e,t),r},Ds.prototype.renderBackgroundImage=function(f){return a(this,void 0,void 0,function(){var h,e,d,t,r,B;return H(this,function(A){switch(A.label){case 0:h=f.styles.backgroundImage.length-1,e=function(e){var t,r,B,n,s,o,i,Q,c,a,g,w,U,l,C,u,F;return H(this,function(A){switch(A.label){case 0:if(0!==e.type)return[3,5];t=void 0,r=e.url,A.label=1;case 1:return A.trys.push([1,3,,4]),[4,d.context.cache.match(r)];case 2:return t=A.sent(),[3,4];case 3:return A.sent(),d.context.logger.error("Error loading background-image "+r),[3,4];case 4:return t&&(B=Cs(f,h,[t.width,t.height,t.width/t.height]),o=B[0],g=B[1],w=B[2],c=B[3],a=B[4],s=d.ctx.createPattern(d.resizeImage(t,c,a),"repeat"),d.renderRepeat(o,s,g,w)),[3,6];case 5:1===e.type?(F=Cs(f,h,[null,null,null]),o=F[0],g=F[1],w=F[2],c=F[3],a=F[4],C=Ee(e.angle,c,a),l=C[0],B=C[1],i=C[2],u=C[3],Q=C[4],(F=document.createElement("canvas")).width=c,F.height=a,C=F.getContext("2d"),n=C.createLinearGradient(B,u,i,Q),pe(e.stops,l).forEach(function(A){return n.addColorStop(A.stop,ie(A.color))}),C.fillStyle=n,C.fillRect(0,0,c,a),0<c&&0<a&&(s=d.ctx.createPattern(F,"repeat"),d.renderRepeat(o,s,g,w))):2===e.type&&(u=Cs(f,h,[null,null,null]),o=u[0],i=u[1],Q=u[2],c=u[3],a=u[4],l=0===e.position.length?[ge]:e.position,g=Ue(l[0],c),w=Ue(l[l.length-1],a),C=function(A,e,t,r,B){var n,s,o,i,Q=0,c=0;switch(A.size){case 0:0===A.shape?Q=c=Math.min(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-B)):1===A.shape&&(Q=Math.min(Math.abs(e),Math.abs(e-r)),c=Math.min(Math.abs(t),Math.abs(t-B)));break;case 2:0===A.shape?Q=c=Math.min(Ie(e,t),Ie(e,t-B),Ie(e-r,t),Ie(e-r,t-B)):1===A.shape&&(n=Math.min(Math.abs(t),Math.abs(t-B))/Math.min(Math.abs(e),Math.abs(e-r)),o=(s=ye(r,B,e,t,!0))[0],i=s[1],c=n*(Q=Ie(o-e,(i-t)/n)));break;case 1:0===A.shape?Q=c=Math.max(Math.abs(e),Math.abs(e-r),Math.abs(t),Math.abs(t-B)):1===A.shape&&(Q=Math.max(Math.abs(e),Math.abs(e-r)),c=Math.max(Math.abs(t),Math.abs(t-B)));break;case 3:0===A.shape?Q=c=Math.max(Ie(e,t),Ie(e,t-B),Ie(e-r,t),Ie(e-r,t-B)):1===A.shape&&(n=Math.max(Math.abs(t),Math.abs(t-B))/Math.max(Math.abs(e),Math.abs(e-r)),o=(s=ye(r,B,e,t,!1))[0],i=s[1],c=n*(Q=Ie(o-e,(i-t)/n)))}return Array.isArray(A.size)&&(Q=Ue(A.size[0],r),c=2===A.size.length?Ue(A.size[1],B):Q),[Q,c]}(e,g,w,c,a),F=C[0],u=C[1],0<F&&0<u&&(U=d.ctx.createRadialGradient(i+g,Q+w,0,i+g,Q+w,F),pe(e.stops,2*F).forEach(function(A){return U.addColorStop(A.stop,ie(A.color))}),d.path(o),d.ctx.fillStyle=U,F!==u?(l=f.bounds.left+.5*f.bounds.width,C=f.bounds.top+.5*f.bounds.height,F=1/(u=u/F),d.ctx.save(),d.ctx.translate(l,C),d.ctx.transform(1,0,0,u,0,0),d.ctx.translate(-l,-C),d.ctx.fillRect(i,F*(Q-C)+C,c,a*F),d.ctx.restore()):d.ctx.fill())),A.label=6;case 6:return h--,[2]}})},d=this,t=0,r=f.styles.backgroundImage.slice(0).reverse(),A.label=1;case 1:return t<r.length?(B=r[t],[5,e(B)]):[3,4];case 2:A.sent(),A.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},Ds.prototype.renderSolidBorder=function(e,t,r){return a(this,void 0,void 0,function(){return H(this,function(A){return this.path(ws(r,t)),this.ctx.fillStyle=ie(e),this.ctx.fill(),[2]})})},Ds.prototype.renderDoubleBorder=function(t,r,B,n){return a(this,void 0,void 0,function(){var e;return H(this,function(A){switch(A.label){case 0:return r<3?[4,this.renderSolidBorder(t,B,n)]:[3,2];case 1:return A.sent(),[2];case 2:return e=function(A,e){switch(e){case 0:return Hs(A.topLeftBorderBox,A.topLeftBorderDoubleOuterBox,A.topRightBorderBox,A.topRightBorderDoubleOuterBox);case 1:return Hs(A.topRightBorderBox,A.topRightBorderDoubleOuterBox,A.bottomRightBorderBox,A.bottomRightBorderDoubleOuterBox);case 2:return Hs(A.bottomRightBorderBox,A.bottomRightBorderDoubleOuterBox,A.bottomLeftBorderBox,A.bottomLeftBorderDoubleOuterBox);default:return Hs(A.bottomLeftBorderBox,A.bottomLeftBorderDoubleOuterBox,A.topLeftBorderBox,A.topLeftBorderDoubleOuterBox)}}(n,B),this.path(e),this.ctx.fillStyle=ie(t),this.ctx.fill(),e=function(A,e){switch(e){case 0:return Hs(A.topLeftBorderDoubleInnerBox,A.topLeftPaddingBox,A.topRightBorderDoubleInnerBox,A.topRightPaddingBox);case 1:return Hs(A.topRightBorderDoubleInnerBox,A.topRightPaddingBox,A.bottomRightBorderDoubleInnerBox,A.bottomRightPaddingBox);case 2:return Hs(A.bottomRightBorderDoubleInnerBox,A.bottomRightPaddingBox,A.bottomLeftBorderDoubleInnerBox,A.bottomLeftPaddingBox);default:return Hs(A.bottomLeftBorderDoubleInnerBox,A.bottomLeftPaddingBox,A.topLeftBorderDoubleInnerBox,A.topLeftPaddingBox)}}(n,B),this.path(e),this.ctx.fill(),[2]}})})},Ds.prototype.renderNodeBackgroundAndBorders=function(c){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q=this;return H(this,function(A){switch(A.label){case 0:return(this.applyEffects(c.getEffects(2)),e=c.container.styles,t=!oe(e.backgroundColor)||e.backgroundImage.length,r=[{style:e.borderTopStyle,color:e.borderTopColor,width:e.borderTopWidth},{style:e.borderRightStyle,color:e.borderRightColor,width:e.borderRightWidth},{style:e.borderBottomStyle,color:e.borderBottomColor,width:e.borderBottomWidth},{style:e.borderLeftStyle,color:e.borderLeftColor,width:e.borderLeftWidth}],B=Ms(Es(e.backgroundClip,0),c.curves),t||e.boxShadow.length)?(this.ctx.save(),this.path(B),this.ctx.clip(),oe(e.backgroundColor)||(this.ctx.fillStyle=ie(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(c.container)]):[3,2];case 1:A.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach(function(A){Q.ctx.save();var t,r,B,n,e=ts(c.curves),s=A.inset?0:1e4,o=(t=-s+(A.inset?1:-1)*A.spread.number,r=(A.inset?1:-1)*A.spread.number,B=A.spread.number*(A.inset?-2:2),n=A.spread.number*(A.inset?-2:2),e.map(function(A,e){switch(e){case 0:return A.add(t,r);case 1:return A.add(t+B,r);case 2:return A.add(t+B,r+n);case 3:return A.add(t,r+n)}return A}));A.inset?(Q.path(e),Q.ctx.clip(),Q.mask(o)):(Q.mask(e),Q.ctx.clip(),Q.path(o)),Q.ctx.shadowOffsetX=A.offsetX.number+s,Q.ctx.shadowOffsetY=A.offsetY.number,Q.ctx.shadowColor=ie(A.color),Q.ctx.shadowBlur=A.blur.number,Q.ctx.fillStyle=A.inset?ie(A.color):"rgba(0,0,0,1)",Q.ctx.fill(),Q.ctx.restore()}),A.label=2;case 2:s=n=0,o=r,A.label=3;case 3:return s<o.length?0!==(i=o[s]).style&&!oe(i.color)&&0<i.width?2!==i.style?[3,5]:[4,this.renderDashedDottedBorder(i.color,i.width,n,c.curves,2)]:[3,11]:[3,13];case 4:return A.sent(),[3,11];case 5:return 3!==i.style?[3,7]:[4,this.renderDashedDottedBorder(i.color,i.width,n,c.curves,3)];case 6:return A.sent(),[3,11];case 7:return 4!==i.style?[3,9]:[4,this.renderDoubleBorder(i.color,i.width,n,c.curves)];case 8:return A.sent(),[3,11];case 9:return[4,this.renderSolidBorder(i.color,n,c.curves)];case 10:A.sent(),A.label=11;case 11:n++,A.label=12;case 12:return s++,[3,3];case 13:return[2]}})})},Ds.prototype.renderDashedDottedBorder=function(g,w,U,l,C){return a(this,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a;return H(this,function(A){return this.ctx.save(),Q=function(A,e){switch(e){case 0:return fs(A.topLeftBorderStroke,A.topRightBorderStroke);case 1:return fs(A.topRightBorderStroke,A.bottomRightBorderStroke);case 2:return fs(A.bottomRightBorderStroke,A.bottomLeftBorderStroke);default:return fs(A.bottomLeftBorderStroke,A.topLeftBorderStroke)}}(l,U),e=ws(l,U),2===C&&(this.path(e),this.ctx.clip()),s=$n(e[0])?(t=e[0].start.x,e[0].start.y):(t=e[0].x,e[0].y),o=$n(e[1])?(r=e[1].end.x,e[1].end.y):(r=e[1].x,e[1].y),B=0===U||2===U?Math.abs(t-r):Math.abs(s-o),this.ctx.beginPath(),3===C?this.formatPath(Q):this.formatPath(e.slice(0,2)),n=w<3?3*w:2*w,s=w<3?2*w:w,3===C&&(s=n=w),o=!0,B<=2*n?o=!1:B<=2*n+s?(n*=i=B/(2*n+s),s*=i):(Q=Math.floor((B+s)/(n+s)),i=(B-Q*n)/(Q-1),s=(Q=(B-(Q+1)*n)/Q)<=0||Math.abs(s-i)<Math.abs(s-Q)?i:Q),o&&(3===C?this.ctx.setLineDash([0,n+s]):this.ctx.setLineDash([n,s])),3===C?(this.ctx.lineCap="round",this.ctx.lineWidth=w):this.ctx.lineWidth=2*w+1.1,this.ctx.strokeStyle=ie(g),this.ctx.stroke(),this.ctx.setLineDash([]),2===C&&($n(e[0])&&(c=e[3],a=e[0],this.ctx.beginPath(),this.formatPath([new Zn(c.end.x,c.end.y),new Zn(a.start.x,a.start.y)]),this.ctx.stroke()),$n(e[1])&&(c=e[1],a=e[2],this.ctx.beginPath(),this.formatPath([new Zn(c.end.x,c.end.y),new Zn(a.start.x,a.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},Ds.prototype.render=function(B){return a(this,void 0,void 0,function(){return H(this,function(A){switch(A.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=ie(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=new as(e=B,null),r=new cs(t),hs(t,r,r,e=[]),ds(t.container,e),[4,this.renderStack(r)];case 1:return A.sent(),this.applyEffects([]),[2,this.canvas]}var e,t,r})})},Ds);function Ds(A,e){A=Ls.call(this,A,e)||this;return A._activeEffects=[],A.canvas=e.canvas||document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),e.canvas||(A.canvas.width=Math.floor(e.width*e.scale),A.canvas.height=Math.floor(e.height*e.scale),A.canvas.style.width=e.width+"px",A.canvas.style.height=e.height+"px"),A.fontMetrics=new Ks(document),A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-e.x,-e.y),A.ctx.textBaseline="bottom",A._activeEffects=[],A.context.logger.debug("Canvas renderer initialized ("+e.width+"x"+e.height+") with scale "+e.scale),A}var vs,xs=function(A){return A instanceof LB||(A instanceof yB||A instanceof pB&&A.type!==dB&&A.type!==hB)},Ms=function(A,e){switch(A){case 0:return ts(e);case 2:return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox];default:return rs(e)}},Ss=function(A){switch(A){case 1:return"center";case 2:return"right";default:return"left"}},Ts=["-apple-system","system-ui"],Gs=function(A){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?A.filter(function(A){return-1===Ts.indexOf(A)}):A},Os=(A(Vs,vs=he),Vs.prototype.render=function(t){return a(this,void 0,void 0,function(){var e;return H(this,function(A){switch(A.label){case 0:return e=Nr(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,ks(e)];case 1:return e=A.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=ie(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(e,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},Vs);function Vs(A,e){A=vs.call(this,A,e)||this;return A.canvas=e.canvas||document.createElement("canvas"),A.ctx=A.canvas.getContext("2d"),A.options=e,A.canvas.width=Math.floor(e.width*e.scale),A.canvas.height=Math.floor(e.height*e.scale),A.canvas.style.width=e.width+"px",A.canvas.style.height=e.height+"px",A.ctx.scale(A.options.scale,A.options.scale),A.ctx.translate(-e.x,-e.y),A.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+e.width+"x"+e.height+" at "+e.x+","+e.y+") with scale "+e.scale),A}var ks=function(r){return new Promise(function(A,e){var t=new Image;t.onload=function(){A(t)},t.onerror=e,t.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(r))})},Rs=(Ns.prototype.debug=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},Ns.prototype.getTime=function(){return Date.now()-this.start},Ns.prototype.info=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,t([this.id,this.getTime()+"ms"],A))},Ns.prototype.warn=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},Ns.prototype.error=function(){for(var A=[],e=0;e<arguments.length;e++)A[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,t([this.id,this.getTime()+"ms"],A)):this.info.apply(this,A))},Ns.instances={},Ns);function Ns(A){var e=A.id,A=A.enabled;this.id=e,this.enabled=A,this.start=Date.now()}var Ps=(Xs.instanceCount=1,Xs);function Xs(A,e){this.windowBounds=e,this.instanceName="#"+Xs.instanceCount++,this.logger=new Rs({id:this.instanceName,enabled:A.logging}),this.cache=null!==(e=A.cache)&&void 0!==e?e:new On(this,A)}"undefined"!=typeof window&&Tn.setContext(window);var Js=function(u,F){return a(void 0,void 0,void 0,function(){var e,t,r,B,n,s,o,i,Q,c,a,g,w,U,l,C;return H(this,function(A){switch(A.label){case 0:if(!u||"object"!=typeof u)return[2,Promise.reject("Invalid element provided as first argument")];if(!(e=u.ownerDocument))throw new Error("Element is not attached to a Document");if(!(t=e.defaultView))throw new Error("Document is not attached to a Window");return w={allowTaint:null!==(U=F.allowTaint)&&void 0!==U&&U,imageTimeout:null!==(c=F.imageTimeout)&&void 0!==c?c:15e3,proxy:F.proxy,useCORS:null!==(a=F.useCORS)&&void 0!==a&&a},U=h({logging:null===(g=F.logging)||void 0===g||g,cache:F.cache},w),c={windowWidth:null!==(c=F.windowWidth)&&void 0!==c?c:t.innerWidth,windowHeight:null!==(a=F.windowHeight)&&void 0!==a?a:t.innerHeight,scrollX:null!==(g=F.scrollX)&&void 0!==g?g:t.pageXOffset,scrollY:null!==(w=F.scrollY)&&void 0!==w?w:t.pageYOffset},a=new d(c.scrollX,c.scrollY,c.windowWidth,c.windowHeight),g=new Ps(U,a),c=null!==(w=F.foreignObjectRendering)&&void 0!==w&&w,w={allowTaint:null!==(U=F.allowTaint)&&void 0!==U&&U,onclone:F.onclone,ignoreElements:F.ignoreElements,inlineImages:c,copyStyles:c},g.logger.debug("Starting document clone with size "+a.width+"x"+a.height+" scrolled to "+-a.left+","+-a.top),U=new dn(g,u,w),(w=U.clonedReferenceElement)?[4,U.toIFrame(e,a)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return(r=A.sent(),l=jB(w)||"HTML"===w.tagName?function(A){var e=A.body,t=A.documentElement;if(!e||!t)throw new Error("Unable to get document size");A=Math.max(Math.max(e.scrollWidth,t.scrollWidth),Math.max(e.offsetWidth,t.offsetWidth),Math.max(e.clientWidth,t.clientWidth)),t=Math.max(Math.max(e.scrollHeight,t.scrollHeight),Math.max(e.offsetHeight,t.offsetHeight),Math.max(e.clientHeight,t.clientHeight));return new d(0,0,A,t)}(w.ownerDocument):f(g,w),B=l.width,n=l.height,s=l.left,o=l.top,i=Ys(g,w,F.backgroundColor),l={canvas:F.canvas,backgroundColor:i,scale:null!==(l=null!==(l=F.scale)&&void 0!==l?l:t.devicePixelRatio)&&void 0!==l?l:1,x:(null!==(l=F.x)&&void 0!==l?l:0)+s,y:(null!==(l=F.y)&&void 0!==l?l:0)+o,width:null!==(l=F.width)&&void 0!==l?l:Math.ceil(B),height:null!==(l=F.height)&&void 0!==l?l:Math.ceil(n)},c)?(g.logger.debug("Document cloned, using foreign object rendering"),[4,new Os(g,l).render(w)]):[3,3];case 2:return Q=A.sent(),[3,5];case 3:return g.logger.debug("Document cloned, element located at "+s+","+o+" with size "+B+"x"+n+" using computed rendering"),g.logger.debug("Starting DOM parsing"),C=kB(g,w),i===C.styles.backgroundColor&&(C.styles.backgroundColor=Le.TRANSPARENT),g.logger.debug("Starting renderer for element at "+l.x+","+l.y+" with size "+l.width+"x"+l.height),[4,new bs(g,l).render(C)];case 4:Q=A.sent(),A.label=5;case 5:return null!==(C=F.removeContainer)&&void 0!==C&&!C||dn.destroy(r)||g.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore"),g.logger.debug("Finished rendering"),[2,Q]}})})},Ys=function(A,e,t){var r=e.ownerDocument,B=r.documentElement?fe(A,getComputedStyle(r.documentElement).backgroundColor):Le.TRANSPARENT,n=r.body?fe(A,getComputedStyle(r.body).backgroundColor):Le.TRANSPARENT,t="string"==typeof t?fe(A,t):null===t?Le.TRANSPARENT:4294967295;return e===r.documentElement?oe(B)?oe(n)?t:n:B:t};return function(A,e){return Js(A,e=void 0===e?{}:e)}});
	
	//import { CanvasDibujo } from "./canvasDibujo.js";
//import * as html2canvas from './html2canvas.min.js'
class Dibujo {
    GridPalette = class {
        colors = [
            "#FF0000", "#FF3300", "#FFFF00", "#00CC00", "#009999", "#0099FF", "#0000FF", "#9900CC", "#FF0099",
            "#000000", "#222222", "#444444", "#666666", "#888888", "#AAAAAA", "#CCCCCC", "#DDDDDD", "#FFFFFF",
            "#660000", "#663300", "#996633", "#003300", "#003333", "#003399", "#000066", "#330066", "#660066",
            "#990000", "#993300", "#CC9900", "#006600", "#336666", "#0033FF", "#000099", "#660099", "#990066",
            "#CC0000", "#CC3300", "#FFCC00", "#009900", "#006666", "#0066FF", "#0000CC", "#663399", "#CC0099",
            "#CC3333", "#FF6600", "#FFFF33", "#00FF00", "#00CCCC", "#00CCFF", "#3366FF", "#9933FF", "#FF00FF",
            "#FF6666", "#FF6633", "#FFFF66", "#66FF66", "#66CCCC", "#00FFFF", "#3399FF", "#9966FF", "#FF66FF",
            "#FF9999", "#FF9966", "#FFFF99", "#99FF99", "#66FFCC", "#99FFFF", "#66CCFF", "#9999FF", "#FF99FF",
            "#FFCCCC", "#FFCC99", "#FFFFCC", "#CCFFCC", "#99FFCC", "#CCFFFF", "#99CCFF", "#CCCCFF", "#FFCCFF"
        ];
        constructor(node, callback){
            this.parent = node
            this.output = callback
            this.colors.forEach(color => {
                this.parent.appendChild(this.newColor(color));
            });
            this.init()
        }
        init = () => {
            this.parent.addEventListener("mousedown", (event) => {
                if (event.target.classList.contains("dibujo-option")) {
                    const selectedColor = event.target.dataset.color;
                    this.output(selectedColor)
                }
            });
    
        }
        newColor = (color) => {
            const div = document.createElement("div");
            div.style.backgroundColor = color;
            div.dataset.color = color; 
            div.classList.add("dibujo-option");
            return div;
        }
    }
    
    ColorsManager = class {
        initialColors = ["#FF0000", "#FF6600", "#FFFF00", "#00CC00", "#0099FF", "#0000FF"
                        , "#9900CC", "#FF0099", "#000000", "#FFFFFF", "#666666", "#AAAAAA"]
    
        currentColors = [...this.initialColors]
    
        constructor(node, callback) {
            this.display = node
            this.output = callback
            this.init()
        }
    
        init() {
            this.initialColors.forEach(color => this.display.appendChild(this.createColor(color)))
            this.display.addEventListener("mousedown", (e) => {
                if (e.target.classList.contains("dibujo-option"))
                    this.output(e.target.dataset.color)
            })
        }
    
        createColor = (color) => {
            const div = document.createElement("div");
            div.style.backgroundColor = color;
            div.dataset.color = color; 
            div.classList.add("dibujo-option");
            return div;
        }
    
        setColor = (newColor) => {
            const index = this.currentColors.indexOf(newColor)
            if (index === -1){      // Si no existe elimina el último y lo introduce al inicio
                this.currentColors.unshift(newColor)
                this.currentColors.pop()
                this.display.prepend(this.createColor(newColor))
                this.display.lastChild.remove()
            }
            else{                   // Si existe, lo coloca al inicio
                this.currentColors.unshift(this.currentColors.splice(index, 1)[0])
                this.display.prepend(this.display.children[index])
            }
        }
    }
    
    changeColor = (color) => {
        this.$currentColor.style.backgroundColor = color
        this.$currentColor.dataset.color = color
        this.lastColors.setColor(color)        
        this.dt.brushColor = color
    }    

    constructor(nodo, datos){
        this.$dibujo = this.crearDOMdibujo()
        this.$dibujo.id = datos.id
        nodo.appendChild(this.$dibujo)
        this.$dibujo.style.zIndex = this.$dibujo.parentNode.children.length
        
        this.$cabecera = this.$dibujo.querySelector(".dibujoCabecera")
        this.$contenido = this.$dibujo.querySelector(".contenido")
        this.$menu = this.$dibujo.querySelector(".menuDesplegable")
        //this.$canvas = this.$dibujo.querySelector(".canvas")
        this.$canvasContenedor = this.$dibujo.querySelector(".canvasContenedor")
        this.$currentColor = this.$cabecera.querySelector(".dibujo-currentColor")
        this.dt = new CanvasDibujo(this.$canvasContenedor, {
            logs: false,
            fullscreen: false,
            brushSize: this.$cabecera.querySelector(".grosor").value,
            bg: datos.bg,
            grid: datos.grid,
            color: "#000000",
            autosave: false,  
            offsetX: this.$canvasContenedor.getBoundingClientRect().left,
            offsetY: this.$canvasContenedor.getBoundingClientRect().top
        })
        // this.$canvasContenedor.style.width = 700
        // this.$canvasContenedor.style.height = 500
        
        this.lastColors = new this.ColorsManager(this.$cabecera.querySelector(".dibujo-lastColors"), this.changeColor)
        this.gridColorSelector = new this.GridPalette(this.$cabecera.querySelector(".dibujo-gridPalette"), this.changeColor)

        this.$cabecera.querySelector(".grosor").value = this.dt.brushSize
        this.$vista = this.$dibujo.querySelector(".vista")
        this.$eliminar = this.$dibujo.querySelector(".eliminar")
        this.$pegarImagen = this.$dibujo.querySelector(".pegarImagen")
        
        //this.medidasContenedor = {"width": this.$dibujo.offsetWidth, "height": this.$dibujo.offsetHeight}
        this.offsetX = 0
        this.offsetY = 0
        this.ptoIni = []
        // this.context = this.$canvas.getContext("2d")
        // this.dibujando = false
        // this.lapizColor = "blue"
        // this.lapizWidth = 2
        // this.trazos = []
        // this.$canvas.style.backgroundColor = "#aaa"
        
        this.moveDibujo = this.moveDibujo.bind(this)
        this.endMoveDibujo = this.endMoveDibujo.bind(this)
        
        
        this.alFrenteDef = () => {
            this.$dibujo.style.zIndex = "9999"
            const els = [...this.$dibujo.parentNode.children].filter(e => !e.classList.contains("menu"))
            els.sort((a, b) => {
                const zIndexA = parseInt(a.style.zIndex) || 0; // Si no hay z-index, asume 0
                const zIndexB = parseInt(b.style.zIndex) || 0;
                return zIndexA - zIndexB;
            });
            for (let i = 0; i < els.length; i++) {
                els[i].style.zIndex = i+1                
            }
        }
        this.alFrente = this.alFrenteDef

        this.mouseLeaveMenu = () => {
            this.$menu.classList.add("oculto")
            this.$menu.removeEventListener("mouseleave", this.mouseLeaveMenu)
            this.$pegarImagen.removeEventListener("click", (e) => {this.dt.pasteImage(e); this.mouseLeaveMenu()})
            this.$eliminar.removeEventListener("click", this.eliminar)
            this.$vista.removeEventListener("click", this.vista)      
            this.$dibujo.style.overflow = "hidden"
        }

        this.bloqueaClickDerecho = (e) => {
            if (e.button === 2){
                e.stopPropagation()
                e.preventDefault()
            }
        }
        this.reaccionTitulo = (e) => {
            this.alFrente()
            if (e.target==this.$cabecera.querySelector(".canvasHerramientas")){
                e.preventDefault();
                // Activa arrastrar sobre el título
                this.offsetX = e.clientX - this.$dibujo.getBoundingClientRect().left + this.$dibujo.parentNode.getBoundingClientRect().left
                this.offsetY = e.clientY - this.$dibujo.getBoundingClientRect().top + this.$dibujo.parentNode.getBoundingClientRect().top                
                this.$dibujo.style.cursor = "move";
                document.addEventListener("mousemove", this.moveDibujo, false);
                document.addEventListener("mouseup", this.endMoveDibujo, false);
            }
            else{
                //const colors = this.$cabecera.querySelector(".color-selector")
                const grosor = this.$cabecera.querySelector(".grosor")
                const colorInput = this.$cabecera.querySelector(".labelColorInput")
                //if (!colors.contains(e.target) && !grosor.contains(e.target) && !colorInput.contains(e.target)){
                if (!grosor.contains(e.target) && !colorInput.contains(e.target)){
                    this.dt.cancelSelection()
                }
            }
        }

        this.mostrarMenu = (e) => {
            e.stopPropagation()
            e.preventDefault()
            if (this.dt.blockRightClick){
                this.dt.blockRightClick = false
                return
            }
            if (this.$menu.classList.contains("activo")){
                this.$menu.style.left = `${e.clientX - this.$dibujo.getBoundingClientRect().left - 10}px`
                this.$menu.style.top = `${e.clientY - this.$dibujo.getBoundingClientRect().top - 10}px`
                this.alFrente()
                this.$menu.classList.remove("oculto")
                this.$dibujo.style.overflow = "visible"
                this.$pegarImagen.addEventListener("click", (e) => {this.dt.pasteImage(e); this.mouseLeaveMenu()})
                this.$eliminar.addEventListener("click", this.eliminar)
                this.$vista.addEventListener("click", this.vista)
                this.$menu.addEventListener("mouseleave", this.mouseLeaveMenu, false)
            }
        }
        this.eliminar = async () => {
            //mostrarMensajeTemporal("No implementado todavía", 2000)
            const id = this.datosInternos.id
            document.body.classList.add("atenuado")
            if (await preguntar("¿Desea eliminar este dibujo?")){
                // Eliminar
                const indice = elementos.findIndex(dibujo => dibujo.datosInternos.id === id)
                if (indice != -1){
                    this.desactivarListeners()
                    elementos.splice(indice, 1)   // Elimina el dibujo del array elementos, donde están todos los elementos activos
                    datosEntornos[datosEntornos.activo].elementos = datosEntornos[datosEntornos.activo].elementos.filter(e => e != id)
                    // FALTA: guardar el apunte eliminado en "papelera", algo como:
                    //      apuntesEliminados.push(this.datosActural())  -> con un array de apuntes eliminados
                    //      Papelera.apuntes.push(this.datosActual())   -> con un objeto Papelera con una propiedad apuntes que es un array donde se guardan los apuntes elimnados
                    this.$dibujo.classList.add("fade-out")
                    this.$dibujo.style.pointerEvents = "none"
                    setTimeout(() =>this.$dibujo.remove(), 1000) // Elimina el apunte del DOM
                }
                else{
                    mostrarMensajeTemporal("Problema interno, no se pudo borrar el dibujo", 1000)
                }
            }
            document.body.classList.remove("atenuado")
        }
        this.pegarImagen = () => {
            mostrarMensajeTemporal("No implementado todavía", 2000)
            // this.$duplicar.removeEventListener("click", this.duplicar)
            // this.$eliminar.removeEventListener("click", this.eliminar)
            // this.$aspecto.removeEventListener("click", this.aspecto)
            // this.$menu.classList.add("oculto")
            // this.$apunte.style.overflow = "hidden"
            // const nuevoApunte = this.datosActual()
            // nuevoApunte.id = Date.now()
            // nuevoApunte.informacion.creacion = nuevoApunte.id
            // nuevoApunte.informacion.modificacion = nuevoApunte.id
            // nuevoApunte.posicion.x = `${(parseInt(nuevoApunte.posicion.x) + 100)}px`
            // nuevoApunte.posicion.y = `${(parseInt(nuevoApunte.posicion.y) + 100)}px`
            // elementos.push(new Apunte(document.getElementById(datosEntornos.activo), nuevoApunte))
            // datosEntornos[datosEntornos.activo].elementos.push(nuevoApunte.id)
        }
        this.vista = () => {
            mostrarMensajeTemporal("No implementado todavía", 2000)
        }
        // Inicializa los valores del "dibujo" con los datos pasados
        this.generarDibujo(datos)
        // Acciones que activan la funcionalidad de "dibujo"
        this.activarListeners()

    }

    desactivarListeners() {
        this.$dibujo.removeEventListener("contextmenu", this.mostrarMenu, false)
        this.$dibujo.removeEventListener("mousedown", this.bloqueaClickDerecho, false)
        this.$cabecera.querySelector(".canvasHerramientas").addEventListener("mousedown", this.reaccionTitulo, false);
        this.$pegarImagen.removeEventListener("click", (e) => {this.dt.pasteImage(e); this.mouseLeaveMenu()})
        this.$eliminar.removeEventListener("click", this.eliminar)
        this.$vista.removeEventListener("click", this.vista)      
        this.$menu.removeEventListener("mouseleave", this.mouseLeaveMenu)
    }    
        
    activarListeners(){
        // Para abrir menu con click derecho sobre el dibujo
        this.$dibujo.addEventListener("contextmenu", this.mostrarMenu, false)
        this.$dibujo.addEventListener("mousedown", this.bloqueaClickDerecho, false)
        // this.$dibujo.addEventListener("mouseup", () =>{
        //     if (this.$dibujo.offsetWidth != this.medidasContenedor.width || this.$dibujo.offsetHeight != this.medidasContenedor.height){
        //         this.dt.resize(this.$dibujo.offsetWidth, this.$dibujo.offsetHeight)
        //         this.medidasContenedor.width = this.$dibujo.offsetWidth - 17
        //         this.medidasContenedor.height = this.$dibujo.offsetHeight
        //     }
        // }, false)
        // Para reactividad del título: edición y arrastre
        this.$canvasContenedor.addEventListener("dragover", (e) => e.preventDefault())
        this.$canvasContenedor.addEventListener("drop", (e) => {e.preventDefault();console.log("detecta el drop");this.dt.dropImage(e)})
        this.$cabecera.querySelector(".canvasHerramientas").addEventListener("mousedown", this.reaccionTitulo, false);

        // opciones dibujo
        this.$cabecera.querySelector(".colorInput").addEventListener("change", e => {
            //this.lapizColor = e.target.value
            e.preventDefault()
            e.stopPropagation()
            this.changeColor(e.target.value)
            this.dt.brushColor = e.target.value 
        })
        this.$cabecera.querySelector(".grosor").addEventListener("change", e => {
            //this.lapizWidth = e.target.value
            this.dt.brushSize = e.target.value
        })
        this.$cabecera.querySelector(".limpiar").addEventListener("click", () => this.dt.clear())
        this.$cabecera.querySelector(".deshacer").addEventListener("click", () => this.dt.undo())
        this.$cabecera.querySelector(".rehacer").addEventListener("click", () => this.dt.redo())
        this.$cabecera.querySelector(".cambiarFondo").addEventListener("click", () => this.dt.lightDark())
        this.$cabecera.querySelector(".cuadricula").addEventListener("click", () => {this.$canvasContenedor.classList.toggle("canvasBackgroundGrid");this.dt.grid = this.$canvasContenedor.classList.contains("canvasBackgroundGrid");})
        this.$cabecera.querySelector(".lupa").addEventListener("click", (e) => {this.marcar(e);this.dt.magnifier(this.changeColor)})
        this.$cabecera.querySelector(".seleccionar").addEventListener("click", (e) => {this.marcar(e);this.dt.selectRect()})
        this.$cabecera.querySelector(".lapiz").addEventListener("click", (e) => {this.marcar(e);this.dt.pencil()})
        this.$cabecera.querySelector(".borrador").addEventListener("click", (e) => {this.marcar(e);this.dt.eraser()})
        this.$cabecera.querySelector(".destacador").addEventListener("click", (e) => {this.marcar(e);this.dt.highlighter()})
        this.$cabecera.querySelector(".linea").addEventListener("click", (e) => {this.marcar(e);this.dt.line()})
        this.$cabecera.querySelector(".rectangulo").addEventListener("click", (e) => {this.marcar(e);this.dt.rectangle()})
        this.$cabecera.querySelector(".elipse").addEventListener("click", (e) => {this.marcar(e);this.dt.ellipse()})
        this.$cabecera.querySelector(".polilinea").addEventListener("click", (e) => {this.marcar(e);this.dt.polyline()})
        this.$cabecera.querySelector(".poligono").addEventListener("click", (e) => {this.marcar(e);this.dt.polygon()})
        //this.$cabecera.querySelector(".color-selector").addEventListener("change", (e) => {if (e.target.name === 'color') {this.changeColor(e.target.value);this.dt.brushColor = e.target.value}})
        this.$cabecera.querySelector(".texto").addEventListener("click", (e) => {this.marcar(e);this.dt.write()})
        this.$cabecera.querySelector(".aumentoH").addEventListener("click", () => this.dt.increaseH(200))
        this.$cabecera.querySelector(".aumentoV").addEventListener("click", () => this.dt.increaseV(200))
        this.$cabecera.querySelector(".dimensiones").addEventListener("click", () => this.cambiarTamaño())
        this.$cabecera.querySelector(".recorte").addEventListener("click", (e) => {this.marcar(e);this.dt.cutter()})
        this.$cabecera.querySelector(".puntero").addEventListener("click", (e) => {this.marcar(e);this.dt.pointer()})
        
    }
    handleDropImage(event){
        event.preventDefault();
        //$dropZone.classList.remove('hover');

        const files = event.dataTransfer.files;
        if (files.length > 0) {
            const file = files[0];
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    img = document.createElement('img');
                    img.src = e.target.result;
                    $preview.querySelector("img")?.remove()
                    $preview.appendChild(img);
                    $preview.addEventListener("click", () => {
                        editor = new ImageEditor($preview)
                    })
                    //cropper = new ImageCropper($preview, img)
                };
                reader.readAsDataURL(file);
            } else {
                alert('Por favor, arrastra solo imágenes.');
            }
        }
    }
    cambiarTamaño(){
        this.alFrente()
        if (this.$dibujo.classList.contains("dimensionNormal")){
            this.datosInternos.posicion.x = this.$dibujo.style.top
            this.datosInternos.posicion.y = this.$dibujo.style.left
            this.$dibujo.style.top = 0
            this.$dibujo.style.left = 0
            this.$dibujo.classList.remove("dimensionNormal")
            this.$dibujo.classList.add("dimensionCompleta")
        }
        else{
            this.$dibujo.style.top = this.datosInternos.posicion.x
            this.$dibujo.style.left = this.datosInternos.posicion.y
            this.$dibujo.classList.remove("dimensionCompleta")
            this.$dibujo.classList.add("dimensionNormal")
        }
    }
    marcar(e){
        this.$cabecera.querySelector(".marcado")?.classList.remove("marcado")
        e.currentTarget.querySelector("svg").classList.add("marcado")
    }

    endMoveDibujo() {
        this.$dibujo.style.cursor = "default";
        document.removeEventListener("mousemove",this.moveDibujo, false);
        document.removeEventListener("mouseup", this.endMoveDibujo, false);
        this.alFrente = this.alFrenteDef // regenera la función alFrente para el proximo arrastre
    }
    moveDibujo(e) {
        this.alFrente()     // recoloca los z-index
        const left = Math.max(e.clientX - this.offsetX, 0);  // Con limitación no salir del área
        const top = Math.max(e.clientY - this.offsetY, 0);
        this.$dibujo.style.left = `${left}px`;
        this.$dibujo.style.top = `${top}px`;
        this.alFrente = () => {}    // vacía la definición para ejecutarla solo al inicio del arrastre
    }

    crearDOMdibujo(){
        const template = document.getElementById("dibujoTemplate")
        const clone = document.importNode(template.content, true)
        const newDibujo = clone.querySelector(".dibujo")
        return newDibujo
    }

    generarDibujo(datos){
        // poner imagen anterior dentro del canvas: canvas.contenido = datos.contenido
        this.$dibujo.style.left = datos.posicion.x
        this.$dibujo.style.top = datos.posicion.y
        this.$dibujo.style.zIndex = datos.posicion.z || "auto" 
        
        this.dt.canvasSize = datos.size
        this.dt.scale = datos.scale
        requestAnimationFrame(() => {
            this.$canvasContenedor.scrollTop = datos.scroll.top
            this.$canvasContenedor.scrollLeft = datos.scroll.left
        })
        this.dt.content = datos.contenido
        this.datosInternos = structuredClone(datos)
    }
    datosActual(){
        this.datosInternos.posicion.x = this.$dibujo.style.left
        this.datosInternos.posicion.y = this.$dibujo.style.top
        this.datosInternos.posicion.z = this.$dibujo.style.zIndex
        this.datosInternos.size = this.dt.canvasSize
        this.datosInternos.scroll.top = this.$canvasContenedor.scrollTop
        this.datosInternos.scroll.left = this.$canvasContenedor.scrollLeft
        this.datosInternos.scale = this.dt.scale
        this.datosInternos.bg = this.dt.bg
        this.datosInternos.grid = this.dt.grid
        this.datosInternos.informacion.modificacion = Date.now()
        this.datosInternos.contenido = this.dt.content
        return structuredClone(this.datosInternos)
    }

}
class Entorno {
    constructor(nodo, id){
        this.datosInternos = datosEntornos[id]
        this.$entorno = this.crearDOMentorno()
        this.$entorno.id = id
        this.$entorno.classList.add("oculto")
        nodo.appendChild(this.$entorno)
        this.$entorno.style.backgroundColor = this.datosInternos.fondo
        this.$menu = this.$entorno.querySelector(".menuDesplegable")
        this.$ventanaMenu = this.$entorno.querySelector(".ventanaMenu")
        this.datosInternos.elementos.forEach((id) => {
            elementos.push(crearElemento(this.$entorno, structuredClone(datosElementos[id])))
        })
        
        this.mouseLeaveMenu = () => {
            this.$menu.classList.add("oculto")
            this.$menu.removeEventListener("mouseleave", this.mouseLeaveMenu)
            this.$menu.querySelector(".nuevo").removeEventListener("click", this.nuevoElemento)
            this.$menu.querySelector(".eliminar").removeEventListener("click", this.preguntarEliminarEntorno)
            this.$menu.querySelector(".personalizar").removeEventListener("click", this.personalizar)  
            this.$menu.querySelector(".apunteNuevo").removeEventListener("click", this.nuevoApunte)
            this.$menu.querySelector(".horarioClasesNuevo").removeEventListener("click", this.nuevoHorarioClases)
            this.$menu.querySelector(".dibujoNuevo").removeEventListener("click", this.nuevoDibujo)
            
            this.$menu.querySelector(".menuEntorno.principal").classList.remove("oculto")
            this.$menu.querySelector(".menuEntorno.secundario").classList.add("oculto")

            this.$entorno.style.overflow = "hidden"
            this.$entorno.querySelector(".ventanaMenu").classList.add("oculto")
        }
        this.bloqueaClickDerecho = (e) => {
            if (e.button === 2){
                e.stopPropagation()
                e.preventDefault()
            }
        }
        this.mostrarMenu = (e) => {
            e.stopPropagation()
            e.preventDefault()
            console.log(this.datosInternos);
            
            if (this.$menu.classList.contains("activo")){
                this.$menu.style.left = `${e.clientX - this.$entorno.getBoundingClientRect().left - 10}px`
                this.$menu.style.top = `${e.clientY - this.$entorno.getBoundingClientRect().top - 10}px`
                this.$menu.classList.remove("oculto")
                this.$entorno.style.overflow = "visible"
                this.$menu.querySelector(".nuevo").focus()
                this.$menu.querySelector(".nuevo").addEventListener("click", this.nuevoElemento)
                this.$menu.querySelector(".eliminar").addEventListener("click", this.preguntarEliminarEntorno)
                this.$menu.querySelector(".personalizar").addEventListener("click", this.personalizar)        
                this.$menu.addEventListener("mouseleave", this.mouseLeaveMenu, false)
            }
        }
        this.nuevoElemento = () => {
            this.$menu.querySelector(".menuEntorno.principal").classList.add("oculto")
            this.$menu.querySelector(".menuEntorno.secundario").classList.remove("oculto")
            this.$menu.querySelector(".apunteNuevo").addEventListener("click", this.nuevoApunte)
            this.$menu.querySelector(".horarioClasesNuevo").addEventListener("click", this.nuevoHorarioClases)
            this.$menu.querySelector(".dibujoNuevo").addEventListener("click", this.nuevoDibujo)
        }
        this.nuevoApunte = (e) => {
            this.mouseLeaveMenu()
            const nuevoApunte = modelos.apunte
            nuevoApunte.id = Date.now()
            nuevoApunte.informacion.creacion = nuevoApunte.id
            nuevoApunte.informacion.modificacion = nuevoApunte.id
            nuevoApunte.posicion.x = `${e.clientX}px`
            nuevoApunte.posicion.y = `${e.clientY}px`
            elementos.push(new Apunte(document.getElementById(datosEntornos.activo), nuevoApunte))
            datosEntornos[datosEntornos.activo].elementos.push(nuevoApunte.id)
        }
        this.nuevoDibujo = (e) => {
            this.mouseLeaveMenu()
            const nuevoDibujo = modelos.dibujo
            nuevoDibujo.id = Date.now()
            nuevoDibujo.informacion.creacion = nuevoDibujo.id
            nuevoDibujo.informacion.modificacion = nuevoDibujo.id
            nuevoDibujo.posicion.x = `${e.clientX}px`
            nuevoDibujo.posicion.y = `${e.clientY}px`
            elementos.push(new Dibujo(document.getElementById(datosEntornos.activo), nuevoDibujo))
            datosEntornos[datosEntornos.activo].elementos.push(nuevoDibujo.id)
        }
        this.nuevoHorarioClases = (e) => {
            this.mouseLeaveMenu()
            const nuevoHorario = modelos.horarioClases
            nuevoHorario.id = Date.now()
            nuevoHorario.informacion.creacion = nuevoHorario.id
            nuevoHorario.informacion.modificacion = nuevoHorario.id
            nuevoHorario.posicion.x = `${e.clientX}px`
            nuevoHorario.posicion.y = `${e.clientY}px`
            //elementos.push(new Horario($entorno, nuevoHorario))
            elementos.push(new Horario(document.getElementById(datosEntornos.activo), nuevoHorario))
            datosEntornos[datosEntornos.activo].elementos.push(nuevoHorario.id)
        }

        this.preguntarEliminarEntorno = async () => {
            document.body.classList.add("atenuado")
                            
            if (await preguntar(`¿Desea eliminar el Entorno "${this.datosInternos.nombre}" y los elementos que contiene?`)){
                this.eliminarEntorno()
                mostrarMensajeTemporal(`El entorno "${this.datosInternos.nombre}" y sus elementos han sido eliminados`, 1000)
            }
            document.body.classList.remove("atenuado")
        }

        this.eliminarEntorno = () => {
            
            // ! !-->    DECICIR QUE HACER CON LOS ELEMENTOS DE UN ENTORNO QUE SE QUIERE ELIMINAR
            
            // Eliminar la instancia y registro en entornos y entornosIDs
            this.datosInternos.elementos.forEach(id => {
                const reducidos = elementos.filter(e => e.datosInternos.id != id)
                elementos.length = 0
                elementos.push(...reducidos)
            })
            delete datosEntornos[this.datosInternos.id]
            const reducidos = entornos.filter(e => e.datosInternos.id != this.datosInternos.id)
            entornos.length=0
            entornos.push(...reducidos)
            const index = entornosIDs.indexOf(this.datosInternos.id.toString());
            if (index > -1) 
                entornosIDs.splice(index, 1);

            cambiarEntorno().remove()
            this.desactivarListeners()
            this.$entorno.remove()
        }

        this.personalizar = (e) => {
            // Menú para elegir nombre, descripción y fondo
            this.$menu.classList.add("oculto")
            this.$menu.removeEventListener("mouseleave", this.mouseLeaveMenu)
            this.$menu.querySelector(".eliminar").removeEventListener("click", this.preguntarEliminarEntorno)
            this.$menu.querySelector(".personalizar").removeEventListener("click", this.personalizar)   
            document.querySelectorAll(".menuDesplegable").forEach(menu => menu.classList.remove("activo"))
     
            this.$ventanaMenu.style.left = `${e.clientX - this.$entorno.getBoundingClientRect().left - 10}px`
            this.$ventanaMenu.style.top = `${e.clientY - this.$entorno.getBoundingClientRect().top - 10}px`
            this.$ventanaMenu.querySelector(".nombre").value = this.datosInternos.nombre
            this.$ventanaMenu.querySelector(".descripcion").value = this.datosInternos.descripcion
            this.$ventanaMenu.querySelector(".fondo").value = this.datosInternos.fondo

            this.$ventanaMenu.classList.remove("oculto")
            this.$ventanaMenu.querySelector(".nombre").addEventListener("input", () => {
                this.datosInternos.nombre = this.$ventanaMenu.querySelector(".nombre").value})
            this.$ventanaMenu.querySelector(".descripcion").addEventListener("input", () => {
                this.datosInternos.descripcion = this.$ventanaMenu.querySelector(".descripcion").value})
            this.$ventanaMenu.querySelector(".fondo").addEventListener("input", () => {
                this.datosInternos.fondo = this.$entorno.style.backgroundColor = this.$ventanaMenu.querySelector(".fondo").value})
            document.addEventListener("mousedown", this.ocultarPersonalizar)

        }
        this.ocultarPersonalizar = (e) => {
            if (!this.$ventanaMenu.contains(e.target)){
                this.$ventanaMenu.classList.add("oculto")
                document.removeEventListener("mousedown", this.ocultarPersonalizar)
                this.$entorno.style.overflow = "hidden"
                document.querySelectorAll(".menuDesplegable").forEach(menu => menu.classList.add("activo"))
                this.$ventanaMenu.querySelector(".nombre").removeEventListener("change", () => {
                    this.datosInternos.nombre = this.$ventanaMenu.querySelector(".nombre").value})
                this.$ventanaMenu.querySelector(".descripcion").removeEventListener("change", () => {
                    this.datosInternos.descripcion = this.$ventanaMenu.querySelector(".descripcion").value})
                this.$ventanaMenu.querySelector(".fondo").removeEventListener("input", () => {
                    this.datosInternos.fondo = this.$entorno.style.backgroundColor = this.$ventanaMenu.querySelector(".fondo").value})    
            }
        }

        this.activarListeners()
    }
    crearDOMentorno (){
        const template = document.getElementById("entornoTemplate")
        const clone = document.importNode(template.content, true)
        return clone.querySelector(".entorno")
    }

    desactivarListeners() {
        this.$entorno.removeEventListener("contextmenu", this.mostrarMenu, false)
        this.$entorno.removeEventListener("mousedown", this.bloqueaClickDerecho, false)
        this.$menu.querySelector(".eliminar").removeEventListener("click", this.preguntarEliminarEntorno)
        this.$menu.querySelector(".personalizar").removeEventListener("click", this.personalizar)        
        this.$menu.removeEventListener("mouseleave", this.mouseLeaveMenu)
    }    

    activarListeners() {
        // Para abrir menu con click derecho sobre el horario
        this.$entorno.addEventListener("contextmenu", this.mostrarMenu, false)
        this.$entorno.addEventListener("mousedown", this.bloqueaClickDerecho, false)
    }
    datosActual(){
        return this.datosInternos
    }
}

class Horario {
    constructor(nodo, datos){
        // Crear el elemento "horario" en el DOM a partir de template
        this.$horario = this.crearDOMhorario()
        this.$horario.id = datos.id
        nodo.appendChild(this.$horario)
        //this.$horario.style.zIndex = this.$horario.parentNode.children.length
        // Definir variables de entorno para acceso a elementos internos del "horario"
        this.$cabecera = this.$horario.querySelector(".horarioCabecera")
        this.$tabla = this.$horario.querySelector(".horarioTabla")
        this.$menu = this.$horario.querySelector(".menuDesplegable")
        // Definir variables de entorno para draggable
        this.offsetX = 0
        this.offsetY = 0
        // Funciones auxiliares para arrastrar
        this.moveHorario = this.moveHorario.bind(this)
        this.endmoveHorario = this.endmoveHorario.bind(this)
        this.alFrenteDef = () => {
            this.$horario.style.zIndex = "9999"
            const els = [...this.$horario.parentNode.children].filter(e => !e.classList.contains("menu"))
            els.sort((a, b) => {
                const zIndexA = parseInt(a.style.zIndex) || 0; // Si no hay z-index, asume 0
                const zIndexB = parseInt(b.style.zIndex) || 0;
                return zIndexA - zIndexB;
            });
            for (let i = 0; i < els.length; i++) {
                els[i].style.zIndex = i+1                
            }
        }
        this.alFrente = this.alFrenteDef

        //  Funciones ligadas a listeners
        //  definidas como anónimas función flecha
        //  para que no pierdan el contexto del 'this'
        //  y poder usar removeEventLintener
        
        this.cambiarColor = () => {
            const $slider = this.$menu.querySelector(".slider")
            this.datosInternos.color = $slider.value
            this.ponerColor()
        }
        this.quitarEdicionTitulo = () => {
            this.$cabecera.contentEditable = "false"
            this.$cabecera.removeEventListener("focusout", this.quitarEdicionTitulo, false)
            this.$cabecera.addEventListener("mousedown", this.reaccionTitulo, false);
        }

        this.mouseLeaveMenu = () => {
            this.$menu.classList.add("oculto")
            this.$menu.removeEventListener("mouseleave", this.mouseLeaveMenu)
            this.$menu.querySelector(".duplicar").removeEventListener("click", this.duplicar)
            this.$menu.querySelector(".eliminar").removeEventListener("click", this.eliminarHorario)
            this.$menu.querySelector(".aspecto").removeEventListener("click", this.aspecto)        
            const $slider = this.$menu.querySelector(".slider")
            $slider.classList.add("oculto")
            this.$horario.style.overflow = "hidden"
            $slider.removeEventListener("input", this.cambiarColor)
        }

        this.bloqueaClickDerecho = (e) => {
            if (e.button === 2){
                e.stopPropagation()
                e.preventDefault()
            }
        }

        this.reaccionTitulo = (e) => {
            e.preventDefault();
            this.alFrente()
            if (e.altKey){
                // Activa edición del título con alt + click
                this.$cabecera.contentEditable = "true"
                this.$cabecera.focus()            
                this.$cabecera.addEventListener("focusout", this.quitarEdicionTitulo, false)
                this.$cabecera.removeEventListener("mousedown", this.reaccionTitulo, false);
            }
            else {
                // Activa arrastrar sobre el título
                this.offsetX = e.clientX - this.$horario.getBoundingClientRect().left + this.$horario.parentNode.getBoundingClientRect().left
                this.offsetY = e.clientY - this.$horario.getBoundingClientRect().top + this.$horario.parentNode.getBoundingClientRect().top                
                this.$horario.style.cursor = "move";
                document.addEventListener("mousemove", this.moveHorario, false);
                document.addEventListener("mouseup", this.endmoveHorario, false);
            }
        }

        this.mostrarMenu = (e) => {
            e.stopPropagation()
            e.preventDefault()
            if (this.$menu.classList.contains("activo")){
                this.alFrente()
                this.$menu.style.left = `${e.clientX - this.$horario.getBoundingClientRect().left - 10}px`
                this.$menu.style.top = `${e.clientY - this.$horario.getBoundingClientRect().top - 10}px`
                this.$menu.classList.remove("oculto")
                this.$horario.style.overflow = "visible"
                this.$menu.querySelector(".duplicar").addEventListener("click", this.duplicar)
                this.$menu.querySelector(".eliminar").addEventListener("click", this.eliminarHorario)
                this.$menu.querySelector(".aspecto").addEventListener("click", this.aspecto)
                this.$menu.addEventListener("mouseleave", this.mouseLeaveMenu, false)
            }
        }

        this.eliminarHorario = async () => {
            const id = this.datosInternos.id
            document.body.classList.add("atenuado")
            if (await preguntar("¿Desea eliminar este horario?")){
                // Eliminar
                const indice = elementos.findIndex(horario => horario.datosInternos.id === id)
                if (indice != -1){
                    this.desactivarListeners()
                    elementos.splice(indice, 1)   // Elimina el apunte del array Apuntes, donde están todos lo apuntes activos
                    datosEntornos[datosEntornos.activo].elementos = datosEntornos[datosEntornos.activo].elementos.filter(e => e != id)
                    // FALTA: guardar el apunte eliminado en "papelera", algo como:
                    //      apuntesEliminados.push(this.datosActural())  -> con un array de apuntes eliminados
                    //      Papelera.apuntes.push(this.datosActual())   -> con un objeto Papelera con una propiedad apuntes que es un array donde se guardan los apuntes elimnados
                    this.$horario.classList.add("fade-out")
                    this.$horario.style.pointerEvents = "none"
                    setTimeout(() =>this.$horario.remove(), 1000) // Elimina el apunte del DOM
                }
                else{
                    mostrarMensajeTemporal("Problema interno, no se pudo borrar el apunte", 1000)
                }
            }
            document.body.classList.remove("atenuado")
        }

        this.duplicar = () => {
            this.$menu.querySelector(".duplicar").removeEventListener("click", this.duplicar)
            this.$menu.querySelector(".eliminar").removeEventListener("click", this.eliminarHorario)
            this.$menu.querySelector(".aspecto").removeEventListener("click", this.aspecto)
            this.$menu.classList.add("oculto")
            this.$horario.style.overflow = "hidden"
            const nuevoHorario = this.datosActual()
            nuevoHorario.id = Date.now()
            nuevoHorario.informacion.creacion = nuevoHorario.id
            nuevoHorario.informacion.modificacion = nuevoHorario.id
            nuevoHorario.posicion.x = `${(parseInt(nuevoHorario.posicion.x) + 100)}px`
            nuevoHorario.posicion.y = `${(parseInt(nuevoHorario.posicion.y) + 100)}px`
            //elementos.push(new Horario($entorno, nuevoHorario))
            elementos.push(new Horario(document.getElementById(datosEntornos.activo), nuevoHorario))
            datosEntornos[datosEntornos.activo].elementos.push(nuevoHorario.id)

        }

        this.aspecto = () => {
            //mostrar slider y hacer input
            const $slider = this.$menu.querySelector(".slider")
            $slider.classList.remove("oculto")
            $slider.addEventListener("input", this.cambiarColor)
        }

        // Inicializa los valores del "horario" con los datos almacenados
        this.generarHorario(datos)
        // Activar los listeners para la funcionalidad del "horario"
        this.activarListeners()
    }

    crearDOMhorario (){
        const template = document.getElementById("horarioTemplate")
        const clone = document.importNode(template.content, true)
        const newHorario = clone.querySelector(".horarioClases")
        return newHorario
    }

    generarHorario(datos){
        this.$cabecera.innerHTML = datos.titulo
        // Recorre las filas y celdas para agregar los datos
        const $body = this.$tabla.querySelector(`tbody`);
        
        for (const fila in datos.contenido) {
            const $fila = $body.children[fila-1]
            const contenido = datos.contenido[fila];
            contenido.forEach((dato, index) => {
                $fila.children[index+1].innerHTML = dato;
            });
            
        }
        // Fija la posición y el tamaño
        this.$horario.style.left = datos.posicion.x
        this.$horario.style.top = datos.posicion.y
        this.$horario.style.zIndex = datos.posicion.z || "auto" 
        this.$horario.style.height = datos.size.height
        this.$horario.style.width = datos.size.width
        // Guarda los datos asignados
        this.datosInternos = structuredClone(datos)
        // Color
        this.$menu.querySelector(".slider").value = this.datosInternos.color
        this.ponerColor()
    }

    ponerColor(){
        const color1 = `hsl(${this.datosInternos.color},52%,73%)`
        const color2 = `hsl(${this.datosInternos.color},78%,91%)`
        this.$horario.style.backgroundColor = color2
        this.$horario.style.border = `1px solid ${color1}`
        this.$tabla.querySelectorAll("th").forEach(th => th.style.backgroundColor = color1)
        this.$tabla.querySelector("th:first-child").style.backgroundColor = color2
        this.$tabla.querySelectorAll("td").forEach(td => td.style.backgroundColor = color2)
        this.$tabla.querySelectorAll("td:first-child").forEach(td => td.style.backgroundColor = color1)
    }

    datosActual(){
        this.datosInternos.titulo = this.$cabecera.innerHTML
        // Recorre las filas y celdas para recuperar los datos actuales
        const $body = this.$tabla.querySelector(`tbody`);
        for (let j = 0; j < 5; j++){
            const $fila = $body.children[j]
            for (let i = 1; i < $fila.children.length; i++) {
                this.datosInternos.contenido[j+1][i-1] = $fila.children[i].innerHTML;
              } 
        }
        // Actualiza la posición y el tamaño
        this.datosInternos.posicion.x = this.$horario.style.left
        this.datosInternos.posicion.y = this.$horario.style.top
        this.datosInternos.posicion.z = this.$horario.style.zIndex
        this.datosInternos.size.width = this.$horario.style.width
        this.datosInternos.size.height = this.$horario.style.height

        return structuredClone(this.datosInternos)
    }

    desactivarListeners() {
        this.$horario.removeEventListener("contextmenu", this.mostrarMenu, false)
        this.$horario.removeEventListener("mousedown", this.bloqueaClickDerecho, false)
        this.$cabecera.removeEventListener("focusout", this.quitarEdicionTitulo, false)
        this.$cabecera.removeEventListener("mousedown", this.reaccionTitulo, false);
        this.$menu.querySelector(".duplicar").removeEventListener("click", this.duplicar)
        this.$menu.querySelector(".eliminar").removeEventListener("click", this.eliminarHorario)
        this.$menu.querySelector(".aspecto").removeEventListener("click", this.aspecto)
        this.$menu.removeEventListener("mouseleave", this.mouseLeaveMenu)
    }    

    activarListeners() {
        // Para abrir menu con click derecho sobre el horario
        this.$horario.addEventListener("contextmenu", this.mostrarMenu, false)
        this.$horario.addEventListener("mousedown", this.bloqueaClickDerecho, false)
        //// Para reactividad del título: edición y arrastre
        this.$cabecera.addEventListener("mousedown", this.reaccionTitulo, false);
    }
    
    endmoveHorario() {
        this.$horario.style.cursor = "default";
        document.removeEventListener("mousemove",this.moveHorario, false);
        document.removeEventListener("mouseup", this.endmoveHorario, false);
        this.alFrente = this.alFrenteDef
    }

    moveHorario(e) {
        this.alFrente()
        const left = Math.max(e.clientX - this.offsetX, 0);  // Con limitación no salir del área
        const top = Math.max(e.clientY - this.offsetY, 0);
        this.$horario.style.left = `${left}px`;
        this.$horario.style.top = `${top}px`;
        this.alFrente = () => {}
    }
}

class Apunte {
    constructor(nodo,datos){
        // Crear el elemento "apunte" en el DOM a partir de template
        this.$apunte = this.createDOMapunte()
        this.$apunte.id = datos.id
        nodo.appendChild(this.$apunte)
        this.$apunte.style.zIndex = this.$apunte.parentNode.children.length
        // Definir variables de entorno para acceso a elementos internos del "apunte"
        this.$cabecera = this.$apunte.querySelector(".apunteCabecera")
        this.$contenido = this.$apunte.querySelector(".contenido")
        this.$menu = this.$apunte.querySelector(".menuDesplegable")
        this.$ventanaMenu = this.$apunte.querySelector(".ventanaMenu")
        this.$aspecto = this.$apunte.querySelector(".aspecto")
        this.$eliminar = this.$apunte.querySelector(".eliminar")
        this.$duplicar = this.$apunte.querySelector(".duplicar")
        // Definir variables de entorno para draggable
        this.offsetX = 0
        this.offsetY = 0
        this.moveApunte = this.moveApunte.bind(this)
        this.endMoveApunte = this.endMoveApunte.bind(this)
        this.alFrenteDef = () => {
            this.$apunte.style.zIndex = "9999"
            const els = [...this.$apunte.parentNode.children].filter(e => !e.classList.contains("menu"))
            els.sort((a, b) => {
                const zIndexA = parseInt(a.style.zIndex) || 0; // Si no hay z-index, asume 0
                const zIndexB = parseInt(b.style.zIndex) || 0;
                return zIndexA - zIndexB;
            });
            for (let i = 0; i < els.length; i++) {
                els[i].style.zIndex = i+1                
            }
        }
        this.alFrente = this.alFrenteDef

        //  Funciones ligadas a listeners
        //  definidas como anónimas función flecha
        //  para que no pierdan el contexto del 'this'
        //  y poder usar removeEventLintener
        
        this.quitarEdicionTitulo = () => {
            this.$cabecera.contentEditable = "false"
            this.$cabecera.removeEventListener("focusout", this.quitarEdicionTitulo, false)
            this.$cabecera.addEventListener("mousedown", this.reaccionTitulo, false);
        }

        this.mouseLeaveMenu = () => {
            this.$menu.classList.add("oculto")
            this.$menu.removeEventListener("mouseleave", this.mouseLeaveMenu)
            this.$duplicar.removeEventListener("click", this.duplicar)
            this.$eliminar.removeEventListener("click", this.eliminar)
            this.$aspecto.removeEventListener("click", this.aspecto)      
            if (this.$ventanaMenu.classList.contains("oculto"))  
                this.$apunte.style.overflow = "hidden"
        }

        this.bloqueaClickDerecho = (e) => {
            if (e.button === 2){
                e.stopPropagation()
                e.preventDefault()
            }
        }

        this.reaccionTitulo = (e) => {
            e.preventDefault();
            this.alFrente()
            if (e.altKey){
                // Activa edición del título con alt + click
                this.$cabecera.contentEditable = "true"
                this.$cabecera.focus()            
                this.$cabecera.addEventListener("focusout", this.quitarEdicionTitulo, false)
                this.$cabecera.removeEventListener("mousedown", this.reaccionTitulo, false);
            }
            else {
                // Activa arrastrar sobre el título
                this.offsetX = e.clientX - this.$apunte.getBoundingClientRect().left + this.$apunte.parentNode.getBoundingClientRect().left
                this.offsetY = e.clientY - this.$apunte.getBoundingClientRect().top + this.$apunte.parentNode.getBoundingClientRect().top                
                this.$apunte.style.cursor = "move";
                document.addEventListener("mousemove", this.moveApunte, false);
                document.addEventListener("mouseup", this.endMoveApunte, false);
            }
        }
        
        this.mostrarMenu = (e) => {
            e.stopPropagation()
            e.preventDefault()
            if (this.$menu.classList.contains("activo")){
                this.$menu.style.left = `${e.clientX - this.$apunte.getBoundingClientRect().left - 10}px`
                this.$menu.style.top = `${e.clientY - this.$apunte.getBoundingClientRect().top - 10}px`
                this.alFrente()
                this.$menu.classList.remove("oculto")
                this.$apunte.style.overflow = "visible"
                this.$duplicar.addEventListener("click", this.duplicar)
                this.$eliminar.addEventListener("click", this.eliminar)
                this.$aspecto.addEventListener("click", this.aspecto)
                this.$menu.addEventListener("mouseleave", this.mouseLeaveMenu, false)
            }
        }
        
        this.eliminar = async () => {
            const id = this.datosInternos.id
            document.body.classList.add("atenuado")
            if (await preguntar("¿Desea eliminar este apunte?")){
                // Eliminar
                const indice = elementos.findIndex(apunte => apunte.datosInternos.id === id)
                if (indice != -1){
                    this.desactivarListeners()
                    elementos.splice(indice, 1)   // Elimina el apunte del array Apuntes, donde están todos lo apuntes activos
                    datosEntornos[datosEntornos.activo].elementos = datosEntornos[datosEntornos.activo].elementos.filter(e => e != id)
                    // FALTA: guardar el apunte eliminado en "papelera", algo como:
                    //      apuntesEliminados.push(this.datosActural())  -> con un array de apuntes eliminados
                    //      Papelera.apuntes.push(this.datosActual())   -> con un objeto Papelera con una propiedad apuntes que es un array donde se guardan los apuntes elimnados
                    this.$apunte.classList.add("fade-out")
                    this.$apunte.style.pointerEvents = "none"
                    setTimeout(() =>this.$apunte.remove(), 1000) // Elimina el apunte del DOM
                }
                else{
                    mostrarMensajeTemporal("Problema interno, no se pudo borrar el apunte", 1000)
                }
            }
            document.body.classList.remove("atenuado")
        }
        
        this.duplicar = () => {
            this.$duplicar.removeEventListener("click", this.duplicar)
            this.$eliminar.removeEventListener("click", this.eliminar)
            this.$aspecto.removeEventListener("click", this.aspecto)
            this.$menu.classList.add("oculto")
            this.$apunte.style.overflow = "hidden"
            const nuevoApunte = this.datosActual()
            nuevoApunte.id = Date.now()
            nuevoApunte.informacion.creacion = nuevoApunte.id
            nuevoApunte.informacion.modificacion = nuevoApunte.id
            nuevoApunte.posicion.x = `${(parseInt(nuevoApunte.posicion.x) + 100)}px`
            nuevoApunte.posicion.y = `${(parseInt(nuevoApunte.posicion.y) + 100)}px`
            elementos.push(new Apunte(document.getElementById(datosEntornos.activo), nuevoApunte))
            datosEntornos[datosEntornos.activo].elementos.push(nuevoApunte.id)
        }

        this.ocultarAspecto = (e) => {
            if (!this.$ventanaMenu.contains(e.target) && !this.$aspecto.contains(e.target)){
                this.$ventanaMenu.classList.add("oculto")
                document.removeEventListener("mousedown", this.ocultarAspecto)
                this.$apunte.style.overflow = "hidden"
                document.querySelectorAll(".menuDesplegable").forEach(menu => menu.classList.add("activo"))

            }
        }
        this.aspecto = (e) => {  
            e.stopPropagation()
            this.$duplicar.removeEventListener("click", this.duplicar)
            this.$eliminar.removeEventListener("click", this.eliminar)
            this.$aspecto.removeEventListener("click", this.aspecto)
            this.$menu.classList.add("oculto")
            document.querySelectorAll(".menuDesplegable").forEach(menu => menu.classList.remove("activo"))
            this.$ventanaMenu.classList.remove("oculto")
            this.$apunte.style.overflow = "visible"
            document.addEventListener("mousedown", this.ocultarAspecto)

            // Muestra el menú -----------> llevar a función activarMenu/desactivarMenu (para cargar y eliminar los eventlistener)
    
            const sizeContenido = this.$ventanaMenu.querySelector(".sizeContenido")
            sizeContenido.focus()
            sizeContenido.addEventListener("input", () => {
                this.$contenido.style.fontSize = this.datosInternos.aspecto.contenido.size = `${sizeContenido.value}px`
            })
        
            const fuenteContenido = this.$ventanaMenu.querySelector(".fuenteContenido");
            fuenteContenido.addEventListener('change', (event) => { 
                this.$contenido.style.fontFamily = this.datosInternos.aspecto.contenido.fuente = event.target.value
            });
            
            const fondoContenido = this.$ventanaMenu.querySelector(".colorFondoContenido")
            fondoContenido.addEventListener("input", () => {
                if (this.datosInternos.aspecto.titulo.vista == "integrado"){
                    this.$cabecera.style.backgroundColor = fondoContenido.value
                }
                this.$contenido.style.backgroundColor = this.datosInternos.aspecto.contenido.fondo = fondoContenido.value
            })
    
            const colorContenido = this.$ventanaMenu.querySelector(".colorTextoContenido")
            colorContenido.addEventListener("input", () => {
                if (this.datosInternos.aspecto.titulo.vista == "integrado"){
                    this.$cabecera.style.color = colorContenido.value
                }
                this.$contenido.style.color = this.datosInternos.aspecto.contenido.color = colorContenido.value
            })
            
            const sizeTitulo = this.$ventanaMenu.querySelector(".sizeTitulo")
            sizeTitulo.addEventListener("input", () => {
                this.$cabecera.style.fontSize = this.datosInternos.aspecto.titulo.size = `${sizeTitulo.value}px`
            })
            
            const fuenteTitulo = this.$ventanaMenu.querySelector(".fuenteTitulo");
            fuenteTitulo.addEventListener('change', (event) => {
                this.$cabecera.style.fontFamily = this.datosInternos.aspecto.titulo.fuente = event.target.value
            });        
            
            const fondoTitulo = this.$ventanaMenu.querySelector(".colorFondoTitulo")
            fondoTitulo.addEventListener("input", () => {
                this.$cabecera.style.backgroundColor = this.datosInternos.aspecto.titulo.fondo = fondoTitulo.value
            })
    
            const colorTitulo = this.$ventanaMenu.querySelector(".colorTextoTitulo")
            colorTitulo.addEventListener("input", () => {
                this.$cabecera.style.color = this.datosInternos.aspecto.titulo.color = colorTitulo.value
            })

            this.$ventanaMenu.querySelector(".vistaTitulo").addEventListener("change", (e) => {
                this.$cabecera.innerHTML = this.datosInternos.titulo
                this.datosInternos.aspecto.titulo.vista = e.target.value
                this.$ventanaMenu.querySelector(".colorFondoTitulo").disabled = true
                this.$ventanaMenu.querySelector(".colorTextoTitulo").disabled = true
                this.$cabecera.style.backgroundColor = this.datosInternos.aspecto.contenido.fondo
                this.$cabecera.style.color = this.datosInternos.aspecto.contenido.color
                if (e.target.value == "oculto"){
                    this.$cabecera.innerHTML = ""
                }
                else if (e.target.value == "destacado"){
                    this.$cabecera.style.backgroundColor = this.datosInternos.aspecto.titulo.fondo
                    this.$cabecera.style.color = this.datosInternos.aspecto.titulo.color
                    this.$ventanaMenu.querySelector(".colorFondoTitulo").disabled = false
                    this.$ventanaMenu.querySelector(".colorTextoTitulo").disabled = false
                }
            })
        }    

        // Inicializa los valores del "apunte" con los datos pasados
        this.generarApunte(datos)
        // Acciones que activan la funcionalidad de "apunte"
        this.activarListeners()
    }

    desactivarListeners() {
        this.$apunte.removeEventListener("contextmenu", this.mostrarMenu, false)
        this.$apunte.removeEventListener("mousedown", this.bloqueaClickDerecho, false)
        this.$cabecera.removeEventListener("focusout", this.quitarEdicionTitulo, false)
        this.$cabecera.removeEventListener("mousedown", this.reaccionTitulo, false);
        this.$duplicar.removeEventListener("click", this.duplicar)
        this.$eliminar.removeEventListener("click", this.eliminar)
        this.$aspecto.removeEventListener("click", this.aspecto)
        this.$menu.removeEventListener("mouseleave", this.mouseLeaveMenu)
    }    
        
    activarListeners(){
        // Para abrir menu con click derecho sobre el apunte
        this.$apunte.addEventListener("contextmenu", this.mostrarMenu, false)
        this.$apunte.addEventListener("mousedown", this.bloqueaClickDerecho, false)
        //// Para reactividad del título: edición y arrastre
        this.$cabecera.addEventListener("mousedown", this.reaccionTitulo, false);

        document.querySelectorAll(".tab").forEach((tab) =>{
            tab.addEventListener("click", (e) => {
                const tabs = e.target.parentNode.querySelectorAll(".tab")
                tabs.forEach((tab)=>{
                    tab.classList.remove("activo")
                })
                e.target.classList.add("activo")
            })
        })
    }

    endMoveApunte() {
        this.$apunte.style.cursor = "default";
        document.removeEventListener("mousemove",this.moveApunte, false);
        document.removeEventListener("mouseup", this.endMoveApunte, false);
        this.alFrente = this.alFrenteDef // regenera la función alFrente para el proximo arrastre
    }
    moveApunte(e) {
        this.alFrente()     // recoloca los z-index
        const left = Math.max(e.clientX - this.offsetX, 0);  // Con limitación no salir del área
        const top = Math.max(e.clientY - this.offsetY, 0);
        this.$apunte.style.left = `${left}px`;
        this.$apunte.style.top = `${top}px`;
        this.alFrente = () => {}    // vacía la definición para ejecutarla solo al inicio del arrastre
    }

    createDOMapunte(){
        const template = document.getElementById("apunteTemplate")
        const clone = document.importNode(template.content, true)
        const newApunte = clone.querySelector(".apunte")
        return newApunte
    }

    generarApunte(dato){
        this.$cabecera.innerHTML = dato.titulo
        this.$ventanaMenu.querySelector(".colorFondoTitulo").disabled = true
        this.$ventanaMenu.querySelector(".colorTextoTitulo").disabled = true
        this.$cabecera.style.backgroundColor = dato.aspecto.contenido.fondo
        this.$cabecera.style.color = dato.aspecto.contenido.color
        if (dato.aspecto.titulo.vista == "oculto"){
            this.$cabecera.innerHTML = ""
        }
        else if (dato.aspecto.titulo.vista == "destacado"){
            this.$cabecera.style.backgroundColor = dato.aspecto.titulo.fondo
            this.$cabecera.style.color = dato.aspecto.titulo.color
            this.$ventanaMenu.querySelector(".colorFondoTitulo").disabled = false
            this.$ventanaMenu.querySelector(".colorTextoTitulo").disabled = false
        }

        this.$cabecera.style.fontSize = dato.aspecto.titulo.size
        this.$cabecera.style.fontFamily = dato.aspecto.titulo.fuente

        this.$contenido.value = dato.contenido
        this.$contenido.style.backgroundColor = dato.aspecto.contenido.fondo
        this.$contenido.style.color = dato.aspecto.contenido.color
        this.$contenido.style.fontSize = dato.aspecto.contenido.size
        this.$contenido.style.fontFamily = dato.aspecto.contenido.fuente
        this.$contenido.style.height = dato.size.height
        this.$contenido.style.width = dato.size.width

        this.$apunte.style.left = dato.posicion.x
        this.$apunte.style.top = dato.posicion.y
        this.$apunte.style.zIndex = dato.posicion.z || "auto" 
        this.$apunte.style.backgroundColor = dato.aspecto.contenido.fondo

        this.$ventanaMenu.querySelector(".colorFondoContenido").defaultValue = dato.aspecto.contenido.fondo
        this.$ventanaMenu.querySelector(".colorTextoContenido").defaultValue = dato.aspecto.contenido.color
        this.$ventanaMenu.querySelector(".sizeContenido").defaultValue = parseInt(dato.aspecto.contenido.size)
        this.$ventanaMenu.querySelector(".fuenteContenido").value = dato.aspecto.contenido.fuente
        this.$ventanaMenu.querySelector(".colorFondoTitulo").defaultValue = dato.aspecto.titulo.fondo
        this.$ventanaMenu.querySelector(".colorTextoTitulo").defaultValue = dato.aspecto.titulo.color
        this.$ventanaMenu.querySelector(".sizeTitulo").defaultValue = parseInt(dato.aspecto.titulo.size)
        this.$ventanaMenu.querySelector(".fuenteTitulo").value = dato.aspecto.titulo.fuente
        
        this.$ventanaMenu.querySelector(".vistaTitulo").value = dato.aspecto.titulo.vista

        this.datosInternos = structuredClone(dato)
    }    

    datosActual(){
        //let rgb2hex= c=> '#'+c.match(/\d+/g).map(x=>(+x).toString(16).padStart(2,0)).join``;

        this.datosInternos.titulo = this.$cabecera.innerHTML
        this.datosInternos.contenido = this.$contenido.value
        
        this.datosInternos.size.height = this.$contenido.style.height
        this.datosInternos.size.width = this.$contenido.style.width
        this.datosInternos.posicion.x = this.$apunte.style.left
        this.datosInternos.posicion.y = this.$apunte.style.top
        this.datosInternos.posicion.z = this.$apunte.style.zIndex

        this.datosInternos.informacion.modificacion = Date.now()

        return structuredClone(this.datosInternos)
    }
}

/* -----------

	Clase CanvasDibujo - Elemento dibujo

 -------------- */

class CanvasDibujo {
  #canvas = document.createElement("canvas");
  #editor = document.createElement("div")
  #ctx = this.#canvas.getContext("2d");
  #canvasAux = document.createElement("canvas");
  #ctxAux = this.#canvasAux.getContext("2d");

  #CONSTANTS = {
    DATA_KEY: "paths",
  };

  #isDrawing = false
  #isGrabbing = false
  #isResizing = false
  #isCutting = false
  #isPolylining = false
  #isWriting = false
  #textEditing = -1
  #rectSelection = {empty: true}
  #paths = []
  #images = []
  #rzTimeout
  #redo = []
  #undo = []
  #wait = false
  #scale = 1
  #blockRightClick = false
  #isControlPressed = false
  #isShiftPressed = false
  #magnifier = {
    x: 0,
    y: 0,
    magnification: 3,
    magnifierSize: 100,
    radius: 100 / 2,
    angle: Math.PI * 2,
    ratio: 100 / 3,
    color: ""
  }
  #cutter

  bgColors = [
    "#000000",
    "#111111",
    "#222222",
    "#333333",
    "#444444",
    "#bbbbbb",
    "#cccccc",
    "#dddddd",
    "#eeeeee",
    "#ffffff",
  ]

  options = {
    width: 400,
    height: 400,
    size: undefined,
    bg: "#888888",
    grid: false,
    color: "#ff0000",
    brushSize: 2,
    highlighterSize: 60,
    logs: false,
    fullSize: false,
    fullWidth: false,
    fullHeight: false,
    fullscreen: false,
    lineCap: "round",
    lineJoin: "round",
    overflow: "hidden",
    scale: 1,
    autosave: false,
    offsetX: 0,
    offsetY: 0
  };

  brushType = type.pencil;
  toolType = tool.stroke

  constructor(nodo, opts) {
    this.options = { ...this.options, ...opts };
    this.container = nodo
    this.#initializeOptions();
    this.#initializeCanvas();
    //this.drawFromSaved();
    this.#canvas.width = 2000
    this.#canvas.height = 1500 
    this.#canvas.addEventListener("mousedown", this.#handleStart);
    this.#canvas.addEventListener("touchstart", this.#handleStart);
    document.addEventListener("paste", this.#handlePasteImage)

    this.#canvas.addEventListener("keydown", this.#handleKeydown);
    this.#canvas.addEventListener("keyup", this.#handleKeyup);

    window.addEventListener("resize", this.#handleResize);
    //Para quitar la selección si clic fuera
    // document.addEventListener("mousedown", this.#cancelSelection)
    // document.addEventListener("touchstart", this.#cancelSelection)
  }

  #handlePasteImage = (e) => {
    if (this.#textEditing>-1)
      return

    const items = e.clipboardData.items;
    for (let i = 0; i < items.length; i++) {
        if (items[i].type.indexOf('image') !== -1) {
            const blob = items[i].getAsFile();
            const img = new Image();
            img.onload = () => {
              const imgWidth = img.width;
              const imgHeight = img.height;
              const frameWidth = Math.min(500, img.width);
              const frameHeight = Math.min(300, img.height);

              // Calcular las proporciones para redimensionar la imagen
              const scale = Math.min(frameWidth / imgWidth, frameHeight / imgHeight);
              const x = (frameWidth / 2) - (imgWidth / 2) * scale;
              const y = (frameHeight / 2) - (imgHeight / 2) * scale;

              // Crear un canvas temporal del tamaño de la imagen
              const tempCanvas = document.createElement('canvas');
              tempCanvas.width = imgWidth * scale;
              tempCanvas.height = imgHeight * scale;
              const tempCtx = tempCanvas.getContext('2d');
              tempCtx.drawImage(img, 0, 0, imgWidth * scale, imgHeight * scale);
              // Obtener la imagen comprimida del canvas temporal
              const compressedImage = tempCanvas.toDataURL('image/jpeg', 0.7); // 0.7 es la calidad de compresión (0 a 1)
              // Dibujar la imagen comprimida en el canvas original
              const compressedImg = new Image();
              compressedImg.onload = () => {
                  this.#paths.push({
                    state: state.active,
                    tool: tool.frame,
                    type: type.image,
                    data: compressedImg,
                    width: tempCanvas.width,
                    height: tempCanvas.height,
                    proportion: tempCanvas.width/tempCanvas.height,
                    start: [50, 50],
                    topLeft: [50, 50],
                    bottomRight: [50 + tempCanvas.width, 50 + tempCanvas.height],
                    resize: [0,0]
                  })
                  this.#draw()
              };
              compressedImg.src = compressedImage;
          };
          const URLObj = window.URL || window.webkitURL;
          img.src = URLObj.createObjectURL(blob);
      }
    }
    console.log(this.#paths);

  }

  #handleKeyup = (e) => {
    if (e.key === "Control")
      this.#isControlPressed = false
    else if (e.key === "Shift")
      this.#isShiftPressed = false
  }

  #handleKeydown = (e) => {
    // console.log(e.code);
    // console.log(e.key);
    if (e.key === "Control")
      this.#isControlPressed = true
    else if (e.key === "Shift")
      this.#isShiftPressed = true
    if (e.ctrlKey && e.code === "KeyZ") {
      this.undo();
    }
    else if (e.ctrlKey && e.code === "KeyY") {
      this.redo();
    }
    else if (e.code === "Delete") {
      if (!this.#rectSelection.empty){
        e.preventDefault()
        this.#undo.push({action: action.delete, paths: this.#rectSelection.paths})
        this.cancelSelection(state.deleted)
      }
    }
    else if (e.code === "Escape") {
      e.preventDefault()
      if (this.#isGrabbing){
        this.#isGrabbing = false
        this.#rectSelection.offset = [0, 0]
        this.#draw()
        this.#canvas.addEventListener("touchstart", this.#handleStart);
        this.#canvas.addEventListener("mousedown", this.#handleStart);
        this.#canvas.removeEventListener("touchmove", this.#selectRectMove);
        this.#canvas.removeEventListener("mousemove", this.#selectRectMove);
        document.removeEventListener("touchend", this.#selectRectEnd);
        document.removeEventListener("mouseup", this.#selectRectEnd);      
      }
      else if (this.#isDrawing){
        const path = this.#paths[this.#paths.length-1]
        if (path.type === type.polyline || path.type === type.polygon){
            this.#finishPoly(path)
            this.#blockRightClick = false
        }
        else{
          this.#isDrawing = false;
          this.#paths.pop()
          this.#draw()
          this.#canvas.addEventListener("touchstart", this.#handleStart);
          this.#canvas.addEventListener("mousedown", this.#handleStart);
          this.#canvas.removeEventListener("touchmove", this.#shapeMove);
          this.#canvas.removeEventListener("mousemove", this.#shapeMove);
          document.removeEventListener("touchend", this.#shapeEnd);
          document.removeEventListener("mouseup", this.#shapeEnd);  
        }  
      }
    }
    else if (e.key === "F2"){
      if (!this.#rectSelection.empty && this.#rectSelection.paths.length == 1 && this.#rectSelection.paths[0].type == type.image){
        this.#imageEdition(this.#rectSelection.paths[0])
      }

    }
    else if (e.key === "+"){
      this.zoom(1.1)
    }
    else if (e.key === "-"){
      this.zoom(0.9)
    }
    else if (e.key === "*"){
      this.zoom(1)
    }
    else if (e.ctrlKey && e.code === "KeyD") {
      e.preventDefault();
      if (this.#cutter.isActive && this.#cutter.width>10)
        this.#downdoaldCut()
    }

    else if (this.#isDrawing) {
      e.preventDefault()
      const path = this.#paths[this.#paths.length-1]
      if (path.type === type.polyline || path.type === type.polygon){
          this.#finishPoly(path)
          this.#blockRightClick = false
        }
    }
    /*
    if (e.ctrlKey && e.code === "KeyS") {
      e.preventDefault();
      this.save();
    }

    if (e.ctrlKey && e.code === "KeyE") {
      e.preventDefault();
      this.download();
    }*/
  }

  #getBrush() {
    let size
    if (this.brushType == type.highlighter)
      size = this.options.highlighterSize
    else
      size = this.options.brushSize
    return {
      color: this.options.color,
      bg: this.options.bg,
      brushSize: size,
      lineCap: this.options.lineCap,
      lineJoin: this.options.lineJoin,
    };
  }

  #handleStart = (e) => {
    if (this.#cutter.isActive)
      return
    e.stopPropagation()
    e.preventDefault();
    this.#canvas.focus()
    const offset = this.container.getBoundingClientRect()
    this.options.offsetX = offset.x
    this.options.offsetY = offset.y
    
    if (this.toolType == tool.text){
      this.#textStart(e)
    }
    else if (this.toolType == tool.selectRect){
      this.#selectRectStart(e)
    }
    else if (this.toolType == tool.shape){
      this.#shapeStart(e)
    }
    else if (this.toolType == tool.eraser){
      this.#eraserStart(e)
    }
    else if (this.toolType == tool.magnifier){
      this.#magnifierStart(e)
    }
    else if (this.toolType == tool.cutter){
      this.#cutterStart(e)
    }
    else{
      this.#strokeStart(e)
    }
  }

  #cutterStart = (e) => {
    if (this.#cutter.isActive){
      this.#cutter.deactivate()
      this.#doCut()
    }
    else{
      this.#cutter.activate()
    }
  }

  #canvasCut(){
    let { width, height, x, y } = this.#cutter;
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = this.#canvas.width;
    canvas.height = this.#canvas.height;
    ctx.fillStyle = "#ffffff"
    ctx.fillRect(0, 0, canvas.width, canvas.height)

    this.#paths.forEach(path => this.#drawPath(path, ctx))

    const cut = ctx.getImageData(x, y, width, height)
    canvas.width = width
    canvas.height = height
    ctx.putImageData(cut, 0, 0)
    return canvas
  }

  #downdoaldCut(){  // Descarga el recorte
    this.#canvasCut().toBlob((blob) => {
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'recorte.png'; // Nombre del archivo de descarga
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 'image/png');
  }

  #doCut(){   // Pone el recorte en la portapapeles
      this.#canvasCut().toBlob((blob) => {
      const item = new ClipboardItem({"image/png": blob})
      navigator.clipboard.write([item])
    }, 'image/png');
  }

  #magnifierStart = (e) => {
    const imageData = this.#ctx.getImageData(e.offsetX, e.offsetY, 1, 1);
    this.#magnifier.color = imageData.data
    this.#canvas.removeEventListener("touchstart", this.#handleStart);
    this.#canvas.removeEventListener("mousedown", this.#handleStart);  
    this.#canvas.addEventListener("touchmove", this.#magnifierMove);
    this.#canvas.addEventListener("mousemove", this.#magnifierMove);
    document.addEventListener("touchend", this.#magnifierEnd);
    document.addEventListener("mouseup", this.#magnifierEnd);
  }

  #magnifierMove = (e) => {
    const circle = (offset, width, color) => {
      this.#ctx.beginPath();
      this.#ctx.arc(this.#magnifier.x, this.#magnifier.y, this.#magnifier.radius + offset, 0, this.#magnifier.angle);
      this.#ctx.lineWidth = width;
      this.#ctx.strokeStyle = color;
      this.#ctx.stroke();  
    }
    this.#magnifier.x = e.offsetX;
    this.#magnifier.y = e.offsetY;

    this.#draw()
    this.#ctx.save();
    this.#ctx.beginPath();
    this.#ctx.arc(this.#magnifier.x, this.#magnifier.y, this.#magnifier.radius, 0, this.#magnifier.angle);
    this.#ctx.clip();
    this.#ctx.drawImage(this.#canvas, this.#magnifier.x - this.#magnifier.ratio / 2, this.#magnifier.y - this.#magnifier.ratio / 2, this.#magnifier.ratio, this.#magnifier.ratio, this.#magnifier.x - this.#magnifier.radius, this.#magnifier.y - this.#magnifier.radius, this.#magnifier.magnifierSize, this.#magnifier.magnifierSize);
    this.#ctx.restore();

    const imageData = this.#ctx.getImageData(this.#magnifier.x, this.#magnifier.y, 1, 1);
    this.#magnifier.color = imageData.data
    
    const [r, g, b, a] = imageData.data;
    const currentColor= `rgba(${r},${g},${b},${a / 255})`;

    circle(0, 2, "white")
    circle(7, 14, currentColor)
    circle(14, 2, "black")
  }

  #magnifierEnd = () => {
    const rgbaToHex = (data) => {
      const [r, g, b, a] = data.map((value, index) => index === 3 ? value / 255 : value);
      return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}${Math.round(a * 255).toString(16).padStart(2, '0')}`;
    }
    this.#draw()
    const newColor = rgbaToHex(this.#magnifier.color)
    if (this.#magnifier.tellColor !== null)
      this.#magnifier.tellColor(newColor)
    this.brushColor = newColor
    this.#canvas.addEventListener("touchstart", this.#handleStart);
    this.#canvas.addEventListener("mousedown", this.#handleStart);  
    this.#canvas.removeEventListener("touchmove", this.#magnifierMove);
    this.#canvas.removeEventListener("mousemove", this.#magnifierMove);
    document.removeEventListener("touchend", this.#magnifierEnd);
    document.removeEventListener("mouseup", this.#magnifierEnd);

  }

  #eraserStart = (e) => {
    const coords = this.#coordinates(e)
    this.cancelSelection(state.active)
    this.#isDrawing = false
    this.#isGrabbing = false
  }

  #endWriting = async () => {
    this.#editor.querySelector(".txt-can-options").classList.remove("txt-can-visible")
    this.#editor.querySelector(".txt-can-editor").contentEditable = "false"
    this.#isWriting = false
    const html = this.#editor.querySelector(".txt-can-editor").innerHTML
    if (html){
      //volcar al canvas
      const canvas = await html2canvas(this.#editor.querySelector(".txt-can-editor"), {backgroundColor: null, scale: 2})
      const txt = this.#paths[this.#textEditing] 
      if (!txt.innerHTML)
        this.#undo.push({action: action.draw, path: txt})
      txt.img = canvas
      txt.state = state.active
      txt.topLeft = [...txt.start]
      txt.bottomRight = [txt.topLeft[0] + txt.img.width/2, txt.topLeft[1] + txt.img.height/2]
      txt.innerHTML = this.#editor.querySelector(".txt-can-editor").innerHTML
      this.#draw(txt)
    }
    else{
      this.#paths.splice(this.#textEditing, 1)
    }
    this.#editor.classList.remove("txt-can-visible")
    this.#textEditing = -1
  }

  #startWriting = () => {
    const txt = this.#paths[this.#textEditing]
    const offsetTop = this.container.parentNode.offsetHeight - this.container.offsetHeight + 1
    txt.state = state.deleted
    this.#draw()
    this.#editor.style.left = (txt.topLeft[0]) + "px"
    this.#editor.style.top = (txt.topLeft[1]+offsetTop) + "px"
    this.#editor.classList.add("txt-can-visible")
    this.#editor.querySelector(".txt-can-editor").innerHTML = txt.innerHTML
    this.#editor.querySelector(".txt-can-editor").contentEditable = "true"
    this.#editor.querySelector(".txt-can-editor").focus()
    this.#editor.querySelector(".txt-can-options").classList.add("txt-can-visible")
    this.#isWriting = true
  }

  #textStart = async (e) => {
    const coords = this.#coordinates(e)
    if (this.#textEditing > -1){
      if (!this.#editor.contains(e.target)){
        await this.#endWriting()
      }
    }
    this.#textEditing = -1
    for (let i = 0; i < this.#paths.length; i++) {
      const path = this.#paths[i]
      if ((path.type == type.text) && this.#isInside(...coords, ...path.topLeft, ...path.bottomRight)){
        this.#textEditing = i
      }
    }
    if (this.#textEditing > -1){
      this.#startWriting()
    }
    else{
      const offsetTop = this.container.parentNode.offsetHeight - this.container.offsetHeight + 1
      let x = coords[0] - 5, y = coords[1] - offsetTop + 10
      this.#paths.push({
        action: action.draw,
        tool: tool.text,
        type: type.text,
        img: "",
        innerHTML: "",
        start: [x, y],
        topLeft: [x - this.#canvas.parentNode.scrollLeft, y - this.#canvas.parentNode.scrollTop],
        bottomRight: []
      })
      this.#textEditing = this.#paths.length - 1
      this.#startWriting()
    }
  }

  #selectRectStart = (e) => {
    const coords = this.#coordinates(e)
    // this.containerDimension = this.#canvas.parentNode.getBoundingClientRect()
    this.#isDrawing = false
    this.#isGrabbing = false
    this.#isResizing = false
    if (!this.#rectSelection.empty){
      // this.#canvasAux.width = this.options.width
      // this.#canvasAux.height = this.options.height
      // this.#ctxAux.clearRect(0, 0, this.#canvasAux.width, this.#canvasAux.height)
      // this.#drawSelected(false, this.#ctxAux)
      // if (this.#ctxAux.isPointInPath(...coords)){
      //   this.#isGrabbing = true
      // }
      if (this.#isInside(...coords, ...this.#rectSelection.topLeft, ...this.#rectSelection.bottomRight, 6)){
        this.#isGrabbing = true
      }
      else if (
        this.#rectSelection.resizable && 
        coords[0]>this.#rectSelection.bottomRight[0] + this.#rectSelection.offset[0] + this.#rectSelection.resize[0] + 5 &&
        coords[0]<this.#rectSelection.bottomRight[0] + this.#rectSelection.offset[0] + this.#rectSelection.resize[0] + 5 + 10 &&
        coords[1]>this.#rectSelection.bottomRight[1] + this.#rectSelection.offset[1] + this.#rectSelection.resize[1] + 5 &&
        coords[1]<this.#rectSelection.bottomRight[1] + this.#rectSelection.offset[1] + this.#rectSelection.resize[1] + 5 + 10
        ){
          this.#isResizing = true
        }
      else{
        this.cancelSelection(state.active)
      }
      if (!this.#rectSelection.empty){
        this.#canvas.removeEventListener("touchstart", this.#handleStart);
        this.#canvas.removeEventListener("mousedown", this.#handleStart);  
        this.#canvas.addEventListener("touchmove", this.#selectRectMove);
        this.#canvas.addEventListener("mousemove", this.#selectRectMove);
        document.addEventListener("touchend", this.#selectRectEnd);
        document.addEventListener("mouseup", this.#selectRectEnd);
        this.#rectSelection.position = [...coords]
        return
      }
    }    
    this.#rectSelection = {
      paths: [],
      empty: true,
      start: [...coords],
      end: false,
      position: [...coords],
      topLeft: [Infinity, Infinity],
      bottomRight: [0, 0],
      offset: [0, 0],
      resize: [0, 0],
      resizable: false,
    }
    this.#canvas.removeEventListener("touchstart", this.#handleStart);
    this.#canvas.removeEventListener("mousedown", this.#handleStart);
    this.#canvas.addEventListener("touchmove", this.#selectRectMove);
    this.#canvas.addEventListener("mousemove", this.#selectRectMove);
    document.addEventListener("touchend", this.#selectRectEnd);
    document.addEventListener("mouseup", this.#selectRectEnd);
  }

  #selectRectMove = (e) => {

    if (this.#isGrabbing){
      if (!this.#rectSelection.empty && !this.#wait){
        e.preventDefault()
        const newCoordinates = this.#coordinates(e)
        this.#rectSelection.offset[0] = newCoordinates[0] - this.#rectSelection.position[0]
        this.#rectSelection.offset[1] = newCoordinates[1] - this.#rectSelection.position[1]
        // if (this.#rectSelection.bottomRight[0]+this.#rectSelection.offset[0]+50 > this.#containerDim.x + this.#canvas.parentNode.scrollLeft){
        //   this.#canvas.parentNode.scrollBy({left: 50})
        // } 
        // else if (this.#rectSelection.topLeft[0]+this.#rectSelection.offset[0]-50 < this.#canvas.parentNode.scrollLeft){
        //   this.#canvas.parentNode.scrollBy({left: -50})
        // }
        // if (this.#rectSelection.bottomRight[1]+this.#rectSelection.offset[1]+50 > this.#containerDim.y + this.#canvas.parentNode.scrollTop){
        //   this.#canvas.parentNode.scrollBy({top: 50})
        // } 
        // else if (this.#rectSelection.topLeft[1]+this.#rectSelection.offset[1]-50 < this.#canvas.parentNode.scrollTop){
        //   this.#canvas.parentNode.scrollBy({top: -50})
        // }
        this.#draw()
        this.#wait = true
        setTimeout(()=>this.#wait=false, 50)
      }
    }
    else if (this.#isResizing){
      if (!this.#rectSelection.empty && !this.#wait){
        e.preventDefault()
        const newCoordinates = this.#coordinates(e)
        if ((this.#rectSelection.bottomRight[0] - this.#rectSelection.topLeft[0] + newCoordinates[0] - this.#rectSelection.position[0]) > 3 && (this.#rectSelection.bottomRight[1] - this.#rectSelection.topLeft[1] + newCoordinates[1] - this.#rectSelection.position[1]) > 3){
          this.#rectSelection.resize[0] = newCoordinates[0] - this.#rectSelection.position[0]
          this.#rectSelection.resize[1] = newCoordinates[1] - this.#rectSelection.position[1]
        }
        this.#draw()
        this.#wait = true
        setTimeout(()=>this.#wait=false, 50)
      }
    }
    else{
      //this.#rectSelection.end = this.#coordinates(e)
      this.#rectSelection.end = this.#coordinates(e)
      if (!this.#wait){
        requestAnimationFrame(() => {this.#draw();this.#drawRectSelection()})
        //this.#draw()
        //this.#drawRectSelection()
        this.#wait = true
        setTimeout(()=>this.#wait=false, 50)
      }
    }
  }
  
  #selectRectEnd = (e) => {
    const coords = this.#coordinates(e)

    if (this.#isResizing){
      this.#setResizeSelection()
    }
    else if (this.#isGrabbing){
      this.#setMoveSelection()
    }
    else{
      if (!this.#rectSelection.end){
        // --- Tipo grab
        this.clearOnlyScreen();
        let grabbed = -1
        for (let i = 0; i < this.#paths.length; i++) {
          const path = this.#paths[i]
          if (path.state == state.active){
            if ((path.type == type.image || path.type == type.text) && this.#isInside(...coords, ...path.topLeft, ...path.bottomRight)){
              grabbed = i
            }
            else{
              this.#draw(path)
              if (this.#ctx.isPointInStroke(...coords)){
                grabbed = i
              }
            }   
          }
        }
        if(grabbed>-1){
          this.#paths[grabbed].state = state.selected
          this.#rectSelection.topLeft = [...this.#paths[grabbed].topLeft]
          this.#rectSelection.bottomRight = [...this.#paths[grabbed].bottomRight]
          this.#rectSelection.paths.push(this.#paths[grabbed])
          this.#rectSelection.empty = false
          this.#draw()
        }
      }
      else{
        // --- Tipo area
        // Calcular qué trazos están dentro
        if (this.#rectSelection.start[0]>this.#rectSelection.end[0])
          [this.#rectSelection.start[0], this.#rectSelection.end[0]] = [this.#rectSelection.end[0], this.#rectSelection.start[0]]
        if (this.#rectSelection.start[1]>this.#rectSelection.end[1])
          [this.#rectSelection.start[1], this.#rectSelection.end[1]] = [this.#rectSelection.end[1], this.#rectSelection.start[1]]
        this.#paths.forEach( (path, index) => {
          if (
            path.state == state.active &&
            path.topLeft[0]>this.#rectSelection.start[0] &&
            path.topLeft[0]<this.#rectSelection.end[0] &&
            path.topLeft[1]>this.#rectSelection.start[1] &&
            path.topLeft[1]<this.#rectSelection.end[1] &&
            path.bottomRight[0]>this.#rectSelection.start[0] &&
            path.bottomRight[0]<this.#rectSelection.end[0] &&
            path.bottomRight[1]>this.#rectSelection.start[1] &&
            path.bottomRight[1]<this.#rectSelection.end[1] 
            ) {
              path.state = state.selected
              this.#rectSelection.paths.push(path)
              this.#rectSelection.topLeft[0] = Math.min(path.topLeft[0],this.#rectSelection.topLeft[0])
              this.#rectSelection.topLeft[1] = Math.min(path.topLeft[1],this.#rectSelection.topLeft[1])
              this.#rectSelection.bottomRight[0] = Math.max(path.bottomRight[0],this.#rectSelection.bottomRight[0])
              this.#rectSelection.bottomRight[1] = Math.max(path.bottomRight[1],this.#rectSelection.bottomRight[1])    
          }
        })
      }
      if (this.#rectSelection.paths.length>0){
        this.#rectSelection.empty = false
        if (this.#rectSelection.paths.length == 1 && (this.#rectSelection.paths[0].type == type.image || this.#rectSelection.paths[0].type == type.line || this.#rectSelection.paths[0].type == type.rectangle || this.#rectSelection.paths[0].type == type.ellipse))
          this.#rectSelection.resizable = true
      }
      else{
        this.#rectSelection.empty = true
        //this.#rectSelection.resizable = false
      }
      
      this.#draw()
    }
    this.#canvas.addEventListener("touchstart", this.#handleStart);
    this.#canvas.addEventListener("mousedown", this.#handleStart);
    this.#canvas.removeEventListener("touchmove", this.#selectRectMove);
    this.#canvas.removeEventListener("mousemove", this.#selectRectMove);
    document.removeEventListener("touchend", this.#selectRectEnd);
    document.removeEventListener("mouseup", this.#selectRectEnd);
  }
  
  #finishPoly = (path) =>{
    if (path.points.length > 0){
      //path.end = path.points[path.points.length-1]
      path.points.pop()
      path.topLeft = [...path.start]
      path.bottomRight = [...path.start]
      path.points.forEach(point => {
        path.topLeft[0] = Math.min(path.topLeft[0],point[0]+path.start[0])
        path.topLeft[1] = Math.min(path.topLeft[1],point[1]+path.start[1])
        path.bottomRight[0] = Math.max(path.bottomRight[0],point[0]+path.start[0])
        path.bottomRight[1] = Math.max(path.bottomRight[1],point[1]+path.start[1])
      })
      this.#undo.push({action: action.draw, path: this.#paths[this.#paths.length-1]})
    }
    else
      this.#paths.pop()
    this.#draw()
    this.#isDrawing = false
    this.#canvas.removeEventListener("touchmove", this.#shapeMove);
    this.#canvas.removeEventListener("mousemove", this.#shapeMove);
    document.removeEventListener("touchend", this.#shapeEnd);
    document.removeEventListener("mouseup", this.#shapeEnd);  
  }

  #shapeStart = (e) => {
    const coords = this.#coordinates(e)
    this.#blockRightClick = true
    if (this.#isDrawing) {
      const path = this.#paths[this.#paths.length-1]
      if (path.type === type.polyline || path.type === type.polygon){
        if (e.button == 2){
          e.stopPropagation()
          e.preventDefault()
          this.#finishPoly(path)
        }
        else if (path.points.length && coords[0]-path.start[0] === path.points[path.points.length-2][0] && coords[1]-path.start[1] === path.points[path.points.length-2][1]){
          this.#finishPoly(path)
        }
        return          
      }
    }
    this.#isDrawing = true
    this.#paths.push({
      start: [...coords],
      end: [],
      brush: this.#getBrush(),
      tool: this.toolType,
      type: this.brushType,
      topLeft: [],
      points: [[0, 0]],
      bottomRight: [],
      offset: [0, 0],
      state: state.active
    })    
    this.#canvas.removeEventListener("touchstart", this.#handleStart);
    this.#canvas.removeEventListener("mousedown", this.#handleStart);
    this.#canvas.addEventListener("touchmove", this.#shapeMove);
    this.#canvas.addEventListener("mousemove", this.#shapeMove);
    document.addEventListener("touchend", this.#shapeEnd);
    document.addEventListener("mouseup", this.#shapeEnd);
  }

  #shapeMove = (e) => {
    e.preventDefault()
    const coords = this.#coordinates(e)
    if (this.#isDrawing) {
      const path = this.#paths[this.#paths.length-1]
      path.end = coords
      if (path.type === type.polyline || path.type === type.polygon)
        path.points[path.points.length-1] = [coords[0] - path.start[0], coords[1] - path.start[1]]
      else if (this.#isControlPressed){
        const dx = path.end[0] - path.start[0]
        const dy = path.end[1] - path.start[1]
        if (path.type === type.line){
          if (Math.abs(dx) > Math.abs(dy))
            path.end[1] = path.start[1]
          else
            path.end[0] = path.start[0]
        }
        else if (path.type === type.rectangle || path.type === type.ellipse){
          const side = Math.min(dx, dy)
          path.end[0] = path.start[0] + side
          path.end[1] = path.start[1] + side
        }
      }
      this.#draw()
    }
  }

  #shapeEnd = () => {
    if (this.#isDrawing) {
      const path = this.#paths[this.#paths.length-1]
      if (path.type === type.polyline || path.type === type.polygon){
        path.points.push([path.end[0] - path.start[0], path.end[1] - path.start[1]])
      }
      else{
        this.#isDrawing = false;
        
        if (path.end.length == 0){
          this.#paths.pop()
        }
        else{
          if (path.type == type.ellipse){
            const vector = [path.end[0]-path.start[0], path.end[1]-path.start[1]]
            const vertex = [path.start[0]-vector[0], path.start[1]-vector[1]]
            path.topLeft[0] = Math.min(vertex[0],path.end[0])
            path.topLeft[1] = Math.min(vertex[1],path.end[1])
            path.bottomRight[0] = Math.max(vertex[0],path.end[0])
            path.bottomRight[1] = Math.max(vertex[1],path.end[1])  
          }
          else{
            path.topLeft[0] = Math.min(path.start[0],path.end[0])
            path.topLeft[1] = Math.min(path.start[1],path.end[1])
            path.bottomRight[0] = Math.max(path.start[0],path.end[0])
            path.bottomRight[1] = Math.max(path.start[1],path.end[1])  
          }
          this.#undo.push({action: action.draw, path: this.#paths[this.#paths.length-1]})
        }  
        this.#canvas.removeEventListener("touchmove", this.#shapeMove);
        this.#canvas.removeEventListener("mousemove", this.#shapeMove);
        document.removeEventListener("touchend", this.#shapeEnd);
        document.removeEventListener("mouseup", this.#shapeEnd);
      }
        /*
      if (this.options.autosave) {
        this.save();
        this.#log("Auto Saved");
      }*/
    }
    this.#canvas.addEventListener("touchstart", this.#handleStart);
    this.#canvas.addEventListener("mousedown", this.#handleStart);
  }

  #strokeStart = (e) => {
    if (e.which == 1 || e.which == 0 || e.touches) {
      this.#isDrawing = true;
      const coords = this.#coordinates(e)
      this.#paths.push({
        start: [...coords],
        points:[],
        brush: this.#getBrush(),
        tool: this.toolType,
        type: this.brushType,
        topLeft: [...coords],
        bottomRight: [...coords],
        offset: [0, 0],
        state: state.active
      })     
      this.#draw();
      this.#canvas.removeEventListener("touchstart", this.#handleStart);
      this.#canvas.removeEventListener("mousedown", this.#handleStart);
      this.#canvas.addEventListener("touchmove", this.#strokeMove);
      this.#canvas.addEventListener("mousemove", this.#strokeMove);
      document.addEventListener("touchend", this.#strokeEnd);
      document.addEventListener("mouseup", this.#strokeEnd);
    }     
  }

  #strokeMove = (e) => {
    e.preventDefault();
    if (this.#isDrawing) {
      const coords = this.#coordinates(e)
      const path = this.#paths[this.#paths.length-1]
      path.points.push([coords[0]-path.start[0], coords[1]-path.start[1]]);
      path.topLeft[0] = Math.min(path.topLeft[0],coords[0])
      path.topLeft[1] = Math.min(path.topLeft[1],coords[1])
      path.bottomRight[0] = Math.max(path.bottomRight[0],coords[0])
      path.bottomRight[1] = Math.max(path.bottomRight[1],coords[1])
      this.#draw()
      // this.#draw(path);
    }
  };

  #strokeEnd = () => {
    if (this.#isDrawing) {
      /*if (this.options.autosave) {
        this.save();
        this.#log("Auto Saved");
      }*/
      if (this.brushType === type.pointer){      
        setTimeout( ( index ) => {
          for (let i = 0; i < this.#paths.length; i++) {
            const path = this.#paths[i];
            if (path.type == type.pointer){
              this.#paths.splice(i, 1)
              break
            }            
          }
          this.#draw()
        }, 1200)
      }
      else{
        this.#undo.push({action: action.draw, path: this.#paths[this.#paths.length-1]})
      }
      this.#canvas.addEventListener("touchstart", this.#handleStart);
      this.#canvas.addEventListener("mousedown", this.#handleStart);
      this.#canvas.removeEventListener("touchmove", this.#strokeMove);
      this.#canvas.removeEventListener("mousemove", this.#strokeMove);
      document.removeEventListener("touchend", this.#strokeEnd);
      document.removeEventListener("mouseup", this.#strokeEnd);
    }
    this.#isDrawing = false;
  };

  #handleResize = () => {
    if (this.#rzTimeout) {
      window.clearTimeout(this.#rzTimeout);
      this.#rzTimeout = null;
    }
    this.#rzTimeout = setTimeout(() => {
      const { width: elWidth, height: elHeight } =
        this.container.getBoundingClientRect();
      if (this.options.fullscreen) {
        this.options.width = window.innerWidth;
        this.options.height = window.innerHeight;
      } else if (this.options.fullSize) {
        this.options.width = elWidth;
        this.options.height = elHeight;
      } else if (this.options.fullWidth) {
        this.options.width = elWidth;
      } else if (this.options.fullHeight) {
        this.options.height = elHeight;
      }
      this.#initializeCanvasSize();
      this.#draw();
    }, 200);
  };

  #initializeOptions() {
    if (this.options.size) {
      this.options.width = this.options.size;
      this.options.height = this.options.size;
    }
    if (this.options.fullscreen) {
      this.options.width = window.innerWidth;
      this.options.height = window.innerHeight;
    }
    const { width: elWidth, height: elHeight } =
      this.container.getBoundingClientRect();
    if (this.options.fullSize) {
      this.options.width = elWidth;
      this.options.height = elHeight;
    }
    if (this.options.fullWidth) {
      this.options.width = elWidth;
    }
    if (this.options.fullHeight) {
      this.options.height = elHeight;
    }
  }

  #initializeCanvas() {
    this.#initializeCanvasSize();
    this.container.style.backgroundColor = this.options.bg;
    let gridColor
    if (parseInt(this.options.bg.slice(1), 16) < parseInt("666666", 16))
      gridColor = "#ffffff80"
    else
      gridColor = "#0000ff80"
    document.documentElement.style.setProperty('--grid-canvas-color', gridColor)
      //this.#canvas.style.background = this.options.bg;
    this.#canvas.tabIndex = "0"
    this.#canvas.focus()
    this.container.appendChild(this.#canvas);
    this.#editor.classList.add("txt-can-editor-container")
    this.#editor.innerHTML = textEditorHtml
    this.container.appendChild(this.#editor)
    this.#cutter = new this.CanvasCutter(this.container)
    if (this.options.grid)
      this.container.classList.add("canvasBackgroundGrid")
  }

  #initializeCanvasSize() {
    // this.#canvas.width = this.options.width;
    // this.#canvas.height = this.options.height;
  }

  #coordinates(e) {
    if (e.touches && e.touches.length > 0) {
      return [
        (e.touches[0].clientX - this.options.offsetX + this.#canvas.parentNode.scrollLeft)/this.#scale,
        (e.touches[0].clientY - this.options.offsetY + this.#canvas.parentNode.scrollTop)/this.#scale,
      ];
    }
    return [
      (e.clientX - this.options.offsetX + this.#canvas.parentNode.scrollLeft)/this.#scale,
      (e.clientY - this.options.offsetY + this.#canvas.parentNode.scrollTop)/this.#scale,
    ];
  }

  #draw(path) {
    if (path){
        this.#drawPath(path);
    }
    else{
      this.clearOnlyScreen();
      this.#paths.forEach(path => this.#drawPath(path))
      if (!this.#rectSelection.empty)
          this.#drawSelected(this.#ctx)
    }  
  }

  #drawRectSelection(){
    this.#ctx.save()
    this.#ctx.scale(this.#scale, this.#scale)
    this.#ctx.lineCap = "round";
    this.#ctx.lineJoin = "round";
    this.#ctx.setLineDash([5, 8])
    //this.#ctx.filter = `drop-shadow(0 0 4px #fff)`
    this.#ctx.lineWidth = 3;
    this.#ctx.strokeStyle = "#ffffff77";
    this.#ctx.beginPath();
    this.#ctx.rect(
      this.#rectSelection.start[0] + this.#rectSelection.offset[0],
      this.#rectSelection.start[1] + this.#rectSelection.offset[1],
      this.#rectSelection.end[0] - this.#rectSelection.start[0], 
      this.#rectSelection.end[1] - this.#rectSelection.start[1])
    this.#ctx.stroke();
    this.#ctx.closePath();
    this.#ctx.lineWidth = 1;
    this.#ctx.strokeStyle = "#000000";
    this.#ctx.beginPath();
    this.#ctx.rect(
      this.#rectSelection.start[0] + this.#rectSelection.offset[0],
      this.#rectSelection.start[1] + this.#rectSelection.offset[1],
      this.#rectSelection.end[0] - this.#rectSelection.start[0], 
      this.#rectSelection.end[1] - this.#rectSelection.start[1])
    this.#ctx.stroke();
    this.#ctx.closePath();
    this.#ctx.setLineDash([])
    this.#ctx.filter = "none"
    this.#ctx.restore()
  }

  #drawSelected(context){
    const offset = 6
    this.#ctx.save()
    this.#ctx.scale(this.#scale, this.#scale)
    //const offset = parseInt(path.brush.brushSize) + 2
    context.lineCap = "round";
    context.lineJoin = "round";
    if (this.#rectSelection.resizable){
      context.fillStyle = "#ffffff77"
      context.fillRect(this.#rectSelection.bottomRight[0] + this.#rectSelection.offset[0] + this.#rectSelection.resize[0] + offset, this.#rectSelection.bottomRight[1] + this.#rectSelection.offset[1] + this.#rectSelection.resize[1] + offset, 10, 10)
      context.fillStyle = "none"
    }
    //context.filter = `drop-shadow(0 0 4px #fff)`
    context.setLineDash([5, 8])
    context.beginPath();
    context.lineWidth = 3;
    context.strokeStyle = "#ffffff77";
    context.rect(
      this.#rectSelection.topLeft[0] + this.#rectSelection.offset[0] - offset,
      this.#rectSelection.topLeft[1] + this.#rectSelection.offset[1] - offset,
      this.#rectSelection.bottomRight[0] + this.#rectSelection.resize[0] - this.#rectSelection.topLeft[0] + offset*2,
      this.#rectSelection.bottomRight[1] + this.#rectSelection.resize[1] - this.#rectSelection.topLeft[1] + offset*2)
    context.stroke();
    context.closePath();
    context.beginPath();
    context.lineWidth = 1;
    context.strokeStyle = "#000000";
    context.rect(
      this.#rectSelection.topLeft[0] + this.#rectSelection.offset[0] - offset,
      this.#rectSelection.topLeft[1] + this.#rectSelection.offset[1] - offset,
      this.#rectSelection.bottomRight[0] + this.#rectSelection.resize[0] - this.#rectSelection.topLeft[0] + offset*2,
      this.#rectSelection.bottomRight[1] + this.#rectSelection.resize[1] - this.#rectSelection.topLeft[1] + offset*2)
    context.stroke();
    context.closePath();
    context.setLineDash([])
    context.filter = "none"
    this.#ctx.restore()
  }

  #drawPath(path, ctx) {  
    if (path.state == state.deleted)
      return
    if (!ctx)
      ctx = this.#ctx
    ctx.save()
    ctx.scale(this.#scale, this.#scale)
    let offsetX = 0, offsetY = 0, resizeX = 0, resizeY = 0
    if (path.state == state.selected){
      //ctx.filter = `drop-shadow(0 0 4px #fff)`    Viable solo para un trazo
      offsetX = this.#rectSelection.offset[0]
      offsetY = this.#rectSelection.offset[1]
      resizeX = this.#rectSelection.resize[0]
      resizeY = this.#rectSelection.resize[1]
    }
    if (path.type == type.image){  
      if (resizeX/resizeY > path.proportion){
        resizeX = resizeY * path.proportion
      }
      else{
        resizeY = Math.round(resizeX / path.proportion)
      } 
      ctx.drawImage(path.data, path.start[0] + offsetX, path.start[1] + offsetY, path.width + resizeX, path.height + resizeY)
      ctx.filter = "none"
      ctx.restore()
      return
    }
    else if (path.type == type.text){
      // const divAux = this.#editor.querySelector(".txt-can-divAux")
      // divAux.innerHTML = path.innerHTML
      // html2canvas(divAux, {backgroundColor: null, scale: 2}).then(canvas => {
      //   ctx.imageSmoothingEnabled = true
      //   ctx.drawImage(canvas, path.topLeft[0] + offsetX, path.topLeft[1] + offsetY, canvas.width/2, canvas.height/2)
      // });

      //ctx.putImageData(path.img, path.topLeft[0] + offsetX, path.topLeft[1] + offsetY)
      ctx.drawImage(path.img, path.topLeft[0] + offsetX, path.topLeft[1] + offsetY, path.img.width/2, path.img.height/2)
      ctx.filter = "none"
      ctx.restore()
      return
    }
    else{
      ctx.lineWidth = path.brush.brushSize;
      ctx.strokeStyle = path.brush.color;
      ctx.lineCap = path.brush.lineCap;
      ctx.lineJoin = path.brush.lineJoin;
      ctx.beginPath();
      if (path.type == type.pencil || path.type == type.highlighter){
        // if (this.#isDrawing && path.length > 1){
        //   const prevPoint = path.points[path.points.length-2]
        //   const lastPoint = path.points[path.points.length-1]
        //   ctx.moveTo(...prevPoint)
        //   ctx.lineTo(...lastPoint)
        // }
        // else{
          ctx.moveTo(path.start[0] + offsetX, path.start[1] + offsetY);
          path.points.forEach(point => ctx.lineTo(point[0]+path.start[0]+offsetX, point[1]+path.start[1]+offsetY));
        // }
      }
      else if (path.type == type.pointer){
        ctx.lineWidth = 4
        ctx.strokeStyle = "#ff0000aa"
        ctx.shadowColor = "#ffff00"
        ctx.shadowBlur = 10
        ctx.beginPath();
        ctx.moveTo(path.start[0] + offsetX, path.start[1] + offsetY);
        path.points.forEach(point => ctx.lineTo(point[0]+path.start[0]+offsetX, point[1]+path.start[1]+offsetY));
      }
      else if (path.type == type.line){
        ctx.moveTo(path.start[0] + offsetX, path.start[1] + offsetY);
        ctx.lineTo(path.end[0] + resizeX + offsetX, path.end[1] + resizeY + offsetY)
      }
      else if (path.type == type.rectangle){       
        ctx.rect(path.start[0] + offsetX, path.start[1] + offsetY, path.end[0] + resizeX - path.start[0], path.end[1] + resizeY - path.start[1])
      }
      else if (path.type == type.ellipse){       
        ctx.ellipse(path.start[0] + offsetX + resizeX/2, path.start[1] + offsetY + resizeY/2,
          Math.abs(path.end[0] + resizeX/2 - path.start[0]), Math.abs(path.end[1]+ resizeY/2  - path.start[1]), 0, 0, 2*Math.PI)
      }
      else if (path. type == type.polyline){
        ctx.moveTo(path.start[0] + offsetX, path.start[1] + offsetY);
        path.points.forEach(point => ctx.lineTo(point[0]+path.start[0]+offsetX, point[1]+path.start[1]+offsetY))
      }
      else if (path. type == type.polygon){
        ctx.moveTo(path.start[0] + offsetX, path.start[1] + offsetY);
        path.points.forEach(point => ctx.lineTo(point[0]+path.start[0]+offsetX, point[1]+path.start[1]+offsetY))
        ctx.lineTo(path.start[0]+offsetX, path.start[1]+offsetY)
      }

    }
    ctx.stroke();
    ctx.closePath();
    ctx.filter = "none"
    ctx.restore()
  }
  // #drawPath(path) {  
  //   if (path.state == state.deleted)
  //     return
  //   this.#ctx.save()
  //   this.#ctx.scale(this.#scale, this.#scale)
  //   let offsetX = 0, offsetY = 0, resizeX = 0, resizeY = 0
  //   if (path.state == state.selected){
  //     //this.#ctx.filter = `drop-shadow(0 0 4px #fff)`    Viable solo para un trazo
  //     offsetX = this.#rectSelection.offset[0]
  //     offsetY = this.#rectSelection.offset[1]
  //     resizeX = this.#rectSelection.resize[0]
  //     resizeY = this.#rectSelection.resize[1]
  //   }
  //   if (path.type == type.image){  
  //     if (resizeX/resizeY > path.proportion){
  //       resizeX = resizeY * path.proportion
  //     }
  //     else{
  //       resizeY = Math.round(resizeX / path.proportion)
  //     } 
  //     this.#ctx.drawImage(path.data, path.start[0] + offsetX, path.start[1] + offsetY, path.width + resizeX, path.height + resizeY)
  //     this.#ctx.filter = "none"
  //     this.#ctx.restore()
  //     return
  //   }
  //   else if (path.type == type.text){
  //     // const divAux = this.#editor.querySelector(".txt-can-divAux")
  //     // divAux.innerHTML = path.innerHTML
  //     // html2canvas(divAux, {backgroundColor: null, scale: 2}).then(canvas => {
  //     //   this.#ctx.imageSmoothingEnabled = true
  //     //   this.#ctx.drawImage(canvas, path.topLeft[0] + offsetX, path.topLeft[1] + offsetY, canvas.width/2, canvas.height/2)
  //     // });

  //     //this.#ctx.putImageData(path.img, path.topLeft[0] + offsetX, path.topLeft[1] + offsetY)
  //     this.#ctx.drawImage(path.img, path.topLeft[0] + offsetX, path.topLeft[1] + offsetY, path.img.width/2, path.img.height/2)
  //     this.#ctx.filter = "none"
  //     this.#ctx.restore()
  //     return
  //   }
  //   else{
  //     this.#ctx.lineWidth = path.brush.brushSize;
  //     this.#ctx.strokeStyle = path.brush.color;
  //     this.#ctx.lineCap = path.brush.lineCap;
  //     this.#ctx.lineJoin = path.brush.lineJoin;
  //     this.#ctx.beginPath();
  //     if (path.type == type.pencil || path.type == type.highlighter){
  //       // if (this.#isDrawing && path.length > 1){
  //       //   const prevPoint = path.points[path.points.length-2]
  //       //   const lastPoint = path.points[path.points.length-1]
  //       //   this.#ctx.moveTo(...prevPoint)
  //       //   this.#ctx.lineTo(...lastPoint)
  //       // }
  //       // else{
  //         this.#ctx.moveTo(path.start[0] + offsetX, path.start[1] + offsetY);
  //         path.points.forEach(point => this.#ctx.lineTo(point[0]+path.start[0]+offsetX, point[1]+path.start[1]+offsetY));
  //       // }
  //     }
  //     else if (path.type == type.line){
  //       this.#ctx.moveTo(path.start[0] + offsetX, path.start[1] + offsetY);
  //       this.#ctx.lineTo(path.end[0] + resizeX + offsetX, path.end[1] + resizeY + offsetY)
  //     }
  //     else if (path.type == type.rectangle){       
  //       this.#ctx.rect(path.start[0] + offsetX, path.start[1] + offsetY, path.end[0] + resizeX - path.start[0], path.end[1] + resizeY - path.start[1])
  //     }
  //     else if (path.type == type.ellipse){       
  //       this.#ctx.ellipse(path.start[0] + offsetX + resizeX/2, path.start[1] + offsetY + resizeY/2,
  //         Math.abs(path.end[0] + resizeX/2 - path.start[0]), Math.abs(path.end[1]+ resizeY/2  - path.start[1]), 0, 0, 2*Math.PI)
  //     }
  //     else if (path. type == type.polyline){
  //       this.#ctx.moveTo(path.start[0] + offsetX, path.start[1] + offsetY);
  //       path.points.forEach(point => this.#ctx.lineTo(point[0]+path.start[0]+offsetX, point[1]+path.start[1]+offsetY))
  //     }
  //     else if (path. type == type.polygon){
  //       this.#ctx.moveTo(path.start[0] + offsetX, path.start[1] + offsetY);
  //       path.points.forEach(point => this.#ctx.lineTo(point[0]+path.start[0]+offsetX, point[1]+path.start[1]+offsetY))
  //       this.#ctx.lineTo(path.start[0]+offsetX, path.start[1]+offsetY)
  //     }

  //   }
  //   this.#ctx.stroke();
  //   this.#ctx.closePath();
  //   this.#ctx.filter = "none"
  //   this.#ctx.restore()
  // }

  #isInside(x, y, tlx, tly, brx, bry, offset = 0){
  
    return (x>tlx-offset && x<brx+offset && y>tly-offset && y<bry+offset)
  }

  #setResizeSelection(){
    this.#isResizing = false
    const path = this.#rectSelection.paths[0]
    if (path.tool == tool.frame){
      let resizeX = this.#rectSelection.resize[0]
      let resizeY = this.#rectSelection.resize[1]
      if (resizeX/resizeY > path.proportion){
        resizeX = resizeY * path.proportion
      }
      else{
        resizeY = Math.round(resizeX / path.proportion)
      } 
      path.width += resizeX
      path.height += resizeY
      path.bottomRight[0] += resizeX
      path.bottomRight[1] += resizeY
      this.#rectSelection.bottomRight[0] += resizeX
      this.#rectSelection.bottomRight[1] += resizeY
    }
    else{
      if (path.type == type.ellipse){
        path.start[0] += this.#rectSelection.resize[0]/2
        path.start[1] += this.#rectSelection.resize[1]/2
        path.end[0] += this.#rectSelection.resize[0]
        path.end[1] += this.#rectSelection.resize[1]
      }
      else{
        path.end[0] += this.#rectSelection.resize[0]
        path.end[1] += this.#rectSelection.resize[1]
        path.bottomRight[0] += this.#rectSelection.resize[0]
        path.bottomRight[1] += this.#rectSelection.resize[1]
      }
      this.#rectSelection.bottomRight[0] += this.#rectSelection.resize[0]
      this.#rectSelection.bottomRight[1] += this.#rectSelection.resize[1]
    }
    this.#undo.push({action: action.resize, path: path, x: this.#rectSelection.resize[0], y: this.#rectSelection.resize[1]})
    this.#rectSelection.resize = [0, 0]
    this.#draw()
  }

  #setMoveSelection(){
    this.#isGrabbing = false
    this.#rectSelection.paths.forEach(path => {
      path.start[0] += this.#rectSelection.offset[0]
      path.start[1] += this.#rectSelection.offset[1]
      if(path.tool == tool.shape){
        path.end[0] += this.#rectSelection.offset[0]
        path.end[1] += this.#rectSelection.offset[1]
      }
      path.topLeft[0] += this.#rectSelection.offset[0]
      path.topLeft[1] += this.#rectSelection.offset[1]
      path.bottomRight[0] += this.#rectSelection.offset[0]
      path.bottomRight[1] += this.#rectSelection.offset[1]
      path.offset = [0, 0]    
    })
    this.#rectSelection.topLeft[0] += this.#rectSelection.offset[0]
    this.#rectSelection.topLeft[1] += this.#rectSelection.offset[1]
    this.#rectSelection.bottomRight[0] += this.#rectSelection.offset[0]
    this.#rectSelection.bottomRight[1] += this.#rectSelection.offset[1]
    this.#rectSelection.start[0] += this.#rectSelection.offset[0]
    this.#rectSelection.start[1] += this.#rectSelection.offset[1]
    this.#undo.push({action: action.move, paths: this.#rectSelection.paths, x: this.#rectSelection.offset[0], y: this.#rectSelection.offset[1]})
    this.#rectSelection.offset = [0, 0]      
    this.#draw()
  }

  #log(message, opts) {
    const o = {
      icon: true,
      color: "#0cc0e4",
      disableColor: false,
      logs: this.options.logs,
      ...opts,
    };

    if (o.logs) {
      if (typeof message !== "string") {
        console.log(message);
        return;
      }
      if (o.icon) {
        message = `ⓘ ${message}`;
      }
      if (!o.disableColor) {
        message = `%c${message}`;
      }
      console.log(message, `color: ${o.color}`);
    }
  }

  log = (message) => {
    return this.#log(message, { color: "yellow", logs: true });
  };

  // get scrollX () {
  //   return this.#canvas.parentNode.scrollTop
  // }
  // get scrollY () {
  //   return this.#canvas.parentNode.scrollLeft
  // }

  // set containerDimension(data){
  //   this.#containerDim.x = data.width
  //   this.#containerDim.y = data.height
  // }
  get canvasSize () {
    return {width: this.#canvas.width, height: this.#canvas.height}
  }
  set canvasSize (size) {
    this.#canvas.width = size.width
    this.#canvas.height = size.height
  }

  set bg(color) {
    this.options.bg = color;
    this.container.style.backgroundColor = this.options.bg;
    let gridColor
    if (parseInt(this.options.bg.slice(1), 16) < parseInt("666666", 16))
      gridColor = "#ffffff30"
    else
      gridColor = "#0000ff30"
    document.documentElement.style.setProperty('--grid-canvas-color', gridColor)

    //this.#canvas.style.background = this.options.bg;
  }

  set grid(value) {
    this.options.grid = value
  }
  get grid(){
    return this.options.grid
  }

  get scale() {
    return this.#scale
  }
  set scale(s) {
    this.#scale=s
  }
  get bg() {
    return this.options.bg
  }

  set brushSize(size) {
    if (!this.#rectSelection.empty){
      const sizes = []
      const changingPaths = []
      this.#rectSelection.paths.forEach((path) => {
        if (path.tool === tool.stroke || path.tool === tool.shape){
          changingPaths.push(path)
          sizes.push(path.brush.brushSize)
          path.brush.brushSize = size
        }
      })
      this.#undo.push({action: action.changeSize, paths: changingPaths, from: sizes, to: size})
      this.#draw()
    }
    this.options.brushSize = size;
  }

  get highlighterSize() {
    return this.options.highlighterSize;
  }

  set highlighterSize(size) {
    this.options.highlighterSize = size;
  }

  get brushSize() {
    return this.options.brushSize;
  }

  set brushColor(color) {
    if (this.brushType == type.highlighter) {
      this.options.color = color + "55";
      return;
    }
    if (!this.#rectSelection.empty){
      const colors = []
      const changingPaths = []
      this.#rectSelection.paths.forEach((path) => {
        if (path.tool === tool.stroke || path.tool === tool.shape){
          changingPaths.push(path)
          colors.push(path.brush.color)
          path.brush.color = color
        }
      })
      this.#undo.push({action: action.changeColor, paths: changingPaths, from: colors, to: color})
      this.#draw()
    }
    this.options.color = color;
  }

  get brushColor() {
    return this.options.color;
  }

  get opts() {
    return { ...this.options };
  }

  get ctx() {
    return this.#ctx;
  }

  get canvas() {
    return this.#canvas;
  }

  get content(){
    const content = this.#paths.filter( e => e.state != state.deleted)
    console.log(content);
    
    content.forEach(async (e) => {
      if (e.type == type.text)
        e.img = ""
      if (e.type == type.image){
        e.data = ""
        e.data64 = this.#images[e.data64]
      }
    })
    return content
  }
  set content(data) {
    this.#setImages(data).then(() => {
      this.#editor.classList.remove("txt-can-visible")
      this.#paths = [...data]
      this.#draw()
    })
  }
  get blockRightClick(){
    return this.#blockRightClick
  }
  set blockRightClick(value){
    this.#blockRightClick = value
  }
  
  #setImages = async (data) =>{
    const getImage = async (e) => {
      const base64ToBlob = (base64, contentType = '', sliceSize = 512) => {
          const byteCharacters = atob(base64.split(",")[1])
          const byteArrays = []
          for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
              const slice = byteCharacters.slice(offset, offset + sliceSize)
              const byteNumbers = new Array(slice.length)
              for (let i = 0; i < slice.length; i++) 
                  byteNumbers[i] = slice.charCodeAt(i)
              const byteArray = new Uint8Array(byteNumbers)
              byteArrays.push(byteArray)
          }
          return new Blob(byteArrays, { type: contentType })
      }
      const blob = base64ToBlob(e.data64, "image/png")
      return new Promise((resolve, reject) => {
          const img = new Image()
          img.onload = () => resolve(img)
          img.onerror = (error) => reject(error)
          img.src = URL.createObjectURL(blob)
      })
    }
  
    const divAux = document.createElement("div")
    document.body.appendChild(divAux)
    const promises = data.map(async e => {
      if (e.type == type.text){
        divAux.innerHTML = e.innerHTML
        e.img = await html2canvas(divAux, {backgroundColor: null, scale: 2})
      }
      if (e.type == type.image){
        e.data = await getImage(e)
        this.#images.push(e.data64)
        e.data64 = this.#images.length-1        
      }
    })
    await Promise.all(promises)
    document.body.removeChild(divAux)
  }
  zoom(factor){
    if (factor === 1)
      this.#scale = 1
    else 
      this.#scale *= factor
    this.#draw()
  }

  setTool(newTool, type){
    if (this.#cutter.isActive && newTool != tool.cutter ){
      this.#cutter.deactivate()
    }

    if (this.toolType == tool.text && newTool != tool.text){
      this.#endWriting()
    }
    this.toolType = newTool
    if (type)
      this.brushType = type
    this.brushColor = this.options.color.slice(0, 7)
    this.options.lineCap = "round"
    this.options.lineJoin = "round"
  }

  pencil = () => this.setTool(tool.stroke, type.pencil)

  highlighter = () => this.setTool(tool.stroke, type.highlighter)

  pointer = () => this.setTool(tool.stroke, type.pointer)

  eraser = () => {}

  line = () => this.setTool(tool.shape, type.line)

  rectangle = () => this.setTool(tool.shape, type.rectangle)

  ellipse = () => this.setTool(tool.shape, type.ellipse)

  polyline = () => this.setTool(tool.shape, type.polyline)

  polygon = () => this.setTool(tool.shape, type.polygon)

  write = () => this.setTool(tool.text, type.text)

  cutter = () => {this.setTool(tool.cutter); this.#cutterStart(); console.log("cutter");
  }

  magnifier = (callback) => {this.#magnifier.tellColor = callback? callback : null;this.setTool(tool.magnifier)}

  increaseH = (n) => {this.#canvas.width += n; this.#draw()}

  increaseV = (n) => {this.#canvas.height += n; this.#draw()}

  lightDark = () => {
    this.bg = this.bgColors[(this.bgColors.indexOf(this.bg)+1)%this.bgColors.length]
  }
/*
  grab = () => {
    this.toolType = tool.grab
  }
*/
  selectRect = () => this.setTool(tool.selectRect)

  clearOnlyScreen = () => {
    this.#ctx.clearRect(0, 0, this.#canvas.width, this.#canvas.height);
  };

  clear = () => {
    this.clearOnlyScreen();
    this.#redo.push(...this.#paths)
    this.#paths = [];
    //this.clearSaved();
    this.#isDrawing = false;
    this.#log("Cleared");
  };

  undo = () => {
    if (!this.#rectSelection.empty)
      this.cancelSelection()
    if (this.#undo.length>0){
      const lastAction = this.#undo.pop()
      this.#redo.push(lastAction)
      if (lastAction.action == action.draw){
        lastAction.path.state = state.deleted
      }
      else if (lastAction.action == action.delete){
        lastAction.paths.forEach(path => path.state = state.active)
      }
      else if (lastAction.action == action.move){
        lastAction.paths.forEach(path => {
          path.start[0] -= lastAction.x
          path.start[1] -= lastAction.y
          if(path.tool == tool.shape){
            path.end[0] -= lastAction.x
            path.end[1] -= lastAction.y
          }
          path.topLeft[0] -= lastAction.x
          path.topLeft[1] -= lastAction.y
          path.bottomRight[0] -= lastAction.x
          path.bottomRight[1] -= lastAction.y
        })
      }
      else if (lastAction.action == action.resize){
        if (lastAction.path.type == type.image){
          lastAction.path.width -= lastAction.x
          lastAction.path.height -= lastAction.y
          lastAction.path.bottomRight[0] -= lastAction.x
          lastAction.path.bottomRight[1] -= lastAction.y    
        }
        else if (lastAction.path.type == type.ellipse){
          lastAction.path.start[0] -= lastAction.x/2
          lastAction.path.start[1] -= lastAction.y/2
          lastAction.path.end[0] -= lastAction.x/2
          lastAction.path.end[1] -= lastAction.y/2
        }
        else{
          lastAction.path.end[0] -= lastAction.x
          lastAction.path.end[1] -= lastAction.y
          lastAction.path.bottomRight[0] -= lastAction.x
          lastAction.path.bottomRight[1] -= lastAction.y
        }
      }
      else if (lastAction.action == action.changeColor){
        lastAction.paths.forEach((path, index) => {
          path.brush.color = lastAction.from[index]
        })
      }
      else if (lastAction.action == action.changeSize){
        lastAction.paths.forEach((path, index) => {
          path.brush.brushSize = lastAction.from[index]
        })
      }
      this.#draw()
    }
  }
  
  redo = () => {
    if (this.#redo.length>0){
      const lastAction = this.#redo.pop()
      this.#undo.push(lastAction)
      if (lastAction.action == action.draw){
        lastAction.path.state = state.active
      }
      else if (lastAction.action == action.delete){
        lastAction.paths.forEach(path => path.state = state.deleted)
      }
      else if (lastAction.action == action.move){
        lastAction.paths.forEach(path => {
          path.start[0] += lastAction.x
          path.start[1] += lastAction.y
          if(path.tool == tool.shape){
            path.end[0] += lastAction.x
            path.end[1] += lastAction.y
          }
          path.topLeft[0] += lastAction.x
          path.topLeft[1] += lastAction.y
          path.bottomRight[0] += lastAction.x
          path.bottomRight[1] += lastAction.y
        })
      }
      else if (lastAction.action == action.resize){
        if (lastAction.path.type == type.image){
          lastAction.path.width += lastAction.x
          lastAction.path.height += lastAction.y
          lastAction.path.bottomRight[0] += lastAction.x
          lastAction.path.bottomRight[1] += lastAction.y    
        }
        else if (lastAction.path.type == type.ellipse){
          lastAction.path.start[0] += lastAction.x/2
          lastAction.path.start[1] += lastAction.y/2
          lastAction.path.end[0] += lastAction.x/2
          lastAction.path.end[1] += lastAction.y/2
        }
        else{
          lastAction.path.end[0] += lastAction.x
          lastAction.path.end[1] += lastAction.y
          lastAction.path.bottomRight[0] += lastAction.x
          lastAction.path.bottomRight[1] += lastAction.y
        }
      }
      else if (lastAction.action == action.changeColor){
        lastAction.paths.forEach((path) => {
          if (path.tool === tool.stroke || path.tool === tool.shape)
            path.brush.color = lastAction.to
        })
      }
      else if (lastAction.action == action.changeSize){
        lastAction.paths.forEach((path) => {
          if (path.tool === tool.stroke || path.tool === tool.shape)
            path.brush.brushSize = lastAction.to
        })
      }
      this.#draw()
    }
  }

  #imageEdition = (path) => {
    const blobToBase64 = (blob) => {
      return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onloadend = () => {
              resolve(reader.result);
          };
          reader.onerror = (error) => {
              reject(error);
          };
          reader.readAsDataURL(blob);
      });
    };
    const editor = new this.ImageEditor(path.data, path.compression)
    editor.then(async (editedImage) => {
      this.#canvas.focus()
      if (editedImage != null){
        const data64 = await blobToBase64(editedImage.blob)
        this.#images[path.data64] = data64
        const img = new Image()
        img.onload = () => {
          path.data = img
          path.width = img.width
          path.height = img.height
          path.proportion = img.width/img.height
          path.compression = editedImage.compression
          path.bottomRight = [path.start[0] + img.width, path.start[1] + img.height]
          this.#rectSelection.bottomRight = [...path.bottomRight]
          URL.revokeObjectURL(img.src)
          this.#draw()
        }
        img.src = URL.createObjectURL(editedImage.blob)
      }
    })
  }

  dropImage = async (e) => {
    
    e.preventDefault();
    const coords = this.#coordinates(e)
    const position = this.#canvas.getBoundingClientRect()
    coords[0] -= this.#canvas.parentNode.scrollLeft + position.x
    coords[1] -= this.#canvas.parentNode.scrollTop + position.y
    
    const blobToBase64 = (blob) => {
      return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onloadend = () => {
              resolve(reader.result);
          };
          reader.onerror = (error) => {
              reject(error);
          };
          reader.readAsDataURL(blob);
      });
    };
    function printImageMemorySize(imgElement) {
      // Crea un objeto Blob a partir de la URL de la imagen
      fetch(imgElement.src)
        .then(response => response.blob())
        .then(blob => {
          // El tamaño del Blob en bytes
          const memorySize = (blob.size / 1024).toFixed(2);
          console.log(`La imagen ocupa exactamente ${memorySize} bytes en memoria.`);
        })
        .catch(error => console.error('Error al obtener el tamaño de la imagen:', error));
    }
    
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      const file = files[0];
      if (file.type.startsWith('image/')) {
        const data64 = await blobToBase64(file)
        this.#images.push(data64)
        const img = new Image()
        img.onload = () => {
          this.#paths.push({
            state: state.active,
            tool: tool.frame,
            type: type.image,
            data64: this.#images.length-1,
            data: img,
            width: img.width,
            height: img.height,
            proportion: img.width/img.height,
            start: [...coords],
            topLeft: [...coords],
            bottomRight: [coords[0] + img.width, coords[1] + img.height],
            resize: [0,0]
          })
          console.log("al cargar");          
          printImageMemorySize(img);
          URL.revokeObjectURL(img.src)
          this.#draw()
        }
        img.src = URL.createObjectURL(file)
      }
      else{
        console.log("Por favor, arrastra solo imágenes.");          
      }

    }
  }

  pasteImage = async (e) => {
    const coords = this.#coordinates(e)
    const blobToBase64 = (blob) => {
      return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onloadend = () => {
              resolve(reader.result);
          };
          reader.onerror = (error) => {
              reject(error);
          };
          reader.readAsDataURL(blob);
      });
    };

    try {
      const clipboardItems = await navigator.clipboard.read()
      for (const item of clipboardItems){
        if (item.types.includes("image/png")){
          const blob = await item.getType("image/png")
          const data64 = await blobToBase64(blob)
          this.#images.push(data64)
          const img = new Image()
          img.onload = () => {
            this.#paths.push({
              state: state.active,
              tool: tool.frame,
              type: type.image,
              data64: this.#images.length-1,
              data: img,
              width: img.width,
              height: img.height,
              proportion: img.width/img.height,
              start: [...coords],
              topLeft: [...coords],
              bottomRight: [coords[0] + img.width, coords[1] + img.height],
              resize: [0,0]
            })
            URL.revokeObjectURL(img.src)
            this.#draw()
          }
          img.src = URL.createObjectURL(blob)
        }
      }
    } catch (err) {
      console.error("Error al leer el portapapeles: ", err);
    }
  }

  resize = (x, y) => {
  
    console.log("resize called");
    
    //const img = this.#ctx.getImageData(0, 0, this.#canvas.width, this.#canvas.height)
    //this.#canvas.width = x-17
    //this.#canvas.height = y- 38
    //this.#ctx.putImageData(img, 0, 0)
    this.#draw()
  }

  cancelSelection = (st = state.active) => {
    if (!this.#rectSelection.empty){
        this.#rectSelection.empty = true
        this.#rectSelection.paths.forEach(path => path.state = st)
        this.#rectSelection.paths = []
        this.#draw()
    }            
  }


  /* Clases para el editor de imagen */

  ImageEditor = class 
  {
    editorHTML = `  
                        <div class="image_editor_tools">
                            <svg class="image_editor_svg_clickable image_editor_accept_button" stroke-width="1.5" stroke="#00b341" fill="none" stroke-linecap="round" stroke-linejoin="round" viewBox="1.17 1.17 21.65 21.65">                 <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>                 <path d="M9 12l2 2l4 -4"></path>             </svg>
                            <svg class="image_editor_svg_clickable image_editor_cancel_button" stroke-width="1.5" stroke="#ff2825" fill="none" stroke-linecap="round" stroke-linejoin="round" viewBox="1.17 1.17 21.65 21.65">                 <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>                 <path d="M10 10l4 4m0 -4l-4 4"></path>             </svg>
                            <svg class="image_editor_svg_clickable image_editor_crop_button" stroke-width="1.5" stroke="#00abfb" fill="none" stroke-linecap="round" stroke-linejoin="round" viewBox="3.18 3.18 17.63 17.63">                 <path d="M8 5v10a1 1 0 0 0 1 1h10"></path>                 <path d="M5 8h10a1 1 0 0 1 1 1v10"></path>             </svg>
                            <div class="image_editor_resize_container" >
                                <svg style="padding: 3px 0;" stroke-width="1.5" stroke="#00abfb" fill="none" stroke-linecap="round" stroke-linejoin="round" viewBox="1.17 3.18 21.65 17.63">                     <path d="M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z"></path>                     <path d="M7 12v-3h3"></path>                     <path d="M17 12v3h-3"></path>                 </svg>
                                <input class="image_editor_resize_input" type="number" min="0" max="90" step="10" value="0">
                            </div>
                            <div class="image_editor_compression_container" >
                                <svg stroke-width="1.5" stroke="#00abfb" fill="none" stroke-linecap="round" stroke-linejoin="round" viewBox="1.17 6.18 21.65 11.63">                     <path d="M21 8h-2a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h2v-4h-1"></path>                     <path d="M10 16v-8h2a2 2 0 1 1 0 4h-2"></path>                     <path d="M3 8h4v6a2 2 0 0 1 -2 2h-1.5a.5 .5 0 0 1 -.5 -.5v-.5"></path>                 </svg>
                                <input class="image_editor_compression_input" type="number" min="0" max="90" step="10" value="0">
                            </div>
                            <div class="image_editor_brightness_container" >
                                <svg style="padding: 3px 0;" stroke-width="1.5" stroke="#00abfb" fill="none" stroke-linecap="round" stroke-linejoin="round" viewBox="1.17 1.17 21.65 21.65">                     <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>                     <path d="M12 12m-4 0a4 4 0 1 0 8 0a4 4 0 1 0 -8 0"></path>                     <path d="M3 12h1m8 -9v1m8 8h1m-9 8v1m-6.4 -15.4l.7 .7m12.1 -.7l-.7 .7m0 11.4l.7 .7m-12.1 -.7l-.7 .7"></path>                 </svg>
                                <input class="image_editor_brightness_input" type="number" min="-90" max="90" step="10" value="0">
                                </div>
                            <div class="image_editor_contrast_container" style="margin-bottom: 5px;">
                                <svg style="padding: 3px 0;" stroke-width="1.5" stroke="#00abfb" fill="none" stroke-linecap="round" stroke-linejoin="round" viewBox="1.17 1.17 21.65 21.65">                     <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>                     <path d="M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"></path>                     <path d="M12 3l0 18"></path>                     <path d="M12 9l4.65 -4.65"></path>                     <path d="M12 14.3l7.37 -7.37"></path>                     <path d="M12 19.6l8.85 -8.85"></path>                 </svg>
                                <input class="image_editor_contrast_input" type="number" min="-90" max="90" step="10" value="0">
                            </div>
                        </div>
                        <div class="image_editor_central">
                            <div class="image_editor_information"></div>
                            <div class="image_editor_preview"></div>
                        </div>
                    `

    $main
    $tools
    $info
    $preview
    $accept
    $cancel
    $crop
    $resize
    $compression
    $brightness
    $contrast
    originalContainer
    originalImage
    currentImage
    currentBlob
    cropper
    promise
    resolve
    reject
    resizeLevel = 1
    compressionLevel = 1
    brightnessLevel = 1
    contrastLevel = 1

    constructor (img, compression){
        this.$main = document.createElement("div")
        this.$main.classList.add("image_editor_main")
        this.$main.innerHTML = this.editorHTML
        this.$main.style.display = "flex"
        document.body.appendChild(this.$main)

        this.$tools = this.$main.querySelector(".image_editor_tools")
        this.$info = this.$main.querySelector(".image_editor_information")
        this.$preview = this.$main.querySelector(".image_editor_preview")
        this.$tools.querySelector(".image_editor_accept_button").addEventListener("click", this.#acceptHandle)
        this.$tools.querySelector(".image_editor_cancel_button").addEventListener("click", this.#cancelHandle)
        this.$tools.querySelector(".image_editor_crop_button").addEventListener("click", this.#cropHandle)
        this.$tools.querySelector(".image_editor_resize_input").addEventListener("input", this.#resizeHandle)
        this.$tools.querySelector(".image_editor_compression_input").addEventListener("input", this.#compressionHandle)
        this.$tools.querySelector(".image_editor_brightness_input").addEventListener("input", this.#brightnessHandle)
        this.$tools.querySelector(".image_editor_contrast_input").addEventListener("input", this.#contrastHandle)

        this.originalImage = img
        this.currentImage = this.originalImage
        this.cropper = new this.ImageCropper(this.$preview)
        if (compression){
          this.compressionLevel = compression
          this.$tools.querySelector(".image_editor_compression_input").value = (1 - compression) * 100
        }
        this.displayImage()
        this.promise = new Promise((resolve, reject) => {
            this.resolve = resolve
            this.reject = reject
        })
    }

    updateImage = () => {
            this.displayImage();
    }

    displayImage = () => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const width = this.currentImage.width * this.resizeLevel;
        const height = this.currentImage.height * this.resizeLevel;
       
        canvas.width = width;
        canvas.height = height;
        ctx.filter = `brightness(${this.brightnessLevel}) contrast(${this.contrastLevel})`;
        ctx.drawImage(this.currentImage, 0, 0, width, height);
        canvas.toBlob((blob) => {
            this.currentBlob = blob;
            const compressedImg = document.createElement('img');
            compressedImg.src = URL.createObjectURL(blob);
            this.$preview.querySelector("img")?.remove()
            this.$preview.appendChild(compressedImg);
            this.displayFileInfo(blob);
            //downloadButton.style.display = 'block';
        }, 'image/jpeg', this.compressionLevel);
    }

    #acceptHandle = () => {
        this.resolve({blob: this.currentBlob, compression: this.compressionLevel})  // también se puede devolver el currentBlob
        this.$main.remove()
    }

    then = (callback) => {
        return this.promise.then(callback)
    }

    #cancelHandle = () => {
        this.resolve(null)
        this.$main.remove()
    }

    #cropHandle = () => {
        if (this.cropper.visibility !== "none"){
            this.cropper.hide()
            //this.updateImage()
            this.#cropImage();
        }
    }

    #cropImage = () => {
        const img = this.$preview.querySelector("img")
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const width = this.cropper.width;
        const height = this.cropper.height;
        canvas.width = width;
        canvas.height = height;
        ctx.drawImage(img, this.cropper.x, this.cropper.y, width, height, 0, 0, width, height);
        canvas.toBlob((blob) => {
            this.currentBlob = blob
            const croppedImage = new Image();
            croppedImage.src = URL.createObjectURL(blob);
            croppedImage.onload = () => URL.revokeObjectURL(croppedImage.src)
            this.currentImage = croppedImage;
            this.resetControls();
            this.$preview.querySelector("img").remove();
            // this.$preview.style.width = `${width}px`;
            // this.$preview.style.height = `${height}px`;
            this.$preview.appendChild(croppedImage);
            this.displayFileInfo(blob);
        }, 'image/png');
    }

    resetControls = () => {
        this.$tools.querySelector(".image_editor_resize_input").value = 0
        this.$tools.querySelector(".image_editor_compression_input").value = 0
        this.$tools.querySelector(".image_editor_brightness_input").value = 0
        this.$tools.querySelector(".image_editor_contrast_input").value = 0
        this.resizeLevel = 1
        this.compressionLevel = 1
        this.brightnessLevel = 1
        this.contrastLevel = 1

    }

    #resizeHandle = (e) => {
        this.resizeLevel = 1 - (e.target.value / 100)
        this.updateImage()
    }

    #compressionHandle = (e) => {
        this.compressionLevel = 1 - (e.target.value / 100)
        this.updateImage()
    }

    #brightnessHandle = (e) => {
        this.brightnessLevel = 1 + (e.target.value / 100)
        this.updateImage()
    }

    #contrastHandle = (e) => {
        this.contrastLevel = 1 + (e.target.value / 100)
        this.updateImage()
    }


    displayFileInfo = (file) => {
        const sizeInKB = (file.size / 1024).toFixed(2);
        // Falta crear un sitio para fileInfo
        this.$info.textContent = `Tamaño del archivo: ${sizeInKB} KB`;
    }

    /* Clase interna para el cropper */

    ImageCropper = class {
    
      selectionHTML = `
          <div class="crooper_hadle" data-type="crooper_hadle_tl" style="cursor: nwse-resize;"></div>
          <div class="crooper_hadle crooper_hadle_bar" data-type="crooper_hadle_t" style="cursor: ns-resize;"></div>
          <div class="crooper_hadle" data-type="crooper_hadle_tr" style="cursor: nesw-resize;"></div>
          <div class="crooper_hadle crooper_hadle_bar" data-type="crooper_hadle_l" style="cursor: ew-resize;"></div>
          <div style="cursor: move"></div>
          <div class="crooper_hadle crooper_hadle_bar" data-type="crooper_hadle_r" style="cursor: ew-resize;"></div>
          <div class="crooper_hadle" data-type="crooper_hadle_bl" style="cursor: nesw-resize;"></div>
          <div class="crooper_hadle crooper_hadle_bar" data-type="crooper_hadle_b" style="cursor: ns-resize;"></div>
          <div class="crooper_hadle" data-type="crooper_hadle_br" style="cursor: nwse-resize;"></div>
          `
      
      $preview = ""
      img = ""
      $selection = ""
      rectSelection = {
          start: { x: 0, y: 0 },
          end: { x: 0, y: 0 },
          dragStart: { x: 0, y: 0 },
          dragEnd: { x: 0, y: 0 },
          isSelecting: false,
          isMoving: false,
          isResizing: false,
          currentHandle: false,
          tl: (x, y) => {this.rectSelection.start.x = x; this.rectSelection.start.y = y},
          tr: (x, y) => {this.rectSelection.end.x = x; this.rectSelection.start.y = y},
          bl: (x, y) => {this.rectSelection.start.x = x; this.rectSelection.end.y = y},
          br: (x, y) => {this.rectSelection.end.x = x; this.rectSelection.end.y = y},
          ini: (x, y) => {this.rectSelection.dragStart.x = x; this.rectSelection.dragStart.y = y},
          isIn: (x, y) => {this.rectSelection.dragEnd.x = x; this.rectSelection.dragEnd.y = y},
          dx: () => this.rectSelection.dragEnd.x - this.rectSelection.dragStart.x,
          dy: () => this.rectSelection.dragEnd.y - this.rectSelection.dragStart.y,
          width: () => Math.abs(this.rectSelection.end.x - this.rectSelection.start.x),
          height: () => Math.abs(this.rectSelection.end.y - this.rectSelection.start.y),
          reset: () => {
              this.rectSelection.isMoving = false
              this.rectSelection.isResizing = false
              this.rectSelection.isSelecting = false
              this.rectSelection.currentHandle = false
              this.rectSelection.tl(this.rectSelection.start.x + this.rectSelection.dx(), this.rectSelection.start.y + this.rectSelection.dy())
              this.rectSelection.br(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
              this.rectSelection.dragStart = { x: 0, y: 0 }
              this.rectSelection.dragEnd = { x: 0, y: 0 }
              if (this.rectSelection.start.x > this.rectSelection.end.x)
                  [this.rectSelection.start.x, this.rectSelection.end.x] = [this.rectSelection.end.x, this.rectSelection.start.x]
              if (this.rectSelection.start.y > this.rectSelection.end.y)
                  [this.rectSelection.start.y, this.rectSelection.end.y] = [this.rectSelection.end.y, this.rectSelection.start.y]
          },
          limit: (limits) => {
              if (this.rectSelection.start.x < 0)
                  this.rectSelection.start.x = 0
              if (this.rectSelection.end.x > limits.width)
                  this.rectSelection.end.x = limits.width
              if (this.rectSelection.start.y < 0)
                  this.rectSelection.start.y = 0
              if (this.rectSelection.end.y > limits.height)
                  this.rectSelection.end.y = limits.height
          }
      }
  
      constructor(parent){
          this.$preview = parent
          const main = document.createElement("div")
          main.classList.add("crooper_selection")
          main.style.display = "none"
          main.innerHTML = this.selectionHTML
          this.$preview.appendChild(main)
          //this.img = this.$preview.querySelector("img")
          //this.img = this.$preview.querySelector("img").getBoundingClientRect();
          this.$selection = this.$preview.querySelector(".crooper_selection")
          this.$preview.addEventListener('mousedown', this.startAction)
      }
      drawSelectionArea = () => {
          const limits = this.$preview.querySelector("img").getBoundingClientRect()
          this.rectSelection.limit(limits)
          this.$selection.style.left = `${Math.min(this.rectSelection.start.x, this.rectSelection.end.x)}px`;
          this.$selection.style.top = `${Math.min(this.rectSelection.start.y, this.rectSelection.end.y)}px`;
          this.$selection.style.width = `${this.rectSelection.width()}px`;
          this.$selection.style.height = `${this.rectSelection.height()}px`;
      }
      startAction = (e) => {
          e.preventDefault()
          const rect = this.$preview.getBoundingClientRect();
          if (this.$selection.style.display == "none"){
              this.rectSelection.isSelecting = true
              console.log(this.img);
              
              this.rectSelection.tl(e.offsetX , e.offsetY)
              console.log(this.rectSelection.start);
              
              this.rectSelection.end = {...this.rectSelection.start}
              console.log(this.rectSelection.end);
              this.drawSelectionArea()                
              this.$selection.style.display = 'grid'
          }
          else if (e.target.classList.contains("crooper_hadle")){
              this.rectSelection.isResizing = true
              this.rectSelection.currentHandle = e.target.dataset.type;
          }
          else if (this.$selection.contains(e.target)){
              this.rectSelection.isMoving = true
          }
          else
              this.$selection.style.display = "none"
          this.rectSelection.ini(e.clientX, e.clientY)
          this.$preview.addEventListener('mousemove', this.inAction)
          this.$preview.addEventListener('mouseup', this.endAction)
          this.$preview.addEventListener('mouseleave', this.endAction)
      }
      inAction = (e) => {
          const rectImg = this.img
          const rect = this.$preview.getBoundingClientRect();
          if (e.clientX < rectImg.left || e.clientX > rectImg.right || e.clientY < rectImg.top || e.clientY > rectImg.bottom)
          return
          this.rectSelection.isIn(e.clientX, e.clientY)
          if (this.rectSelection.isMoving){
              this.rectSelection.tl(this.rectSelection.start.x + this.rectSelection.dx(), this.rectSelection.start.y + this.rectSelection.dy())
              this.rectSelection.br(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
          }
          else if (this.rectSelection.isSelecting) {
              this.rectSelection.br(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
          }
          else if (this.rectSelection.isResizing) {
              if (this.rectSelection.currentHandle == "crooper_hadle_tl")
              this.rectSelection.tl(this.rectSelection.start.x + this.rectSelection.dx(), this.rectSelection.start.y + this.rectSelection.dy())
          else if (this.rectSelection.currentHandle == "crooper_hadle_tr")
              this.rectSelection.tr(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.start.y + this.rectSelection.dy())
          else if (this.rectSelection.currentHandle == "crooper_hadle_bl")
              this.rectSelection.bl(this.rectSelection.start.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
          else if (this.rectSelection.currentHandle == "crooper_hadle_br")
              this.rectSelection.br(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
          else if (this.rectSelection.currentHandle == "crooper_hadle_t")
              this.rectSelection.start.y += this.rectSelection.dy()
          else if (this.rectSelection.currentHandle == "crooper_hadle_r")
              this.rectSelection.end.x += this.rectSelection.dx()
          else if (this.rectSelection.currentHandle == "crooper_hadle_b")
              this.rectSelection.end.y += this.rectSelection.dy()
          else if (this.rectSelection.currentHandle == "crooper_hadle_l")
              this.rectSelection.start.x += this.rectSelection.dx()
          }
          this.rectSelection.ini(e.clientX, e.clientY)
          this.drawSelectionArea()
      }
      endAction = (e) => {
          this.rectSelection.reset()            
          this.$preview.removeEventListener('mousemove', this.inAction)
          this.$preview.removeEventListener('mouseup', this.endAction)
          this.$preview.removeEventListener('mouseleave', this.endAction)
      }
      hide = () => {
          this.$selection.style.display = "none"
      }
      get visibility () {
          return this.$selection.style.display
      }
      get width() {
          return this.rectSelection.width()
      }
      get height() {
          return this.rectSelection.height()
      }
      get x(){
          return this.rectSelection.start.x
      }
      get y(){
          return this.rectSelection.start.y
      }

    }

    
    
  }

  /* Para hacer recortes del canvas - es una variación del cropper*/

  CanvasCutter = class {
    
    selectionHTML = `
        <div class="crooper_hadle" data-type="crooper_hadle_tl" style="cursor: nwse-resize;"></div>
        <div class="crooper_hadle crooper_hadle_bar" data-type="crooper_hadle_t" style="cursor: ns-resize;"></div>
        <div class="crooper_hadle" data-type="crooper_hadle_tr" style="cursor: nesw-resize;"></div>
        <div class="crooper_hadle crooper_hadle_bar" data-type="crooper_hadle_l" style="cursor: ew-resize;"></div>
        <div style="cursor: move"></div>
        <div class="crooper_hadle crooper_hadle_bar" data-type="crooper_hadle_r" style="cursor: ew-resize;"></div>
        <div class="crooper_hadle" data-type="crooper_hadle_bl" style="cursor: nesw-resize;"></div>
        <div class="crooper_hadle crooper_hadle_bar" data-type="crooper_hadle_b" style="cursor: ns-resize;"></div>
        <div class="crooper_hadle" data-type="crooper_hadle_br" style="cursor: nwse-resize;"></div>
        `
    
    $preview = ""
    img = ""
    $selection = ""
    isActive = false

    rectSelection = {
        start: { x: 0, y: 0 },
        end: { x: 0, y: 0 },
        dragStart: { x: 0, y: 0 },
        dragEnd: { x: 0, y: 0 },
        isSelecting: false,
        isMoving: false,
        isResizing: false,
        currentHandle: false,
        tl: (x, y) => {this.rectSelection.start.x = x; this.rectSelection.start.y = y},
        tr: (x, y) => {this.rectSelection.end.x = x; this.rectSelection.start.y = y},
        bl: (x, y) => {this.rectSelection.start.x = x; this.rectSelection.end.y = y},
        br: (x, y) => {this.rectSelection.end.x = x; this.rectSelection.end.y = y},
        ini: (x, y) => {this.rectSelection.dragStart.x = x; this.rectSelection.dragStart.y = y},
        isIn: (x, y) => {this.rectSelection.dragEnd.x = x; this.rectSelection.dragEnd.y = y},
        dx: () => this.rectSelection.dragEnd.x - this.rectSelection.dragStart.x,
        dy: () => this.rectSelection.dragEnd.y - this.rectSelection.dragStart.y,
        width: () => Math.abs(this.rectSelection.end.x - this.rectSelection.start.x),
        height: () => Math.abs(this.rectSelection.end.y - this.rectSelection.start.y),
        reset: () => {
            this.rectSelection.isMoving = false
            this.rectSelection.isResizing = false
            this.rectSelection.isSelecting = false
            this.rectSelection.currentHandle = false
            this.rectSelection.tl(this.rectSelection.start.x + this.rectSelection.dx(), this.rectSelection.start.y + this.rectSelection.dy())
            this.rectSelection.br(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
            this.rectSelection.dragStart = { x: 0, y: 0 }
            this.rectSelection.dragEnd = { x: 0, y: 0 }
            if (this.rectSelection.start.x > this.rectSelection.end.x)
                [this.rectSelection.start.x, this.rectSelection.end.x] = [this.rectSelection.end.x, this.rectSelection.start.x]
            if (this.rectSelection.start.y > this.rectSelection.end.y)
                [this.rectSelection.start.y, this.rectSelection.end.y] = [this.rectSelection.end.y, this.rectSelection.start.y]
        },
        limit: (limits) => {
            if (this.rectSelection.start.x < 0)
                this.rectSelection.start.x = 0
            if (this.rectSelection.end.x > limits.width)
                this.rectSelection.end.x = limits.width
            if (this.rectSelection.start.y < 0)
                this.rectSelection.start.y = 0
            if (this.rectSelection.end.y > limits.height)
                this.rectSelection.end.y = limits.height
        }
    }

    constructor(parent){
        console.log(parent);
        
        this.$preview = parent
        const main = document.createElement("div")
        main.classList.add("crooper_selection")
        main.style.display = "none"
        main.innerHTML = this.selectionHTML
        this.$preview.appendChild(main)
        //this.img = this.$preview.querySelector("img")
        //this.img = this.$preview.querySelector("img").getBoundingClientRect();
        this.$selection = this.$preview.querySelector(".crooper_selection")
      }
      
    get isActive () {
        return this.isActive
    }
    
    activate = () => {
        this.isActive = true
        this.$preview.style.position = "relative"
        this.$preview.addEventListener('mousedown', this.startAction)
    }
    deactivate = () => {
        this.isActive = false
        this.$selection.style.display = "none"
        this.$preview.style.position = ""
        this.$preview.removeEventListener('mousedown', this.startAction)
    }
    drawSelectionArea = () => {
        const limits = this.$preview.querySelector("canvas").getBoundingClientRect()
        this.rectSelection.limit(limits)
        this.$selection.style.left = `${Math.min(this.rectSelection.start.x, this.rectSelection.end.x)}px`;
        this.$selection.style.top = `${Math.min(this.rectSelection.start.y, this.rectSelection.end.y)}px`;
        this.$selection.style.width = `${this.rectSelection.width()}px`;
        this.$selection.style.height = `${this.rectSelection.height()}px`;
    }
    startAction = (e) => {
        if (!this.isActive)
          return
        e.preventDefault()
        const rect = this.$preview.getBoundingClientRect();
        if (this.$selection.style.display == "none"){
            this.rectSelection.isSelecting = true
            this.rectSelection.tl(e.offsetX , e.offsetY)
            this.rectSelection.end = {...this.rectSelection.start}
            this.drawSelectionArea()                
            this.$selection.style.display = 'grid'
        }
        else if (e.target.classList.contains("crooper_hadle")){
            this.rectSelection.isResizing = true
            this.rectSelection.currentHandle = e.target.dataset.type;
        }
        else if (this.$selection.contains(e.target)){
            this.rectSelection.isMoving = true
        }
        else
            this.$selection.style.display = "none"

        this.rectSelection.ini(e.clientX, e.clientY)
        this.$preview.addEventListener('mousemove', this.inAction)
        this.$preview.addEventListener('mouseup', this.endAction)
        this.$preview.addEventListener('mouseleave', this.endAction)
    }
    inAction = (e) => {
        const rectImg = this.img
        const rect = this.$preview.getBoundingClientRect();
        if (e.clientX < rectImg.left || e.clientX > rectImg.right || e.clientY < rectImg.top || e.clientY > rectImg.bottom)
        return
        this.rectSelection.isIn(e.clientX, e.clientY)
        if (this.rectSelection.isMoving){
            this.rectSelection.tl(this.rectSelection.start.x + this.rectSelection.dx(), this.rectSelection.start.y + this.rectSelection.dy())
            this.rectSelection.br(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
        }
        else if (this.rectSelection.isSelecting) {
            this.rectSelection.br(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
        }
        else if (this.rectSelection.isResizing) {
            if (this.rectSelection.currentHandle == "crooper_hadle_tl")
            this.rectSelection.tl(this.rectSelection.start.x + this.rectSelection.dx(), this.rectSelection.start.y + this.rectSelection.dy())
        else if (this.rectSelection.currentHandle == "crooper_hadle_tr")
            this.rectSelection.tr(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.start.y + this.rectSelection.dy())
        else if (this.rectSelection.currentHandle == "crooper_hadle_bl")
            this.rectSelection.bl(this.rectSelection.start.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
        else if (this.rectSelection.currentHandle == "crooper_hadle_br")
            this.rectSelection.br(this.rectSelection.end.x + this.rectSelection.dx(), this.rectSelection.end.y + this.rectSelection.dy())
        else if (this.rectSelection.currentHandle == "crooper_hadle_t")
            this.rectSelection.start.y += this.rectSelection.dy()
        else if (this.rectSelection.currentHandle == "crooper_hadle_r")
            this.rectSelection.end.x += this.rectSelection.dx()
        else if (this.rectSelection.currentHandle == "crooper_hadle_b")
            this.rectSelection.end.y += this.rectSelection.dy()
        else if (this.rectSelection.currentHandle == "crooper_hadle_l")
            this.rectSelection.start.x += this.rectSelection.dx()
        }
        this.rectSelection.ini(e.clientX, e.clientY)
        this.drawSelectionArea()
    }
    endAction = (e) => {
        const rect = this.$preview.getBoundingClientRect();
        this.rectSelection.reset()            
        this.$preview.removeEventListener('mousemove', this.inAction)
        this.$preview.removeEventListener('mouseup', this.endAction)
        this.$preview.removeEventListener('mouseleave', this.endAction)
    }
    hide = () => {
        this.$selection.style.display = "none"
    }
    // get visibility () {
    //     return this.$selection.style.display
    // }
    get width() {
        return this.rectSelection.width()
    }
    get height() {
        return this.rectSelection.height()
    }
    get x(){
        return this.rectSelection.start.x
    }
    get y(){
        return this.rectSelection.start.y
    }

  }

  
  /* Clase interna para la lupa - colorPicker */




  /*
  formatText = (command, value = null) => {
    document.execCommand(command, false, value);
  }


  
  save = () => {
    localStorage.removeItem(this.#CONSTANTS.DATA_KEY);
    localStorage.setItem(this.#CONSTANTS.DATA_KEY, JSON.stringify(this.#paths));
    if (!this.options.autosave) {
      this.#log("Saved!");
    }
  };

  clearSaved = () => {
    localStorage.removeItem(this.#CONSTANTS.DATA_KEY);
    this.#log("Saved cleared");
  };

  drawFromSaved = () => {
    const paths = localStorage.getItem(this.#CONSTANTS.DATA_KEY);
    if (paths) {
      this.#paths = JSON.parse(paths);
      this.redraw();
    }
    this.#log("Redrawn from save");
  };

  download = (filename = "drawing") => {
    this.#ctx.fillStyle = this.options.bg;
    this.#ctx.fillRect(0, 0, this.#canvas.width, this.#canvas.height);
    this.#drawPath();
    const a = document.createElement("a");
    a.download = filename;
    a.style.display = "none";
    const dataUrl = this.#canvas.toDataURL();
    a.href = dataUrl;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    this.#log("Download called");
  };
*/
}





/* -----------------

Código principal 

--------------------  */

const textEditorHtml = `
            <div class="txt-can-divAux"></div>
            <div class="txt-can-editor" contenteditable="true" style="resize: horizontal; display: inline-block; overflow: auto;"></div>
            <div class="txt-can-options">
                <button onclick="document.execCommand('undo')" class="txt-can-option"><span class="txt-can-icono" style="display: inline-block; transform: rotate(-90deg);">&#11119;</span></button>
                <button onclick="document.execCommand('redo')" class="txt-can-option"><span class="txt-can-icono" style="display: inline-block; transform: rotate(90deg);">&#11118;</span></button>
                <button onclick="document.execCommand('bold')" class="txt-can-option"><span class="txt-can-icono">&#119809;</span></button>
                <button onclick="document.execCommand('italic')" class="txt-can-option"><span class="txt-can-icono">&#119868;</span></button>
                <button onclick="document.execCommand('underline')" class="txt-can-option"><span class="txt-can-icono" style="text-decoration: underline;">&#120224;</span></button>
                <div class="txt-can-dropdown" onclick="event.stopPropagation()">
                    <button ><span class="txt-can-icono">&#x1F5DA;</span></button>
                    <div onmousedown="document.execCommand('fontSize', false, event.target.getAttribute('data-value'))" class="txt-can-dropdown-content txt-can-option txt-can-dropdown-list">
                        <div data-value="1">Muy pequeño</div>
                        <div data-value="2">Pequeño</div>
                        <div data-value="3">Normal</div>
                        <div data-value="4">Grande</div>
                        <div data-value="5">Más grande</div>
                        <div data-value="6">Muy grande</div>
                        <div data-value="7">Máximo</div>
                    </div>
                </div>

                <div class="txt-can-dropdown">
                    <button><span class="txt-can-icono">&#120224;</span></button>
                    <div onmousedown="document.execCommand('fontName', false, event.target.getAttribute('data-value'))" class="txt-can-dropdown-content txt-can-option txt-can-dropdown-list">
                        <div data-value="Arial">Arial</div>
                        <div data-value="Courier New">Courier New</div>
                        <div data-value="Georgia">Georgia</div>
                        <div data-value="Times New Roman">Times New Roman</div>
                        <div data-value="Verdana">Verdana</div>
                    </div>
                </div>

                <div class="txt-can-dropdown">         
                    <button><span class="txt-can-icono" style="color: red;">&#120224;</span></button>
                    <div onmousedown="document.execCommand('foreColor', false, event.target.getAttribute('data-value'))" class="txt-can-dropdown-content txt-can-option txt-can-color-picker txt-can-foreColor">
                        <div class="txt-can-color-option" style="background-color: transparent; display: grid; place-content: center;" data-value="transparent">No</div>
                        <div class="txt-can-color-option" style="background-color: black;" data-value="black"></div>
                        <div class="txt-can-color-option" style="background-color: red;" data-value="red"></div>
                        <div class="txt-can-color-option" style="background-color: green;" data-value="green"></div>
                        <div class="txt-can-color-option" style="background-color: blue;" data-value="blue"></div>
                        <div class="txt-can-color-option" style="background-color: yellow;" data-value="yellow"></div>
                        <div class="txt-can-color-option" style="background-color: purple;" data-value="purple"></div>
                        <div class="txt-can-color-option" style="background-color: white;" data-value="white"></div>
                        <div class="txt-can-color-option" style="background-color: lightgreen;" data-value="lightgreen"></div>
                        <div class="txt-can-color-option" style="background-color: lightblue;" data-value="lightblue"></div>
                        <div class="txt-can-color-option" style="background-color: pink;" data-value="pink"></div>
                        <div class="txt-can-color-option" style="background-color: lightgray;" data-value="lightgray"></div>
                        <div class="txt-can-color-option" style="background-color: orange;" data-value="orange"></div>
                        <div class="txt-can-color-option" style="background-color: brown;" data-value="brown"></div>
                        <div class="txt-can-color-option" style="background-color: cyan;" data-value="cyan"></div>
                        <div class="txt-can-color-option" style="background-color: magenta;" data-value="magenta"></div>
                        <div class="txt-can-color-option" style="background-color: lime;" data-value="lime"></div>
                        <div class="txt-can-color-option" style="background-color: navy;" data-value="navy"></div>
                    </div>
                    
                </div> <div class="txt-can-dropdown">
                    <button><span class="txt-can-icono" style="background-color: rgb(255, 255, 140)">&#120224;</span></button>
                    <div onmousedown="document.execCommand('hiliteColor', false, event.target.getAttribute('data-value'))" class="txt-can-dropdown-content txt-can-option txt-can-color-picker txt-can-hiliteColor">
                        <div class="txt-can-color-option" style="background-color: transparent; display: grid; place-content: center;" data-value="transparent">No</div>
                        <div class="txt-can-color-option" style="background-color: black;" data-value="black"></div>
                        <div class="txt-can-color-option" style="background-color: red;" data-value="red"></div>
                        <div class="txt-can-color-option" style="background-color: green;" data-value="green"></div>
                        <div class="txt-can-color-option" style="background-color: blue;" data-value="blue"></div>
                        <div class="txt-can-color-option" style="background-color: yellow;" data-value="yellow"></div>
                        <div class="txt-can-color-option" style="background-color: purple;" data-value="purple"></div>
                        <div class="txt-can-color-option" style="background-color: white;" data-value="white"></div>
                        <div class="txt-can-color-option" style="background-color: lightgreen;" data-value="lightgreen"></div>
                        <div class="txt-can-color-option" style="background-color: lightblue;" data-value="lightblue"></div>
                        <div class="txt-can-color-option" style="background-color: pink;" data-value="pink"></div>
                        <div class="txt-can-color-option" style="background-color: lightgray;" data-value="lightgray"></div>
                        <div class="txt-can-color-option" style="background-color: orange;" data-value="orange"></div>
                        <div class="txt-can-color-option" style="background-color: brown;" data-value="brown"></div>
                        <div class="txt-can-color-option" style="background-color: cyan;" data-value="cyan"></div>
                        <div class="txt-can-color-option" style="background-color: magenta;" data-value="magenta"></div>
                        <div class="txt-can-color-option" style="background-color: lime;" data-value="lime"></div>
                        <div class="txt-can-color-option" style="background-color: navy;" data-value="navy"></div>
                    </div>
                </div>
            </div>
`
const type = {
  pencil: "pencil",
  eraser: "eraser",
  highlighter: "highlighter",
  line: "line",
  rectangle: "rectangle",
  ellipse: "ellipse",
  polyline: "polyline",
  polygon: "polygon",
  image: "image",
  text: "text",
  pointer: "pointer"
};

const tool = {
  stroke: "stroke",
  shape: "shape",
  grab: "grab",
  selectRect: "selectRect",
  frame: "frame",
  text: "text",
  magnifier: "magnifier",
  cutter: "cutter"
}

const state = {
  active: "active",
  deleted: "deleted",
  selected: "selected"
}

const action = {
  draw: "draw",
  delete: "delete",
  move: "move",
  resize: "resize",
  changeColor: "changeColor",
  changeSize: "changeSize"
}




async function preguntar(mensaje){
    return new Promise((res) => {
        if (confirm(mensaje)){
            res(true)
        }
        else{
            res(false)
        }
    });
}
// Para gestionar el toggle de los tab de los menus
function clickTab(e) {
    const tabs = e.parentNode.querySelectorAll(".tab")
    tabs.forEach((tab)=>{
        tab.classList.remove("activo")
    })
    e.classList.add("activo")
} 
/*
async function getDatos(fichero) {
    let datos 
    await fetch(new Request(fichero))
        .then((res) => res.json())
        .then((data) => {
            datos = data
        })
    return datos
}

async function save(value) {
    const datosNuevosElementos = {}
    for (const e of elementos){
        datosNuevosElementos[e.datosInternos.id] = await e.datosActual()
    }
    const datosNuevosEntornos = {"activo": datosEntornos.activo}
    for (const e of entornos){
        datosNuevosEntornos[e.datosInternos.id] = e.datosActual()
    }
    datosArbol = dataFromTree()
    console.log("Elementos guardados: "+Object.keys(datosNuevosElementos).length);
    console.log("Eentornos guardados: "+Object.keys(datosNuevosEntornos).length);
    const res1 = await fetch('/index.html', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json;charset=utf-8',
            'Servidor': value,
            'Archivo': 'elementos.json'
        },
        body: JSON.stringify(datosNuevosElementos)
    });
    const res2 = await fetch('/index.html', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json;charset=utf-8',
            'Servidor': value,
            'Archivo': 'entornos.json'
        },
        body: JSON.stringify(datosNuevosEntornos)
    });
    const res3 = await fetch('/index.html', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json;charset=utf-8',
            'Servidor': value,
            'Archivo': 'arbol.json'
        },
        body: JSON.stringify(datosArbol)
    });
    if (res1.status == 200 && res2.status == 200 && res3.status == 200)
        setTimeout(() => mostrarMensajeTemporal("Elemtos y Entornos guardados correctamente", 1000), 1100)
}
*/
async function mostrarMensajeTemporal(mensaje, duracion) {
    const mensajeTemporal = document.getElementById("mensajeTemporal");
    mensajeTemporal.textContent = mensaje;
    mensajeTemporal.style.display = "block";
    // Esperar 1 segundo antes de ocultar el mensaje
    await new Promise((resolve) => setTimeout(resolve, duracion));
    mensajeTemporal.classList.add("fade-out");
    setTimeout(() => {
        mensajeTemporal.style.display = "none";
        mensajeTemporal.classList.remove("fade-out");
    }, 1000);
}

function crearElemento(nodo, elemento) {
    if (elemento.tipo == "apunte")
        return new Apunte(nodo, elemento)
    else if (elemento.tipo == "horarioClases")
        return new Horario(nodo, elemento)
    else if (elemento.tipo == "dibujo")
        return new Dibujo(nodo, elemento)
}

function cambiarEntorno() {
    document.getElementById(datosEntornos.activo).classList.add("oculto")
    const liActivo = $arbol.querySelector(".active").closest("li")
    const getNextUp = (li) => {
        let up = li.previousElementSibling, down = li.nextElementSibling
        while (up || down) {
            if (up){
                if (up.classList.contains("folder"))
                    up = up.previousElementSibling
                else
                    return up
            }
            if (down){
                if (down.classList.contains("folder"))
                    down = down.nextElementSibling
                else
                    return down
            }
        }
        if (li.parentNode.classList.contains("nested"))
            return getNextUp(li.parentNode.parentNode)
        return false
    }
    const getNext = (li) => {
        const next = getNextUp(li)
        if (next)
            return next

        const todosLosLi = Array.from($arbol.querySelectorAll("li:not(.folder)"));
        const liEnPapelera = Array.from($arbol.querySelectorAll("li[data-id='papelera'] li"));
        const otros = todosLosLi.filter((e) => {
            return !liEnPapelera.includes(e) && e !== liActivo
        });
        if (otros.length>0)
            return otros[0]
        else
            return false
    }
    const nextActivo = getNext(liActivo)
    if (nextActivo){
        liActivo.querySelector(".name").classList.remove("active")
        nextActivo.querySelector(".name").classList.add("active")
        datosEntornos.activo = nextActivo.dataset.id
        document.getElementById("marcador").innerHTML="Entorno " + nextActivo.dataset.nombre 
    }
    else{
        datosEntornos.activo = "000"
        document.getElementById("marcador").innerHTML="No hay entorno creado" 
    }
    document.getElementById(datosEntornos.activo).classList.remove("oculto")
    return liActivo
}

function muestraEntorno(id){
    document.getElementById(datosEntornos.activo).classList.add("oculto")
    datosEntornos.activo = id
    document.getElementById(datosEntornos.activo).classList.remove("oculto")
    document.getElementById("marcador").innerHTML="Entorno "+datosEntornos[datosEntornos.activo].nombre
}

function nuevoEntorno(nombre) {
    const id = Date.now()
    const nuevo = {
        "id": id,
        "nombre": nombre,
        "descripción": "información adicional",
        "fondo": "#333",
        "elementos": []
    }
    datosEntornos[id] = nuevo
    entornos.push(new Entorno($main, id))
    entornosIDs.push(id.toString())
    document.getElementById(datosEntornos.activo)?.classList.add("oculto")
    datosEntornos.activo = id
    document.getElementById(datosEntornos.activo)?.classList.remove("oculto")
    document.getElementById("marcador").innerHTML="Entorno "+datosEntornos[datosEntornos.activo].nombre
    return id
}
// Modelos para elementos nuevos
const modelos = {
    "apunte": {
        "id": "",
        "tipo": "apunte",
        "titulo": "Título",
        "contenido": "",
        "posicion": {
            "x": "200px",
            "y": "150px",
            "z": "900"
        },
        "size": {
            "width": "300px",
            "height": "200px"
        },
        "aspecto": {
            "contenido": {
                "fondo": "#777777",
                "color": "#000000",
                "size": "14px",
                "fuente": "Arial"
            },
            "titulo": {
                "vista": "destacado",
                "fondo": "#111111",
                "color": "#dddddd",
                "size": "18px",
                "fuente": "Arial"
            }
        },
        "informacion": {
            "creacion": "",
            "modificacion": "",
            "tipo": [],
            "entorno": []
        }
    },
    "dibujo": {
        "id": "",
        "tipo": "dibujo",
        "contenido": [],
        "posicion": {
            "x": "44px",
            "y": "28px",
            "z": "4"
        },
        "size": {
            "width": 2000,
            "height": 3000
        },
        "scroll": {
            "top": 0,
            "left": 0 
        },
        "scale": 1,
        "bg": "#222222",
        "informacion": {
            "creacion": "",
            "modificacion": "",
            "tipo": [],
            "entorno": []
        }
    },
    "horarioClases": {
        "id": "",
        "tipo": "horarioClases",
        "titulo": "Título",
        "contenido": {
            "1": [
                "",
                "",
                "",
                "",
                ""
            ],
            "2": [
                "",
                "",
                "",
                "",
                ""
            ],
            "3": [
                "",
                "",
                "",
                "",
                ""
            ],
            "4": [
                "",
                "",
                "",
                "",
                ""
            ],
            "5": [
                "",
                "",
                "",
                "",
                ""
            ]
        },
        "posicion": {
            "x": "200px",
            "y": "150px",
            "z": "900"
        },
        "size": {
            "x": "",
            "y": "",
            "width": "",
            "height": ""
        },
        "color": "190",
        "informacion": {
            "creacion": "",
            "modificacion": "",
            "tipo": [],
            "entorno": []
        }
    }
}
// Variables globales
const $main = document.getElementById("main")   //  Donde se muestra el entorno activo
const $sidebar = document.querySelector('.sidebar');
const $arbol = document.querySelector(".arbol")
//const datosElementos = await getDatos("elementos.json") //  Datos almacenados
//const datosEntornos = await getDatos("entornos.json")
//let datosArbol = await getDatos("arbol.json")
const datosElementos = {} // await getDatos("elementos.json")
const datosEntornos = {} // await getDatos("entornos.json")
let datosArbol = [    {        "id": "papelera",        "nombre": "&#9851; Papelera",        "estado": "cerrado",        "contenido": []    }]

const entornosIDs = Object.keys(datosEntornos).filter(e => e != "activo")   // IDs de todos los entornos definidos
const elementos = []    // Almacena los elementos creados
const entornos = []     // Almacena los entornos creados
const tiposElementos = ["Apunte", "Horario clases", "Dibujo"]

for (const id of entornosIDs){              //  Crea los entornos
    entornos.push(new Entorno($main, id))
}
// Resize de barra lateral

function handleResize() {
  
    function resize(e) {
      const newWidth = e.clientX - document.querySelector('.central').offsetLeft;
      if (newWidth > 100 && newWidth < 400) { // Límites de ancho
        $sidebar.style.width = newWidth + 'px';
      }
    }
  
    function stopResize() {
      document.removeEventListener('mousemove', resize);
      document.removeEventListener('mouseup', stopResize);
    }
  
    document.addEventListener('mousemove', resize);
    document.addEventListener('mouseup', stopResize);
  }
  
document.querySelector('.resizer').addEventListener('mousedown', handleResize);

// Mostrar / Ocultar barra lateral

function toggleSidebar(e) {
    if (e.ctrlKey && e.key == 'b') {
      const $resizer = document.querySelector('.resizer');
      $sidebar.style.display = $sidebar.style.display === 'none' ? 'block' : 'none';
      $resizer.style.display = $resizer.style.display === 'none' ? 'block' : 'none';
      if ($sidebar.style.display === 'block')
        $arbol.focus()}
  }

// Generar árbol de contenido de la barra lateral

function dataFromTree(ul) {
    const array = []
    if (!ul)
        ul = $arbol.querySelector("ul")
    const children = ul.children
    for (let i = 0; i < children.length; i++) {
        const li = children[i];
        if (li.classList.contains("folder")){
            array.push({"id": li.dataset.id, "nombre": li.dataset.nombre, "estado": li.dataset.estado, "contenido": dataFromTree(li.querySelector("ul"))})
        }
        else{
            array.push({"id": li.dataset.id, "nombre": li.dataset.nombre})
        }
    }
    return array
}

const createTree = (container, data) => {
	
	  
    const ul = document.createElement('ul');
	if (data.keys)
	{
    data.forEach(e => {
        const li = document.createElement('li');
        li.dataset.id = e.id
        li.dataset.nombre = e.nombre
        const txt = document.createElement("span")
        txt.classList.add("name")
        txt.innerHTML = e.nombre
        if (e.contenido){       // El elemento del árbol es una carpeta
            li.classList.add('folder');
            li.dataset.estado = e.estado
            const content = document.createElement("div")
            content.innerHTML = iconHTML
            if (e.id === "papelera")
                txt.dataset.papelera = true
            content.appendChild(txt)
            li.appendChild(content)
            const nestedUl = createTree(document.createElement('ul'), e.contenido);
            nestedUl.classList.add('nested');
            if (e.estado === "abierto"){
                nestedUl.classList.add('open');
                li.querySelector(".icon").classList.remove('closed');
            }
            li.appendChild(nestedUl);
        } 
        else {
            li.appendChild(txt)     // El elemento del árbol es un entorno
        }
        ul.appendChild(li);
    })
	}
    container.appendChild(ul);
    ul.addEventListener('contextmenu', e => e.preventDefault())
    
    ul.addEventListener('mousedown', handleClickSidebar)
    return ul;
}

const setActiveElement = (element) => {
    $arbol.querySelector(".active")?.classList.remove("active")
    element.querySelector(".name").classList.add("active")
}
const getLiVisibles = () => {
    const agregarLis = (ul) => {
        let ans = [];
        const lis = [...ul.children]
        lis.forEach(li => {
            ans.push(li)
            if (li.classList.contains("folder") && li.querySelector("ul").classList.contains("open"))
                ans = [...ans, ...agregarLis(li.querySelector("ul"))]
        })
        return ans
    }
    return agregarLis($arbol.querySelector("ul"))
}
const createNewTreeElement = (parent, type) => {
    const li = document.createElement('li');
    if (type === "folder"){
        li.classList.add('folder');
        li.innerHTML = iconHTML
    }
    const input = document.createElement('input');
    input.type = "text";
    input.placeholder = "Nombre...";
    li.appendChild(input);
    parent.appendChild(li);
    input.focus();

    const stopEdtiting = () => {
        input.removeEventListener('blur', stopEdtiting);
        input.removeEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                stopEdtiting();
            }
        });

        const newName = input.value.trim();
        if (newName) {
            li.innerHTML = "";
            const txt = document.createElement("span")
            txt.classList.add("name")
            txt.innerHTML = newName
            if (type === "folder"){
                li.dataset.id = Date.now()
                const content = document.createElement("div")
                content.innerHTML = iconHTML
                content.appendChild(txt)
                li.appendChild(content)
                const nestedUl = document.createElement('ul');
                nestedUl.classList.add('nested');
                li.appendChild(nestedUl);
                li.dataset.estado = "cerrado"
            }
            else{
                li.dataset.id = nuevoEntorno(newName)
                li.appendChild(txt);
            }
            li.dataset.nombre = newName
            setActiveElement(li)
        } else {
            parent.removeChild(li)
        }
    };

    input.addEventListener('keydown', (event) => {
        if (event.key === 'Enter') {
            stopEdtiting();
            event.stopPropagation()
        }
    });

    input.addEventListener('blur', stopEdtiting);
}
const sidebarEliminar = () => {
    if($arbol.querySelector('[contenteditable="true"]'))
        return

    const activeElement = $arbol.querySelector(".active")
    if (activeElement){
        if (activeElement.hasAttribute("data-papelera"))
            return    
        const parent = activeElement.closest("li")
        if (parent.parentNode.parentNode.dataset.id === "papelera"){
            entornos.find(obj => obj.datosInternos.nombre === activeElement.textContent).preguntarEliminarEntorno()
        }
        else if (parent.classList.contains("folder")){
            const lis = parent.querySelector("ul").querySelectorAll("li:not(.folder)")
            const papelera = $arbol.querySelector("[data-id = 'papelera']").querySelector("ul")
            lis.forEach(li => papelera.appendChild(li))
            parent.remove()
        }        
        else{
            cambiarEntorno()
            $arbol.querySelector("[data-id = 'papelera']").querySelector("ul").appendChild(parent)
        }    
    }    
}
const sidebarNuevaCarpeta = () => {
    const activeElement = $arbol.querySelector(".active")
    if (activeElement){
        const parent = activeElement.closest("li")
        if (parent.classList.contains("folder") && parent.querySelector("ul").classList.contains("open")){
                createNewTreeElement(parent.querySelector("ul"), "folder")
        }        
        else{
            createNewTreeElement(parent.closest("ul"), "folder")
        }    
    }    
    else{
        createNewTreeElement($arbol.querySelector("ul"), "folder")
    }    
}
const sidebarNuevoEntorno = () => {
    const activeElement = $arbol.querySelector(".active")
    if (activeElement){
        const parent = activeElement.closest("li")
        if (parent.classList.contains("folder") && parent.querySelector("ul").classList.contains("open")){
                createNewTreeElement(parent.querySelector("ul"))
        }        
        else{
            createNewTreeElement(parent.closest("ul"))
        }    
    }    
    else{
        createNewTreeElement($arbol.querySelector("ul"))
    }    
}
$sidebar.querySelector(".botones").querySelector(".eliminar").addEventListener("click", sidebarEliminar);    
   
$sidebar.querySelector(".nuevaCarpeta").addEventListener('click', sidebarNuevaCarpeta);    

$sidebar.querySelector(".nuevoEntorno").addEventListener('click', sidebarNuevoEntorno);    

let bloqueaBlur = false
const finishEditing = (e) => {
    //e.stopPropagation()
    //e.preventDefault()
    const li = e.target.closest("li")
    const nuevoNombre = e.target.innerHTML.replace(/&nbsp;/g, ' ').trim()
    if (nuevoNombre && li.dataset.nombre != nuevoNombre){            
        console.log("cambiar nombre a: " + nuevoNombre);  ////////////////// !!!!!!!!!!!
        document.getElementById("marcador").innerHTML="Entorno " + nuevoNombre
        li.dataset.nombre = nuevoNombre
        datosEntornos[li.dataset.id].nombre = nuevoNombre
        e.target.innerHTML = nuevoNombre
    }
    else {
        e.target.innerHTML = li.dataset.nombre
    }
    bloqueaBlur = true
    e.target.removeAttribute('contenteditable');
    window.getSelection().removeAllRanges();

    $arbol.focus()
    bloqueaBlur = false
    e.target.removeEventListener("blur", handleBlur)
    e.target.removeEventListener("keydown", handleEnter)
}
const editarNombre = (e) => {
    e.target.setAttribute('contenteditable', 'true');
    e.target.focus();
    document.execCommand('selectAll', false, null);
    e.target.addEventListener("blur", handleBlur)
    e.target.addEventListener("keydown", handleEnter)
}
const handleEnter = (e) => {
    if (e.key === 'Enter'){
        finishEditing(e)
    }
}
const handleBlur = (e) => {
    if (!bloqueaBlur)
        finishEditing(e)
}
const handleClickSidebar = (e) => {
    
    const activeElement = $arbol.querySelector('[contenteditable="true"]');
    if (activeElement){
        if(activeElement != e.target) {  // Quitar edición si click en otro elemento del árbol
            finishEditing({target: activeElement})
        }
        else
            return
    }
    e.preventDefault()
    const li = e.target.closest("li")
    setActiveElement(li)
    e.stopPropagation()
    $arbol.focus()
    if (li.classList.contains("folder") || li.firstChild?.tagName === 'DIV') {
        // Click en carpeta
        li.querySelector("ul").classList.toggle('open')
        li.querySelector(".icon").classList.toggle('closed')
        li.dataset.estado = li.dataset.estado === "abierto" ? "cerrado" : "abierto"
    }
    else if (li){
        // Click en entorno
        muestraEntorno(li.dataset.id)
    }

    if (e.button != 0){   // Click botón derecho
        if (e.target.classList.contains("name")) {
            editarNombre(e)
        }
    }
}
const handleKeySidebar = (e) => {
    if (!$sidebar.matches(':focus-within'))
        return
    if (e.altKey && e.key === 'ArrowUp'){
        e.preventDefault()
        const activeElement = $arbol.querySelector(".active")
        const liActivo = activeElement.closest("li")
        if (liActivo.previousElementSibling){
            if (liActivo.previousElementSibling.classList.contains("folder") && liActivo.previousElementSibling.querySelector("ul").classList.contains("open")){
                liActivo.previousElementSibling.querySelector("ul").appendChild(liActivo)
            }
            else{
                liActivo.closest("ul").insertBefore(liActivo, liActivo.previousElementSibling)
            }
        }
        else{
            if (liActivo.closest("ul").classList.contains("nested")){
                if (liActivo.closest("ul").closest("li").previousElementSibling){
                    liActivo.closest("ul").parentNode.closest("ul").insertBefore(liActivo, liActivo.closest("ul").closest("li"))
                }
                else{
                    liActivo.closest("ul").parentNode.closest("ul").insertBefore(liActivo, liActivo.closest("ul").closest("li"))
                }
            }
        }
    }
    else if (e.altKey && e.key === 'ArrowDown'){
        e.preventDefault()
        const activeElement = $arbol.querySelector(".active")
        const liActivo = activeElement.closest("li")
        if (liActivo.nextElementSibling){
            if (liActivo.nextElementSibling.classList.contains("folder") && liActivo.nextElementSibling.querySelector("ul").classList.contains("open")){
                liActivo.nextElementSibling.querySelector("ul").insertBefore(liActivo, liActivo.nextElementSibling.querySelector("ul").querySelector("li"))
            }
            else{
                liActivo.closest("ul").insertBefore(liActivo.nextElementSibling, liActivo)
            }
        }
        else{
            if (liActivo.closest("ul").classList.contains("nested")){
                if (liActivo.closest("ul").closest("li").nextElementSibling){
                    liActivo.closest("ul").parentNode.closest("ul").insertBefore(liActivo, liActivo.closest("ul").closest("li").nextElementSibling)
                }   
                else{
                    liActivo.closest("ul").parentNode.closest("ul").appendChild(liActivo)
                }
            }
        }
    }
    else if (e.key === 'Delete'){
        sidebarEliminar()
    }
    else if (e.ctrlKey && e.key == 'n'){
        e.preventDefault()
        sidebarNuevaCarpeta()
    }
    else if (e.ctrlKey && e.key == 'a'){
        e.preventDefault()
        sidebarNuevoEntorno()
    }
    else if (e.key === 'ArrowUp'){
        const liActivo = $arbol.querySelector(".active").closest("li")
        const liVisibles = getLiVisibles()
        liActivo.querySelector(".name").classList.remove("active")
        liVisibles.at(liVisibles.indexOf(liActivo)-1).querySelector(".name").classList.add("active")
    }
    else if (e.key === 'ArrowDown'){
        const liActivo = $arbol.querySelector(".active").closest("li")
        const liVisibles = getLiVisibles()
        liActivo.querySelector(".name").classList.remove("active")
        liVisibles.at((liVisibles.indexOf(liActivo) + 1) % liVisibles.length).querySelector(".name").classList.add("active")
    }
    else if (e.key === 'Enter'){
        const liActivo = $arbol.querySelector(".active").closest("li")
        if (liActivo.classList.contains("folder")){
            liActivo.querySelector("ul").classList.toggle('open');
            liActivo.querySelector(".icon").classList.toggle('closed'); 
            liActivo.dataset.estado = liActivo.dataset.estado === "abierto" ? "cerrado" : "abierto"
        }
        else if (datosEntornos.activo != liActivo.dataset.id){
            document.getElementById(datosEntornos.activo).classList.add("oculto")
            datosEntornos.activo = liActivo.dataset.id
            document.getElementById(datosEntornos.activo).classList.remove("oculto")
            document.getElementById("marcador").innerHTML = "Entorno: " + liActivo.querySelector(".name").innerHTML
        }
    }
    else if (e.key === 'F2'){
        editarNombre({target: $arbol.querySelector(".active")})
    }
}

const iconHTML = `<svg class="icon closed" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"><path d="M1 6l11 11l11 -11" /></svg>`

document.addEventListener('keydown', toggleSidebar);
document.addEventListener("keydown", handleKeySidebar)

//document.getElementById(datosEntornos.activo)?.classList.remove("oculto")    // Hace visible el entorno activo
//document.getElementById("marcador").innerHTML="Entorno: " + datosEntornos[datosEntornos.activo].nombre
//document.getElementById("botonGrabar").addEventListener("click", save, false)
//document.getElementById("botonCambiar").addEventListener("click", cambiarEntorno, false)
//document.getElementById("botonNuevoEntorno").addEventListener("click", nuevoEntorno, false)
createTree($arbol, datosArbol)
$arbol.querySelector("ul").addEventListener("click", () => $arbol.querySelector("ul").focus())
//Array.from($arbol.querySelectorAll(".name")).find((name) => name.textContent == datosEntornos[datosEntornos.activo].nombre).classList.add("active") // Marca el entorno actual en el árbol
//window.onload = () => $arbol.focus()

//window.addEventListener("beforeunload", () => {save("cerrar")}, false)

        
    </script>
</body>
</html>